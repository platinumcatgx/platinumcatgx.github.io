/*
THIS IS A GENERATED/BUNDLED FILE BY ROLLUP
if you want to view the source visit the plugins github repository
*/

'use strict';

var obsidian = require('obsidian');

/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */

function __awaiter(thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
}

const DEFAULT_SETTINGS = {
    linkText: "",
    copiedLinkText: "(see {{LINK}})",
    lineFormatFrom: "\\s*$",
    lineFormatTo: " (see {{LINK}})",
    removeLeadingWhitespace: true,
};
const genID = (length = 5) => {
    const characters = "abcdefghijklmnopqrstuvwxyz-0123456789";
    let id = "";
    while (id.length < length) {
        id += characters[Math.floor(Math.random() * characters.length)];
    }
    return id.slice(0, length);
};
var CopyTypes;
(function (CopyTypes) {
    CopyTypes[CopyTypes["SeparateLines"] = 0] = "SeparateLines";
    CopyTypes[CopyTypes["CombinedLines"] = 1] = "CombinedLines";
    CopyTypes[CopyTypes["LinkOnly"] = 2] = "LinkOnly";
    CopyTypes[CopyTypes["LinkOnlyEmbed"] = 3] = "LinkOnlyEmbed";
})(CopyTypes || (CopyTypes = {}));
var Mode;
(function (Mode) {
    Mode[Mode["LinkTextFromSettings"] = 0] = "LinkTextFromSettings";
    Mode[Mode["LinkTextFromSelection"] = 1] = "LinkTextFromSelection";
    Mode[Mode["LinkTextFromClipboard"] = 2] = "LinkTextFromClipboard";
})(Mode || (Mode = {}));
const blockIDRegex = /(?<=[\s^])\^[a-zA-Z0-9-]+$/u;
const copyForwardLines = (editor, view, settings, copy = CopyTypes.SeparateLines, mode = Mode.LinkTextFromSettings) => __awaiter(void 0, void 0, void 0, function* () {
    var _a;
    const regexValidation = validateRegex(settings.lineFormatFrom);
    if (regexValidation.valid !== true) {
        new obsidian.Notice(`Error: 'From' setting is invalid:\n\n${regexValidation.string}\n\nPlease update the Carry-Forward settings and try again.`, 1000 * 30 // 30 seconds
        );
        return;
    }
    const cursorFrom = editor.getCursor("from");
    const cursorTo = editor.getCursor("to");
    const minLine = cursorFrom.line;
    const maxLine = cursorTo.line;
    const transaction = {
        changes: [],
    };
    const file = view.file;
    const updatedLines = [];
    const copiedLines = [];
    let newID = "";
    for (let lineNumber = minLine; lineNumber <= maxLine; lineNumber++) {
        let line = editor.getLine(lineNumber);
        let copiedLine = line;
        if (settings.removeLeadingWhitespace === true &&
            lineNumber === minLine &&
            cursorFrom.ch === cursorTo.ch) {
            // Remove leading whitespace if the user is copying a full line without
            // having selected a specific part of the line:
            copiedLine = copiedLine.replace(/^\s*/, "");
        }
        if ((lineNumber === minLine || lineNumber === maxLine) &&
            !(minLine === maxLine && cursorFrom.ch === cursorTo.ch)) {
            copiedLine = line.slice(lineNumber === minLine ? cursorFrom.ch : 0, lineNumber === maxLine ? cursorTo.ch : line.length - 1);
        }
        if (editor.getLine(lineNumber).match(/^\s*$/) &&
            !(lineNumber === minLine && minLine === maxLine)) {
            copiedLines.push(copiedLine);
            updatedLines.push(line);
            continue;
        }
        let linkText = settings.linkText;
        if (mode === Mode.LinkTextFromSelection) {
            linkText = editor.getSelection();
        }
        if (mode === Mode.LinkTextFromClipboard) {
            linkText = yield navigator.clipboard.readText();
        }
        if (copy === CopyTypes.SeparateLines || lineNumber === minLine) {
            // Does the line already have a block ID?
            const blockID = line.match(blockIDRegex);
            let link = "";
            if (blockID === null) {
                // There is NOT an existing line ID:
                newID = `^${genID()}`;
                link = view.app.fileManager.generateMarkdownLink(file, "/", `#${newID}`, linkText);
                line = line.replace(/\s*?$/, ` ${newID}`);
                if (copy === CopyTypes.LinkOnly || copy === CopyTypes.LinkOnlyEmbed) {
                    link = (copy === CopyTypes.LinkOnlyEmbed ? "!" : "") + link;
                    copiedLine =
                        copy === CopyTypes.LinkOnlyEmbed
                            ? link
                            : settings.copiedLinkText.replace("{{LINK}}", link);
                }
                else {
                    copiedLine = copiedLine.replace(new RegExp(settings.lineFormatFrom, "u"), settings.lineFormatTo.replace("{{LINK}}", link));
                }
            }
            else {
                // There IS an existing line ID:
                link = view.app.fileManager.generateMarkdownLink(file, "/", `#${blockID}`, linkText);
                if (copy === CopyTypes.LinkOnly || copy === CopyTypes.LinkOnlyEmbed) {
                    link = (copy === CopyTypes.LinkOnlyEmbed ? "!" : "") + link;
                    copiedLine =
                        copy === CopyTypes.LinkOnlyEmbed
                            ? link
                            : settings.copiedLinkText.replace("{{LINK}}", link);
                }
                else {
                    copiedLine = copiedLine
                        .replace(blockIDRegex, "")
                        .replace(new RegExp(settings.lineFormatFrom, "u"), settings.lineFormatTo.replace("{{LINK}}", link));
                }
            }
        }
        if (!((copy === CopyTypes.LinkOnly || copy === CopyTypes.LinkOnlyEmbed) &&
            lineNumber !== minLine)) {
            copiedLines.push(copiedLine);
        }
        updatedLines.push(line);
    }
    navigator.clipboard.writeText(copiedLines.join("\n")).then(() => {
        new obsidian.Notice("Copied");
    });
    (_a = transaction.changes) === null || _a === void 0 ? void 0 : _a.push({
        from: { line: minLine, ch: 0 },
        to: { line: maxLine, ch: editor.getLine(maxLine).length },
        text: updatedLines.join("\n"),
    });
    transaction.selection = { from: cursorFrom, to: cursorTo };
    editor.transaction(transaction);
});
class CarryForwardPlugin extends obsidian.Plugin {
    onload() {
        return __awaiter(this, void 0, void 0, function* () {
            console.log("loading carry-forward-line plugin");
            yield this.loadSettings();
            this.addCommand({
                id: "carry-line-forward-separate-lines",
                name: "Copy selection with each line linked to its copied source (default link text)",
                editorCallback: (editor, view) => __awaiter(this, void 0, void 0, function* () {
                    return yield copyForwardLines(editor, view, this.settings, CopyTypes.SeparateLines);
                }),
            });
            this.addCommand({
                id: "carry-line-forward-combined-lines",
                name: "Copy selection with first line linked to its copied source (default link text)",
                editorCallback: (editor, view) => __awaiter(this, void 0, void 0, function* () {
                    return yield copyForwardLines(editor, view, this.settings, CopyTypes.CombinedLines);
                }),
            });
            this.addCommand({
                id: "carry-line-forward-link-only",
                name: "Copy link to line (default link text)",
                editorCallback: (editor, view) => __awaiter(this, void 0, void 0, function* () {
                    return yield copyForwardLines(editor, view, this.settings, CopyTypes.LinkOnly);
                }),
            });
            this.addCommand({
                id: "carry-line-forward-embed-link-only",
                name: "Copy embed link to line (default link text)",
                editorCallback: (editor, view) => __awaiter(this, void 0, void 0, function* () {
                    return yield copyForwardLines(editor, view, this.settings, CopyTypes.LinkOnlyEmbed);
                }),
            });
            this.addCommand({
                id: "carry-line-forward-separate-lines-selection",
                name: "Copy selection with each line linked to its copied source (link text from selection)",
                editorCallback: (editor, view) => __awaiter(this, void 0, void 0, function* () {
                    return yield copyForwardLines(editor, view, this.settings, CopyTypes.SeparateLines, Mode.LinkTextFromSelection);
                }),
            });
            this.addCommand({
                id: "carry-line-forward-combined-lines-selection",
                name: "Copy selection with first line linked to its copied source (link text from selection)",
                editorCallback: (editor, view) => __awaiter(this, void 0, void 0, function* () {
                    return yield copyForwardLines(editor, view, this.settings, CopyTypes.CombinedLines, Mode.LinkTextFromSelection);
                }),
            });
            this.addCommand({
                id: "carry-line-forward-link-only-selection",
                name: "Copy link to line (link text from selection)",
                editorCallback: (editor, view) => __awaiter(this, void 0, void 0, function* () {
                    return yield copyForwardLines(editor, view, this.settings, CopyTypes.LinkOnly, Mode.LinkTextFromSelection);
                }),
            });
            this.addCommand({
                id: "carry-line-forward-embed-link-only-selection",
                name: "Copy embed link to line (link text from selection)",
                editorCallback: (editor, view) => __awaiter(this, void 0, void 0, function* () {
                    return yield copyForwardLines(editor, view, this.settings, CopyTypes.LinkOnlyEmbed, Mode.LinkTextFromSelection);
                }),
            });
            this.addCommand({
                id: "carry-line-forward-separate-lines-clipboard",
                name: "Copy selection with each line linked to its copied source (link text from clipboard)",
                editorCallback: (editor, view) => __awaiter(this, void 0, void 0, function* () {
                    return yield copyForwardLines(editor, view, this.settings, CopyTypes.SeparateLines, Mode.LinkTextFromClipboard);
                }),
            });
            this.addCommand({
                id: "carry-line-forward-combined-lines-clipboard",
                name: "Copy selection with first line linked to its copied source (link text from clipboard)",
                editorCallback: (editor, view) => __awaiter(this, void 0, void 0, function* () {
                    return yield copyForwardLines(editor, view, this.settings, CopyTypes.CombinedLines, Mode.LinkTextFromClipboard);
                }),
            });
            this.addCommand({
                id: "carry-line-forward-link-only-clipboard",
                name: "Copy link to line (link text from clipboard)",
                editorCallback: (editor, view) => __awaiter(this, void 0, void 0, function* () {
                    return yield copyForwardLines(editor, view, this.settings, CopyTypes.LinkOnly, Mode.LinkTextFromClipboard);
                }),
            });
            this.addCommand({
                id: "carry-line-forward-embed-link-only-clipboard",
                name: "Copy embed link to line (link text from clipboard)",
                editorCallback: (editor, view) => __awaiter(this, void 0, void 0, function* () {
                    return yield copyForwardLines(editor, view, this.settings, CopyTypes.LinkOnlyEmbed, Mode.LinkTextFromClipboard);
                }),
            });
            this.addSettingTab(new CarryForwardSettingTab(this.app, this));
        });
    }
    onunload() {
        console.log("unloading carry-forward-line plugin");
    }
    loadSettings() {
        return __awaiter(this, void 0, void 0, function* () {
            this.settings = Object.assign({}, DEFAULT_SETTINGS, yield this.loadData());
        });
    }
    saveSettings() {
        return __awaiter(this, void 0, void 0, function* () {
            yield this.saveData(this.settings);
        });
    }
}
const validateRegex = (regexString) => {
    let updatedRegexString = regexString
        // Because the plugin's settings are stored in JSON, characters like
        // \n get double-escaped, and then do not get replaced automatically
        // on use. This was causing To strings not to parse \n, etc.
        .replace(/\\n/g, "\n")
        .replace(/\\t/g, "\t")
        .replace(/\\r/g, "\r");
    try {
        new RegExp(updatedRegexString, "u");
        return { valid: true, string: updatedRegexString };
    }
    catch (e) {
        return {
            valid: false,
            string: `"${updatedRegexString}": "${e}"`,
        };
    }
};
class CarryForwardSettingTab extends obsidian.PluginSettingTab {
    constructor(app, plugin) {
        super(app, plugin);
        this.plugin = plugin;
    }
    display() {
        let { containerEl } = this;
        containerEl.empty();
        containerEl.createEl("h1", { text: "Carry-forward" });
        new obsidian.Setting(containerEl)
            .setName("Default link text")
            .setDesc('The default text that "{{LINK}}" in the settings below will be replaced with. Leaving this blank will display the actual text of the link.')
            .addText((text) => {
            const settings = this.plugin.settings;
            text.setValue(settings.linkText).onChange((value) => __awaiter(this, void 0, void 0, function* () {
                settings.linkText = value;
                yield this.plugin.saveSettings();
            }));
        });
        const copiedLinksEl = containerEl.createEl("div");
        copiedLinksEl.createEl("h2", { text: "Copied references" });
        copiedLinksEl.createEl("p", {
            text: 'Settings relating to "Copy link to line..." and "Copy embed link to line..." commands.',
            cls: "setting-item-description",
        });
        new obsidian.Setting(copiedLinksEl)
            .setName("Copied references")
            .setDesc("The full text of copied references. Use {{LINK}} to place the link.")
            .addText((text) => {
            const settings = this.plugin.settings;
            text.setValue(settings.copiedLinkText).onChange((value) => __awaiter(this, void 0, void 0, function* () {
                settings.copiedLinkText = value;
                yield this.plugin.saveSettings();
            }));
        });
        const copiedLinesEl = containerEl.createEl("div");
        copiedLinesEl.createEl("h2", { text: "Copied lines" });
        copiedLinesEl.createEl("p", {
            text: 'Settings relating to "Copy selection..." commands.',
            cls: "setting-item-description",
        });
        const fromToEl = copiedLinesEl.createEl("div");
        fromToEl.addClass("from-to-rule");
        if (validateRegex(this.plugin.settings.lineFormatFrom).valid !== true) {
            fromToEl.addClass("invalid");
        }
        new obsidian.Setting(fromToEl)
            .setName("From")
            .setDesc("Find the first match of a Regular Expression in each copied line")
            .addText((text) => text
            .setPlaceholder(DEFAULT_SETTINGS.lineFormatFrom)
            .setValue(this.plugin.settings.lineFormatFrom)
            .onChange((value) => __awaiter(this, void 0, void 0, function* () {
            if (value === "") {
                this.plugin.settings.lineFormatFrom =
                    DEFAULT_SETTINGS.lineFormatFrom;
            }
            else {
                if (validateRegex(value).valid !== true) {
                    fromToEl.addClass("invalid");
                }
                else {
                    fromToEl.removeClass("invalid");
                }
                this.plugin.settings.lineFormatFrom = value;
            }
            yield this.plugin.saveSettings();
        })));
        new obsidian.Setting(fromToEl)
            .setName("To")
            .setDesc("Replace the first match in each copied line with text. Use {{LINK}} to place the link.")
            .addText((text) => text
            .setPlaceholder(DEFAULT_SETTINGS.lineFormatTo)
            .setValue(this.plugin.settings.lineFormatTo)
            .onChange((value) => __awaiter(this, void 0, void 0, function* () {
            if (value === "") {
                this.plugin.settings.lineFormatTo = DEFAULT_SETTINGS.lineFormatTo;
            }
            else {
                this.plugin.settings.lineFormatTo = value;
            }
            yield this.plugin.saveSettings();
        })));
        new obsidian.Setting(copiedLinesEl)
            .setName("Remove leading whitespace from first line")
            .setDesc("When copying a line without having selected a specific part of that line, remove any whitespace at the beginning of the copied line.")
            .addToggle((toggle) => {
            const settings = this.plugin.settings;
            toggle
                .setValue(settings.removeLeadingWhitespace)
                .onChange((value) => __awaiter(this, void 0, void 0, function* () {
                settings.removeLeadingWhitespace = value;
                yield this.plugin.saveSettings();
            }));
        });
    }
}

module.exports = CarryForwardPlugin;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZXMiOlsibm9kZV9tb2R1bGVzL3RzbGliL3RzbGliLmVzNi5qcyIsIm1haW4udHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyohICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXHJcbkNvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLlxyXG5cclxuUGVybWlzc2lvbiB0byB1c2UsIGNvcHksIG1vZGlmeSwgYW5kL29yIGRpc3RyaWJ1dGUgdGhpcyBzb2Z0d2FyZSBmb3IgYW55XHJcbnB1cnBvc2Ugd2l0aCBvciB3aXRob3V0IGZlZSBpcyBoZXJlYnkgZ3JhbnRlZC5cclxuXHJcblRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIgQU5EIFRIRSBBVVRIT1IgRElTQ0xBSU1TIEFMTCBXQVJSQU5USUVTIFdJVEhcclxuUkVHQVJEIFRPIFRISVMgU09GVFdBUkUgSU5DTFVESU5HIEFMTCBJTVBMSUVEIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZXHJcbkFORCBGSVRORVNTLiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQVVUSE9SIEJFIExJQUJMRSBGT1IgQU5ZIFNQRUNJQUwsIERJUkVDVCxcclxuSU5ESVJFQ1QsIE9SIENPTlNFUVVFTlRJQUwgREFNQUdFUyBPUiBBTlkgREFNQUdFUyBXSEFUU09FVkVSIFJFU1VMVElORyBGUk9NXHJcbkxPU1MgT0YgVVNFLCBEQVRBIE9SIFBST0ZJVFMsIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBORUdMSUdFTkNFIE9SXHJcbk9USEVSIFRPUlRJT1VTIEFDVElPTiwgQVJJU0lORyBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBVU0UgT1JcclxuUEVSRk9STUFOQ0UgT0YgVEhJUyBTT0ZUV0FSRS5cclxuKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiogKi9cclxuLyogZ2xvYmFsIFJlZmxlY3QsIFByb21pc2UgKi9cclxuXHJcbnZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24oZCwgYikge1xyXG4gICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxyXG4gICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcclxuICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoYiwgcCkpIGRbcF0gPSBiW3BdOyB9O1xyXG4gICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XHJcbn07XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19leHRlbmRzKGQsIGIpIHtcclxuICAgIGlmICh0eXBlb2YgYiAhPT0gXCJmdW5jdGlvblwiICYmIGIgIT09IG51bGwpXHJcbiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNsYXNzIGV4dGVuZHMgdmFsdWUgXCIgKyBTdHJpbmcoYikgKyBcIiBpcyBub3QgYSBjb25zdHJ1Y3RvciBvciBudWxsXCIpO1xyXG4gICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcclxuICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxyXG4gICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xyXG59XHJcblxyXG5leHBvcnQgdmFyIF9fYXNzaWduID0gZnVuY3Rpb24oKSB7XHJcbiAgICBfX2Fzc2lnbiA9IE9iamVjdC5hc3NpZ24gfHwgZnVuY3Rpb24gX19hc3NpZ24odCkge1xyXG4gICAgICAgIGZvciAodmFyIHMsIGkgPSAxLCBuID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IG47IGkrKykge1xyXG4gICAgICAgICAgICBzID0gYXJndW1lbnRzW2ldO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBwIGluIHMpIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwocywgcCkpIHRbcF0gPSBzW3BdO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdDtcclxuICAgIH1cclxuICAgIHJldHVybiBfX2Fzc2lnbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19yZXN0KHMsIGUpIHtcclxuICAgIHZhciB0ID0ge307XHJcbiAgICBmb3IgKHZhciBwIGluIHMpIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwocywgcCkgJiYgZS5pbmRleE9mKHApIDwgMClcclxuICAgICAgICB0W3BdID0gc1twXTtcclxuICAgIGlmIChzICE9IG51bGwgJiYgdHlwZW9mIE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMgPT09IFwiZnVuY3Rpb25cIilcclxuICAgICAgICBmb3IgKHZhciBpID0gMCwgcCA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMocyk7IGkgPCBwLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGlmIChlLmluZGV4T2YocFtpXSkgPCAwICYmIE9iamVjdC5wcm90b3R5cGUucHJvcGVydHlJc0VudW1lcmFibGUuY2FsbChzLCBwW2ldKSlcclxuICAgICAgICAgICAgICAgIHRbcFtpXV0gPSBzW3BbaV1dO1xyXG4gICAgICAgIH1cclxuICAgIHJldHVybiB0O1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19kZWNvcmF0ZShkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwgZGVzYykge1xyXG4gICAgdmFyIGMgPSBhcmd1bWVudHMubGVuZ3RoLCByID0gYyA8IDMgPyB0YXJnZXQgOiBkZXNjID09PSBudWxsID8gZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IodGFyZ2V0LCBrZXkpIDogZGVzYywgZDtcclxuICAgIGlmICh0eXBlb2YgUmVmbGVjdCA9PT0gXCJvYmplY3RcIiAmJiB0eXBlb2YgUmVmbGVjdC5kZWNvcmF0ZSA9PT0gXCJmdW5jdGlvblwiKSByID0gUmVmbGVjdC5kZWNvcmF0ZShkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwgZGVzYyk7XHJcbiAgICBlbHNlIGZvciAodmFyIGkgPSBkZWNvcmF0b3JzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSBpZiAoZCA9IGRlY29yYXRvcnNbaV0pIHIgPSAoYyA8IDMgPyBkKHIpIDogYyA+IDMgPyBkKHRhcmdldCwga2V5LCByKSA6IGQodGFyZ2V0LCBrZXkpKSB8fCByO1xyXG4gICAgcmV0dXJuIGMgPiAzICYmIHIgJiYgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCByKSwgcjtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fcGFyYW0ocGFyYW1JbmRleCwgZGVjb3JhdG9yKSB7XHJcbiAgICByZXR1cm4gZnVuY3Rpb24gKHRhcmdldCwga2V5KSB7IGRlY29yYXRvcih0YXJnZXQsIGtleSwgcGFyYW1JbmRleCk7IH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fbWV0YWRhdGEobWV0YWRhdGFLZXksIG1ldGFkYXRhVmFsdWUpIHtcclxuICAgIGlmICh0eXBlb2YgUmVmbGVjdCA9PT0gXCJvYmplY3RcIiAmJiB0eXBlb2YgUmVmbGVjdC5tZXRhZGF0YSA9PT0gXCJmdW5jdGlvblwiKSByZXR1cm4gUmVmbGVjdC5tZXRhZGF0YShtZXRhZGF0YUtleSwgbWV0YWRhdGFWYWx1ZSk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2F3YWl0ZXIodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XHJcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cclxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxyXG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcclxuICAgIH0pO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19nZW5lcmF0b3IodGhpc0FyZywgYm9keSkge1xyXG4gICAgdmFyIF8gPSB7IGxhYmVsOiAwLCBzZW50OiBmdW5jdGlvbigpIHsgaWYgKHRbMF0gJiAxKSB0aHJvdyB0WzFdOyByZXR1cm4gdFsxXTsgfSwgdHJ5czogW10sIG9wczogW10gfSwgZiwgeSwgdCwgZztcclxuICAgIHJldHVybiBnID0geyBuZXh0OiB2ZXJiKDApLCBcInRocm93XCI6IHZlcmIoMSksIFwicmV0dXJuXCI6IHZlcmIoMikgfSwgdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIChnW1N5bWJvbC5pdGVyYXRvcl0gPSBmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXM7IH0pLCBnO1xyXG4gICAgZnVuY3Rpb24gdmVyYihuKSB7IHJldHVybiBmdW5jdGlvbiAodikgeyByZXR1cm4gc3RlcChbbiwgdl0pOyB9OyB9XHJcbiAgICBmdW5jdGlvbiBzdGVwKG9wKSB7XHJcbiAgICAgICAgaWYgKGYpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJHZW5lcmF0b3IgaXMgYWxyZWFkeSBleGVjdXRpbmcuXCIpO1xyXG4gICAgICAgIHdoaWxlIChfKSB0cnkge1xyXG4gICAgICAgICAgICBpZiAoZiA9IDEsIHkgJiYgKHQgPSBvcFswXSAmIDIgPyB5W1wicmV0dXJuXCJdIDogb3BbMF0gPyB5W1widGhyb3dcIl0gfHwgKCh0ID0geVtcInJldHVyblwiXSkgJiYgdC5jYWxsKHkpLCAwKSA6IHkubmV4dCkgJiYgISh0ID0gdC5jYWxsKHksIG9wWzFdKSkuZG9uZSkgcmV0dXJuIHQ7XHJcbiAgICAgICAgICAgIGlmICh5ID0gMCwgdCkgb3AgPSBbb3BbMF0gJiAyLCB0LnZhbHVlXTtcclxuICAgICAgICAgICAgc3dpdGNoIChvcFswXSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAwOiBjYXNlIDE6IHQgPSBvcDsgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDQ6IF8ubGFiZWwrKzsgcmV0dXJuIHsgdmFsdWU6IG9wWzFdLCBkb25lOiBmYWxzZSB9O1xyXG4gICAgICAgICAgICAgICAgY2FzZSA1OiBfLmxhYmVsKys7IHkgPSBvcFsxXTsgb3AgPSBbMF07IGNvbnRpbnVlO1xyXG4gICAgICAgICAgICAgICAgY2FzZSA3OiBvcCA9IF8ub3BzLnBvcCgpOyBfLnRyeXMucG9wKCk7IGNvbnRpbnVlO1xyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICBpZiAoISh0ID0gXy50cnlzLCB0ID0gdC5sZW5ndGggPiAwICYmIHRbdC5sZW5ndGggLSAxXSkgJiYgKG9wWzBdID09PSA2IHx8IG9wWzBdID09PSAyKSkgeyBfID0gMDsgY29udGludWU7IH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAob3BbMF0gPT09IDMgJiYgKCF0IHx8IChvcFsxXSA+IHRbMF0gJiYgb3BbMV0gPCB0WzNdKSkpIHsgXy5sYWJlbCA9IG9wWzFdOyBicmVhazsgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvcFswXSA9PT0gNiAmJiBfLmxhYmVsIDwgdFsxXSkgeyBfLmxhYmVsID0gdFsxXTsgdCA9IG9wOyBicmVhazsgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0ICYmIF8ubGFiZWwgPCB0WzJdKSB7IF8ubGFiZWwgPSB0WzJdOyBfLm9wcy5wdXNoKG9wKTsgYnJlYWs7IH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAodFsyXSkgXy5vcHMucG9wKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgXy50cnlzLnBvcCgpOyBjb250aW51ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBvcCA9IGJvZHkuY2FsbCh0aGlzQXJnLCBfKTtcclxuICAgICAgICB9IGNhdGNoIChlKSB7IG9wID0gWzYsIGVdOyB5ID0gMDsgfSBmaW5hbGx5IHsgZiA9IHQgPSAwOyB9XHJcbiAgICAgICAgaWYgKG9wWzBdICYgNSkgdGhyb3cgb3BbMV07IHJldHVybiB7IHZhbHVlOiBvcFswXSA/IG9wWzFdIDogdm9pZCAwLCBkb25lOiB0cnVlIH07XHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCB2YXIgX19jcmVhdGVCaW5kaW5nID0gT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xyXG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcclxufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcclxuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XHJcbiAgICBvW2syXSA9IG1ba107XHJcbn0pO1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fZXhwb3J0U3RhcihtLCBvKSB7XHJcbiAgICBmb3IgKHZhciBwIGluIG0pIGlmIChwICE9PSBcImRlZmF1bHRcIiAmJiAhT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG8sIHApKSBfX2NyZWF0ZUJpbmRpbmcobywgbSwgcCk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX3ZhbHVlcyhvKSB7XHJcbiAgICB2YXIgcyA9IHR5cGVvZiBTeW1ib2wgPT09IFwiZnVuY3Rpb25cIiAmJiBTeW1ib2wuaXRlcmF0b3IsIG0gPSBzICYmIG9bc10sIGkgPSAwO1xyXG4gICAgaWYgKG0pIHJldHVybiBtLmNhbGwobyk7XHJcbiAgICBpZiAobyAmJiB0eXBlb2Ygby5sZW5ndGggPT09IFwibnVtYmVyXCIpIHJldHVybiB7XHJcbiAgICAgICAgbmV4dDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBpZiAobyAmJiBpID49IG8ubGVuZ3RoKSBvID0gdm9pZCAwO1xyXG4gICAgICAgICAgICByZXR1cm4geyB2YWx1ZTogbyAmJiBvW2krK10sIGRvbmU6ICFvIH07XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIHRocm93IG5ldyBUeXBlRXJyb3IocyA/IFwiT2JqZWN0IGlzIG5vdCBpdGVyYWJsZS5cIiA6IFwiU3ltYm9sLml0ZXJhdG9yIGlzIG5vdCBkZWZpbmVkLlwiKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fcmVhZChvLCBuKSB7XHJcbiAgICB2YXIgbSA9IHR5cGVvZiBTeW1ib2wgPT09IFwiZnVuY3Rpb25cIiAmJiBvW1N5bWJvbC5pdGVyYXRvcl07XHJcbiAgICBpZiAoIW0pIHJldHVybiBvO1xyXG4gICAgdmFyIGkgPSBtLmNhbGwobyksIHIsIGFyID0gW10sIGU7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIHdoaWxlICgobiA9PT0gdm9pZCAwIHx8IG4tLSA+IDApICYmICEociA9IGkubmV4dCgpKS5kb25lKSBhci5wdXNoKHIudmFsdWUpO1xyXG4gICAgfVxyXG4gICAgY2F0Y2ggKGVycm9yKSB7IGUgPSB7IGVycm9yOiBlcnJvciB9OyB9XHJcbiAgICBmaW5hbGx5IHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBpZiAociAmJiAhci5kb25lICYmIChtID0gaVtcInJldHVyblwiXSkpIG0uY2FsbChpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZmluYWxseSB7IGlmIChlKSB0aHJvdyBlLmVycm9yOyB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gYXI7XHJcbn1cclxuXHJcbi8qKiBAZGVwcmVjYXRlZCAqL1xyXG5leHBvcnQgZnVuY3Rpb24gX19zcHJlYWQoKSB7XHJcbiAgICBmb3IgKHZhciBhciA9IFtdLCBpID0gMDsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKylcclxuICAgICAgICBhciA9IGFyLmNvbmNhdChfX3JlYWQoYXJndW1lbnRzW2ldKSk7XHJcbiAgICByZXR1cm4gYXI7XHJcbn1cclxuXHJcbi8qKiBAZGVwcmVjYXRlZCAqL1xyXG5leHBvcnQgZnVuY3Rpb24gX19zcHJlYWRBcnJheXMoKSB7XHJcbiAgICBmb3IgKHZhciBzID0gMCwgaSA9IDAsIGlsID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IGlsOyBpKyspIHMgKz0gYXJndW1lbnRzW2ldLmxlbmd0aDtcclxuICAgIGZvciAodmFyIHIgPSBBcnJheShzKSwgayA9IDAsIGkgPSAwOyBpIDwgaWw7IGkrKylcclxuICAgICAgICBmb3IgKHZhciBhID0gYXJndW1lbnRzW2ldLCBqID0gMCwgamwgPSBhLmxlbmd0aDsgaiA8IGpsOyBqKyssIGsrKylcclxuICAgICAgICAgICAgcltrXSA9IGFbal07XHJcbiAgICByZXR1cm4gcjtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fc3ByZWFkQXJyYXkodG8sIGZyb20sIHBhY2spIHtcclxuICAgIGlmIChwYWNrIHx8IGFyZ3VtZW50cy5sZW5ndGggPT09IDIpIGZvciAodmFyIGkgPSAwLCBsID0gZnJvbS5sZW5ndGgsIGFyOyBpIDwgbDsgaSsrKSB7XHJcbiAgICAgICAgaWYgKGFyIHx8ICEoaSBpbiBmcm9tKSkge1xyXG4gICAgICAgICAgICBpZiAoIWFyKSBhciA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGZyb20sIDAsIGkpO1xyXG4gICAgICAgICAgICBhcltpXSA9IGZyb21baV07XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRvLmNvbmNhdChhciB8fCBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChmcm9tKSk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2F3YWl0KHYpIHtcclxuICAgIHJldHVybiB0aGlzIGluc3RhbmNlb2YgX19hd2FpdCA/ICh0aGlzLnYgPSB2LCB0aGlzKSA6IG5ldyBfX2F3YWl0KHYpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19hc3luY0dlbmVyYXRvcih0aGlzQXJnLCBfYXJndW1lbnRzLCBnZW5lcmF0b3IpIHtcclxuICAgIGlmICghU3ltYm9sLmFzeW5jSXRlcmF0b3IpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJTeW1ib2wuYXN5bmNJdGVyYXRvciBpcyBub3QgZGVmaW5lZC5cIik7XHJcbiAgICB2YXIgZyA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSwgaSwgcSA9IFtdO1xyXG4gICAgcmV0dXJuIGkgPSB7fSwgdmVyYihcIm5leHRcIiksIHZlcmIoXCJ0aHJvd1wiKSwgdmVyYihcInJldHVyblwiKSwgaVtTeW1ib2wuYXN5bmNJdGVyYXRvcl0gPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzOyB9LCBpO1xyXG4gICAgZnVuY3Rpb24gdmVyYihuKSB7IGlmIChnW25dKSBpW25dID0gZnVuY3Rpb24gKHYpIHsgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChhLCBiKSB7IHEucHVzaChbbiwgdiwgYSwgYl0pID4gMSB8fCByZXN1bWUobiwgdik7IH0pOyB9OyB9XHJcbiAgICBmdW5jdGlvbiByZXN1bWUobiwgdikgeyB0cnkgeyBzdGVwKGdbbl0odikpOyB9IGNhdGNoIChlKSB7IHNldHRsZShxWzBdWzNdLCBlKTsgfSB9XHJcbiAgICBmdW5jdGlvbiBzdGVwKHIpIHsgci52YWx1ZSBpbnN0YW5jZW9mIF9fYXdhaXQgPyBQcm9taXNlLnJlc29sdmUoci52YWx1ZS52KS50aGVuKGZ1bGZpbGwsIHJlamVjdCkgOiBzZXR0bGUocVswXVsyXSwgcik7IH1cclxuICAgIGZ1bmN0aW9uIGZ1bGZpbGwodmFsdWUpIHsgcmVzdW1lKFwibmV4dFwiLCB2YWx1ZSk7IH1cclxuICAgIGZ1bmN0aW9uIHJlamVjdCh2YWx1ZSkgeyByZXN1bWUoXCJ0aHJvd1wiLCB2YWx1ZSk7IH1cclxuICAgIGZ1bmN0aW9uIHNldHRsZShmLCB2KSB7IGlmIChmKHYpLCBxLnNoaWZ0KCksIHEubGVuZ3RoKSByZXN1bWUocVswXVswXSwgcVswXVsxXSk7IH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fYXN5bmNEZWxlZ2F0b3Iobykge1xyXG4gICAgdmFyIGksIHA7XHJcbiAgICByZXR1cm4gaSA9IHt9LCB2ZXJiKFwibmV4dFwiKSwgdmVyYihcInRocm93XCIsIGZ1bmN0aW9uIChlKSB7IHRocm93IGU7IH0pLCB2ZXJiKFwicmV0dXJuXCIpLCBpW1N5bWJvbC5pdGVyYXRvcl0gPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzOyB9LCBpO1xyXG4gICAgZnVuY3Rpb24gdmVyYihuLCBmKSB7IGlbbl0gPSBvW25dID8gZnVuY3Rpb24gKHYpIHsgcmV0dXJuIChwID0gIXApID8geyB2YWx1ZTogX19hd2FpdChvW25dKHYpKSwgZG9uZTogbiA9PT0gXCJyZXR1cm5cIiB9IDogZiA/IGYodikgOiB2OyB9IDogZjsgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19hc3luY1ZhbHVlcyhvKSB7XHJcbiAgICBpZiAoIVN5bWJvbC5hc3luY0l0ZXJhdG9yKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiU3ltYm9sLmFzeW5jSXRlcmF0b3IgaXMgbm90IGRlZmluZWQuXCIpO1xyXG4gICAgdmFyIG0gPSBvW1N5bWJvbC5hc3luY0l0ZXJhdG9yXSwgaTtcclxuICAgIHJldHVybiBtID8gbS5jYWxsKG8pIDogKG8gPSB0eXBlb2YgX192YWx1ZXMgPT09IFwiZnVuY3Rpb25cIiA/IF9fdmFsdWVzKG8pIDogb1tTeW1ib2wuaXRlcmF0b3JdKCksIGkgPSB7fSwgdmVyYihcIm5leHRcIiksIHZlcmIoXCJ0aHJvd1wiKSwgdmVyYihcInJldHVyblwiKSwgaVtTeW1ib2wuYXN5bmNJdGVyYXRvcl0gPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzOyB9LCBpKTtcclxuICAgIGZ1bmN0aW9uIHZlcmIobikgeyBpW25dID0gb1tuXSAmJiBmdW5jdGlvbiAodikgeyByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgeyB2ID0gb1tuXSh2KSwgc2V0dGxlKHJlc29sdmUsIHJlamVjdCwgdi5kb25lLCB2LnZhbHVlKTsgfSk7IH07IH1cclxuICAgIGZ1bmN0aW9uIHNldHRsZShyZXNvbHZlLCByZWplY3QsIGQsIHYpIHsgUHJvbWlzZS5yZXNvbHZlKHYpLnRoZW4oZnVuY3Rpb24odikgeyByZXNvbHZlKHsgdmFsdWU6IHYsIGRvbmU6IGQgfSk7IH0sIHJlamVjdCk7IH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fbWFrZVRlbXBsYXRlT2JqZWN0KGNvb2tlZCwgcmF3KSB7XHJcbiAgICBpZiAoT2JqZWN0LmRlZmluZVByb3BlcnR5KSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShjb29rZWQsIFwicmF3XCIsIHsgdmFsdWU6IHJhdyB9KTsgfSBlbHNlIHsgY29va2VkLnJhdyA9IHJhdzsgfVxyXG4gICAgcmV0dXJuIGNvb2tlZDtcclxufTtcclxuXHJcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSBPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcclxufSkgOiBmdW5jdGlvbihvLCB2KSB7XHJcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XHJcbn07XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19pbXBvcnRTdGFyKG1vZCkge1xyXG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcclxuICAgIHZhciByZXN1bHQgPSB7fTtcclxuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcclxuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XHJcbiAgICByZXR1cm4gcmVzdWx0O1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19pbXBvcnREZWZhdWx0KG1vZCkge1xyXG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBkZWZhdWx0OiBtb2QgfTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fY2xhc3NQcml2YXRlRmllbGRHZXQocmVjZWl2ZXIsIHN0YXRlLCBraW5kLCBmKSB7XHJcbiAgICBpZiAoa2luZCA9PT0gXCJhXCIgJiYgIWYpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJQcml2YXRlIGFjY2Vzc29yIHdhcyBkZWZpbmVkIHdpdGhvdXQgYSBnZXR0ZXJcIik7XHJcbiAgICBpZiAodHlwZW9mIHN0YXRlID09PSBcImZ1bmN0aW9uXCIgPyByZWNlaXZlciAhPT0gc3RhdGUgfHwgIWYgOiAhc3RhdGUuaGFzKHJlY2VpdmVyKSkgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbm5vdCByZWFkIHByaXZhdGUgbWVtYmVyIGZyb20gYW4gb2JqZWN0IHdob3NlIGNsYXNzIGRpZCBub3QgZGVjbGFyZSBpdFwiKTtcclxuICAgIHJldHVybiBraW5kID09PSBcIm1cIiA/IGYgOiBraW5kID09PSBcImFcIiA/IGYuY2FsbChyZWNlaXZlcikgOiBmID8gZi52YWx1ZSA6IHN0YXRlLmdldChyZWNlaXZlcik7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2NsYXNzUHJpdmF0ZUZpZWxkU2V0KHJlY2VpdmVyLCBzdGF0ZSwgdmFsdWUsIGtpbmQsIGYpIHtcclxuICAgIGlmIChraW5kID09PSBcIm1cIikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIlByaXZhdGUgbWV0aG9kIGlzIG5vdCB3cml0YWJsZVwiKTtcclxuICAgIGlmIChraW5kID09PSBcImFcIiAmJiAhZikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIlByaXZhdGUgYWNjZXNzb3Igd2FzIGRlZmluZWQgd2l0aG91dCBhIHNldHRlclwiKTtcclxuICAgIGlmICh0eXBlb2Ygc3RhdGUgPT09IFwiZnVuY3Rpb25cIiA/IHJlY2VpdmVyICE9PSBzdGF0ZSB8fCAhZiA6ICFzdGF0ZS5oYXMocmVjZWl2ZXIpKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2Fubm90IHdyaXRlIHByaXZhdGUgbWVtYmVyIHRvIGFuIG9iamVjdCB3aG9zZSBjbGFzcyBkaWQgbm90IGRlY2xhcmUgaXRcIik7XHJcbiAgICByZXR1cm4gKGtpbmQgPT09IFwiYVwiID8gZi5jYWxsKHJlY2VpdmVyLCB2YWx1ZSkgOiBmID8gZi52YWx1ZSA9IHZhbHVlIDogc3RhdGUuc2V0KHJlY2VpdmVyLCB2YWx1ZSkpLCB2YWx1ZTtcclxufVxyXG4iLCJpbXBvcnQge1xuICBBcHAsXG4gIEVkaXRvcixcbiAgRWRpdG9yVHJhbnNhY3Rpb24sXG4gIE1hcmtkb3duVmlldyxcbiAgTm90aWNlLFxuICBQbHVnaW4sXG4gIFBsdWdpblNldHRpbmdUYWIsXG4gIFNldHRpbmcsXG59IGZyb20gXCJvYnNpZGlhblwiO1xuXG5pbnRlcmZhY2UgQ2FycnlGb3J3YXJkUGx1Z2luU2V0dGluZ3Mge1xuICBsaW5rVGV4dDogc3RyaW5nO1xuICBjb3BpZWRMaW5rVGV4dDogc3RyaW5nO1xuICBsaW5lRm9ybWF0RnJvbTogc3RyaW5nO1xuICBsaW5lRm9ybWF0VG86IHN0cmluZztcbiAgcmVtb3ZlTGVhZGluZ1doaXRlc3BhY2U6IGJvb2xlYW47XG59XG5cbmNvbnN0IERFRkFVTFRfU0VUVElOR1M6IENhcnJ5Rm9yd2FyZFBsdWdpblNldHRpbmdzID0ge1xuICBsaW5rVGV4dDogXCJcIixcbiAgY29waWVkTGlua1RleHQ6IFwiKHNlZSB7e0xJTkt9fSlcIixcbiAgbGluZUZvcm1hdEZyb206IFwiXFxcXHMqJFwiLFxuICBsaW5lRm9ybWF0VG86IFwiIChzZWUge3tMSU5LfX0pXCIsXG4gIHJlbW92ZUxlYWRpbmdXaGl0ZXNwYWNlOiB0cnVlLFxufTtcblxuY29uc3QgZ2VuSUQgPSAobGVuZ3RoID0gNSkgPT4ge1xuICBjb25zdCBjaGFyYWN0ZXJzID0gXCJhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ei0wMTIzNDU2Nzg5XCI7XG4gIGxldCBpZCA9IFwiXCI7XG4gIHdoaWxlIChpZC5sZW5ndGggPCBsZW5ndGgpIHtcbiAgICBpZCArPSBjaGFyYWN0ZXJzW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIGNoYXJhY3RlcnMubGVuZ3RoKV07XG4gIH1cbiAgcmV0dXJuIGlkLnNsaWNlKDAsIGxlbmd0aCk7XG59O1xuXG5lbnVtIENvcHlUeXBlcyB7XG4gIFNlcGFyYXRlTGluZXMsXG4gIENvbWJpbmVkTGluZXMsXG4gIExpbmtPbmx5LFxuICBMaW5rT25seUVtYmVkLFxufVxuXG5lbnVtIE1vZGUge1xuICBMaW5rVGV4dEZyb21TZXR0aW5ncyxcbiAgTGlua1RleHRGcm9tU2VsZWN0aW9uLFxuICBMaW5rVGV4dEZyb21DbGlwYm9hcmQsXG59XG5cbmNvbnN0IGJsb2NrSURSZWdleCA9IC8oPzw9W1xcc15dKVxcXlthLXpBLVowLTktXSskL3U7XG5cbmNvbnN0IGNvcHlGb3J3YXJkTGluZXMgPSBhc3luYyAoXG4gIGVkaXRvcjogRWRpdG9yLFxuICB2aWV3OiBNYXJrZG93blZpZXcsXG4gIHNldHRpbmdzOiBDYXJyeUZvcndhcmRQbHVnaW5TZXR0aW5ncyxcbiAgY29weTogQ29weVR5cGVzID0gQ29weVR5cGVzLlNlcGFyYXRlTGluZXMsXG4gIG1vZGU6IE1vZGUgPSBNb2RlLkxpbmtUZXh0RnJvbVNldHRpbmdzXG4pID0+IHtcbiAgY29uc3QgcmVnZXhWYWxpZGF0aW9uID0gdmFsaWRhdGVSZWdleChzZXR0aW5ncy5saW5lRm9ybWF0RnJvbSk7XG4gIGlmIChyZWdleFZhbGlkYXRpb24udmFsaWQgIT09IHRydWUpIHtcbiAgICBuZXcgTm90aWNlKFxuICAgICAgYEVycm9yOiAnRnJvbScgc2V0dGluZyBpcyBpbnZhbGlkOlxcblxcbiR7cmVnZXhWYWxpZGF0aW9uLnN0cmluZ31cXG5cXG5QbGVhc2UgdXBkYXRlIHRoZSBDYXJyeS1Gb3J3YXJkIHNldHRpbmdzIGFuZCB0cnkgYWdhaW4uYCxcbiAgICAgIDEwMDAgKiAzMCAvLyAzMCBzZWNvbmRzXG4gICAgKTtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCBjdXJzb3JGcm9tID0gZWRpdG9yLmdldEN1cnNvcihcImZyb21cIik7XG4gIGNvbnN0IGN1cnNvclRvID0gZWRpdG9yLmdldEN1cnNvcihcInRvXCIpO1xuICBjb25zdCBtaW5MaW5lID0gY3Vyc29yRnJvbS5saW5lO1xuICBjb25zdCBtYXhMaW5lID0gY3Vyc29yVG8ubGluZTtcblxuICBjb25zdCB0cmFuc2FjdGlvbjogRWRpdG9yVHJhbnNhY3Rpb24gPSB7XG4gICAgY2hhbmdlczogW10sXG4gIH07XG5cbiAgY29uc3QgZmlsZSA9IHZpZXcuZmlsZTtcblxuICBjb25zdCB1cGRhdGVkTGluZXM6IHN0cmluZ1tdID0gW107XG4gIGNvbnN0IGNvcGllZExpbmVzOiBzdHJpbmdbXSA9IFtdO1xuICBsZXQgbmV3SUQgPSBcIlwiO1xuICBmb3IgKGxldCBsaW5lTnVtYmVyID0gbWluTGluZTsgbGluZU51bWJlciA8PSBtYXhMaW5lOyBsaW5lTnVtYmVyKyspIHtcbiAgICBsZXQgbGluZSA9IGVkaXRvci5nZXRMaW5lKGxpbmVOdW1iZXIpO1xuICAgIGxldCBjb3BpZWRMaW5lID0gbGluZTtcbiAgICBpZiAoXG4gICAgICBzZXR0aW5ncy5yZW1vdmVMZWFkaW5nV2hpdGVzcGFjZSA9PT0gdHJ1ZSAmJlxuICAgICAgbGluZU51bWJlciA9PT0gbWluTGluZSAmJlxuICAgICAgY3Vyc29yRnJvbS5jaCA9PT0gY3Vyc29yVG8uY2hcbiAgICApIHtcbiAgICAgIC8vIFJlbW92ZSBsZWFkaW5nIHdoaXRlc3BhY2UgaWYgdGhlIHVzZXIgaXMgY29weWluZyBhIGZ1bGwgbGluZSB3aXRob3V0XG4gICAgICAvLyBoYXZpbmcgc2VsZWN0ZWQgYSBzcGVjaWZpYyBwYXJ0IG9mIHRoZSBsaW5lOlxuICAgICAgY29waWVkTGluZSA9IGNvcGllZExpbmUucmVwbGFjZSgvXlxccyovLCBcIlwiKTtcbiAgICB9XG5cbiAgICBpZiAoXG4gICAgICAobGluZU51bWJlciA9PT0gbWluTGluZSB8fCBsaW5lTnVtYmVyID09PSBtYXhMaW5lKSAmJlxuICAgICAgIShtaW5MaW5lID09PSBtYXhMaW5lICYmIGN1cnNvckZyb20uY2ggPT09IGN1cnNvclRvLmNoKVxuICAgICkge1xuICAgICAgY29waWVkTGluZSA9IGxpbmUuc2xpY2UoXG4gICAgICAgIGxpbmVOdW1iZXIgPT09IG1pbkxpbmUgPyBjdXJzb3JGcm9tLmNoIDogMCxcbiAgICAgICAgbGluZU51bWJlciA9PT0gbWF4TGluZSA/IGN1cnNvclRvLmNoIDogbGluZS5sZW5ndGggLSAxXG4gICAgICApO1xuICAgIH1cblxuICAgIGlmIChcbiAgICAgIGVkaXRvci5nZXRMaW5lKGxpbmVOdW1iZXIpLm1hdGNoKC9eXFxzKiQvKSAmJlxuICAgICAgIShsaW5lTnVtYmVyID09PSBtaW5MaW5lICYmIG1pbkxpbmUgPT09IG1heExpbmUpXG4gICAgKSB7XG4gICAgICBjb3BpZWRMaW5lcy5wdXNoKGNvcGllZExpbmUpO1xuICAgICAgdXBkYXRlZExpbmVzLnB1c2gobGluZSk7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICBsZXQgbGlua1RleHQgPSBzZXR0aW5ncy5saW5rVGV4dDtcblxuICAgIGlmIChtb2RlID09PSBNb2RlLkxpbmtUZXh0RnJvbVNlbGVjdGlvbikge1xuICAgICAgbGlua1RleHQgPSBlZGl0b3IuZ2V0U2VsZWN0aW9uKCk7XG4gICAgfVxuICAgIGlmIChtb2RlID09PSBNb2RlLkxpbmtUZXh0RnJvbUNsaXBib2FyZCkge1xuICAgICAgbGlua1RleHQgPSBhd2FpdCBuYXZpZ2F0b3IuY2xpcGJvYXJkLnJlYWRUZXh0KCk7XG4gICAgfVxuXG4gICAgaWYgKGNvcHkgPT09IENvcHlUeXBlcy5TZXBhcmF0ZUxpbmVzIHx8IGxpbmVOdW1iZXIgPT09IG1pbkxpbmUpIHtcbiAgICAgIC8vIERvZXMgdGhlIGxpbmUgYWxyZWFkeSBoYXZlIGEgYmxvY2sgSUQ/XG4gICAgICBjb25zdCBibG9ja0lEID0gbGluZS5tYXRjaChibG9ja0lEUmVnZXgpO1xuICAgICAgbGV0IGxpbmsgPSBcIlwiO1xuICAgICAgaWYgKGJsb2NrSUQgPT09IG51bGwpIHtcbiAgICAgICAgLy8gVGhlcmUgaXMgTk9UIGFuIGV4aXN0aW5nIGxpbmUgSUQ6XG4gICAgICAgIG5ld0lEID0gYF4ke2dlbklEKCl9YDtcbiAgICAgICAgbGluayA9IHZpZXcuYXBwLmZpbGVNYW5hZ2VyLmdlbmVyYXRlTWFya2Rvd25MaW5rKFxuICAgICAgICAgIGZpbGUsXG4gICAgICAgICAgXCIvXCIsXG4gICAgICAgICAgYCMke25ld0lEfWAsXG4gICAgICAgICAgbGlua1RleHRcbiAgICAgICAgKTtcbiAgICAgICAgbGluZSA9IGxpbmUucmVwbGFjZSgvXFxzKj8kLywgYCAke25ld0lEfWApO1xuICAgICAgICBpZiAoY29weSA9PT0gQ29weVR5cGVzLkxpbmtPbmx5IHx8IGNvcHkgPT09IENvcHlUeXBlcy5MaW5rT25seUVtYmVkKSB7XG4gICAgICAgICAgbGluayA9IChjb3B5ID09PSBDb3B5VHlwZXMuTGlua09ubHlFbWJlZCA/IFwiIVwiIDogXCJcIikgKyBsaW5rO1xuICAgICAgICAgIGNvcGllZExpbmUgPVxuICAgICAgICAgICAgY29weSA9PT0gQ29weVR5cGVzLkxpbmtPbmx5RW1iZWRcbiAgICAgICAgICAgICAgPyBsaW5rXG4gICAgICAgICAgICAgIDogc2V0dGluZ3MuY29waWVkTGlua1RleHQucmVwbGFjZShcInt7TElOS319XCIsIGxpbmspO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvcGllZExpbmUgPSBjb3BpZWRMaW5lLnJlcGxhY2UoXG4gICAgICAgICAgICBuZXcgUmVnRXhwKHNldHRpbmdzLmxpbmVGb3JtYXRGcm9tLCBcInVcIiksXG4gICAgICAgICAgICBzZXR0aW5ncy5saW5lRm9ybWF0VG8ucmVwbGFjZShcInt7TElOS319XCIsIGxpbmspXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gVGhlcmUgSVMgYW4gZXhpc3RpbmcgbGluZSBJRDpcbiAgICAgICAgbGluayA9IHZpZXcuYXBwLmZpbGVNYW5hZ2VyLmdlbmVyYXRlTWFya2Rvd25MaW5rKFxuICAgICAgICAgIGZpbGUsXG4gICAgICAgICAgXCIvXCIsXG4gICAgICAgICAgYCMke2Jsb2NrSUR9YCxcbiAgICAgICAgICBsaW5rVGV4dFxuICAgICAgICApO1xuICAgICAgICBpZiAoY29weSA9PT0gQ29weVR5cGVzLkxpbmtPbmx5IHx8IGNvcHkgPT09IENvcHlUeXBlcy5MaW5rT25seUVtYmVkKSB7XG4gICAgICAgICAgbGluayA9IChjb3B5ID09PSBDb3B5VHlwZXMuTGlua09ubHlFbWJlZCA/IFwiIVwiIDogXCJcIikgKyBsaW5rO1xuICAgICAgICAgIGNvcGllZExpbmUgPVxuICAgICAgICAgICAgY29weSA9PT0gQ29weVR5cGVzLkxpbmtPbmx5RW1iZWRcbiAgICAgICAgICAgICAgPyBsaW5rXG4gICAgICAgICAgICAgIDogc2V0dGluZ3MuY29waWVkTGlua1RleHQucmVwbGFjZShcInt7TElOS319XCIsIGxpbmspO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvcGllZExpbmUgPSBjb3BpZWRMaW5lXG4gICAgICAgICAgICAucmVwbGFjZShibG9ja0lEUmVnZXgsIFwiXCIpXG4gICAgICAgICAgICAucmVwbGFjZShcbiAgICAgICAgICAgICAgbmV3IFJlZ0V4cChzZXR0aW5ncy5saW5lRm9ybWF0RnJvbSwgXCJ1XCIpLFxuICAgICAgICAgICAgICBzZXR0aW5ncy5saW5lRm9ybWF0VG8ucmVwbGFjZShcInt7TElOS319XCIsIGxpbmspXG4gICAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKFxuICAgICAgIShcbiAgICAgICAgKGNvcHkgPT09IENvcHlUeXBlcy5MaW5rT25seSB8fCBjb3B5ID09PSBDb3B5VHlwZXMuTGlua09ubHlFbWJlZCkgJiZcbiAgICAgICAgbGluZU51bWJlciAhPT0gbWluTGluZVxuICAgICAgKVxuICAgICkge1xuICAgICAgY29waWVkTGluZXMucHVzaChjb3BpZWRMaW5lKTtcbiAgICB9XG4gICAgdXBkYXRlZExpbmVzLnB1c2gobGluZSk7XG4gIH1cblxuICBuYXZpZ2F0b3IuY2xpcGJvYXJkLndyaXRlVGV4dChjb3BpZWRMaW5lcy5qb2luKFwiXFxuXCIpKS50aGVuKCgpID0+IHtcbiAgICBuZXcgTm90aWNlKFwiQ29waWVkXCIpO1xuICB9KTtcblxuICB0cmFuc2FjdGlvbi5jaGFuZ2VzPy5wdXNoKHtcbiAgICBmcm9tOiB7IGxpbmU6IG1pbkxpbmUsIGNoOiAwIH0sXG4gICAgdG86IHsgbGluZTogbWF4TGluZSwgY2g6IGVkaXRvci5nZXRMaW5lKG1heExpbmUpLmxlbmd0aCB9LFxuICAgIHRleHQ6IHVwZGF0ZWRMaW5lcy5qb2luKFwiXFxuXCIpLFxuICB9KTtcbiAgdHJhbnNhY3Rpb24uc2VsZWN0aW9uID0geyBmcm9tOiBjdXJzb3JGcm9tLCB0bzogY3Vyc29yVG8gfTtcbiAgZWRpdG9yLnRyYW5zYWN0aW9uKHRyYW5zYWN0aW9uKTtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIENhcnJ5Rm9yd2FyZFBsdWdpbiBleHRlbmRzIFBsdWdpbiB7XG4gIHNldHRpbmdzOiBDYXJyeUZvcndhcmRQbHVnaW5TZXR0aW5ncztcblxuICBhc3luYyBvbmxvYWQoKSB7XG4gICAgY29uc29sZS5sb2coXCJsb2FkaW5nIGNhcnJ5LWZvcndhcmQtbGluZSBwbHVnaW5cIik7XG5cbiAgICBhd2FpdCB0aGlzLmxvYWRTZXR0aW5ncygpO1xuXG4gICAgdGhpcy5hZGRDb21tYW5kKHtcbiAgICAgIGlkOiBcImNhcnJ5LWxpbmUtZm9yd2FyZC1zZXBhcmF0ZS1saW5lc1wiLFxuICAgICAgbmFtZTogXCJDb3B5IHNlbGVjdGlvbiB3aXRoIGVhY2ggbGluZSBsaW5rZWQgdG8gaXRzIGNvcGllZCBzb3VyY2UgKGRlZmF1bHQgbGluayB0ZXh0KVwiLFxuICAgICAgZWRpdG9yQ2FsbGJhY2s6IGFzeW5jIChlZGl0b3I6IEVkaXRvciwgdmlldzogTWFya2Rvd25WaWV3KSA9PiB7XG4gICAgICAgIHJldHVybiBhd2FpdCBjb3B5Rm9yd2FyZExpbmVzKFxuICAgICAgICAgIGVkaXRvcixcbiAgICAgICAgICB2aWV3LFxuICAgICAgICAgIHRoaXMuc2V0dGluZ3MsXG4gICAgICAgICAgQ29weVR5cGVzLlNlcGFyYXRlTGluZXNcbiAgICAgICAgKTtcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICB0aGlzLmFkZENvbW1hbmQoe1xuICAgICAgaWQ6IFwiY2FycnktbGluZS1mb3J3YXJkLWNvbWJpbmVkLWxpbmVzXCIsXG4gICAgICBuYW1lOiBcIkNvcHkgc2VsZWN0aW9uIHdpdGggZmlyc3QgbGluZSBsaW5rZWQgdG8gaXRzIGNvcGllZCBzb3VyY2UgKGRlZmF1bHQgbGluayB0ZXh0KVwiLFxuICAgICAgZWRpdG9yQ2FsbGJhY2s6IGFzeW5jIChlZGl0b3I6IEVkaXRvciwgdmlldzogTWFya2Rvd25WaWV3KSA9PiB7XG4gICAgICAgIHJldHVybiBhd2FpdCBjb3B5Rm9yd2FyZExpbmVzKFxuICAgICAgICAgIGVkaXRvcixcbiAgICAgICAgICB2aWV3LFxuICAgICAgICAgIHRoaXMuc2V0dGluZ3MsXG4gICAgICAgICAgQ29weVR5cGVzLkNvbWJpbmVkTGluZXNcbiAgICAgICAgKTtcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICB0aGlzLmFkZENvbW1hbmQoe1xuICAgICAgaWQ6IFwiY2FycnktbGluZS1mb3J3YXJkLWxpbmstb25seVwiLFxuICAgICAgbmFtZTogXCJDb3B5IGxpbmsgdG8gbGluZSAoZGVmYXVsdCBsaW5rIHRleHQpXCIsXG4gICAgICBlZGl0b3JDYWxsYmFjazogYXN5bmMgKGVkaXRvcjogRWRpdG9yLCB2aWV3OiBNYXJrZG93blZpZXcpID0+IHtcbiAgICAgICAgcmV0dXJuIGF3YWl0IGNvcHlGb3J3YXJkTGluZXMoXG4gICAgICAgICAgZWRpdG9yLFxuICAgICAgICAgIHZpZXcsXG4gICAgICAgICAgdGhpcy5zZXR0aW5ncyxcbiAgICAgICAgICBDb3B5VHlwZXMuTGlua09ubHlcbiAgICAgICAgKTtcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICB0aGlzLmFkZENvbW1hbmQoe1xuICAgICAgaWQ6IFwiY2FycnktbGluZS1mb3J3YXJkLWVtYmVkLWxpbmstb25seVwiLFxuICAgICAgbmFtZTogXCJDb3B5IGVtYmVkIGxpbmsgdG8gbGluZSAoZGVmYXVsdCBsaW5rIHRleHQpXCIsXG4gICAgICBlZGl0b3JDYWxsYmFjazogYXN5bmMgKGVkaXRvcjogRWRpdG9yLCB2aWV3OiBNYXJrZG93blZpZXcpID0+IHtcbiAgICAgICAgcmV0dXJuIGF3YWl0IGNvcHlGb3J3YXJkTGluZXMoXG4gICAgICAgICAgZWRpdG9yLFxuICAgICAgICAgIHZpZXcsXG4gICAgICAgICAgdGhpcy5zZXR0aW5ncyxcbiAgICAgICAgICBDb3B5VHlwZXMuTGlua09ubHlFbWJlZFxuICAgICAgICApO1xuICAgICAgfSxcbiAgICB9KTtcblxuICAgIHRoaXMuYWRkQ29tbWFuZCh7XG4gICAgICBpZDogXCJjYXJyeS1saW5lLWZvcndhcmQtc2VwYXJhdGUtbGluZXMtc2VsZWN0aW9uXCIsXG4gICAgICBuYW1lOiBcIkNvcHkgc2VsZWN0aW9uIHdpdGggZWFjaCBsaW5lIGxpbmtlZCB0byBpdHMgY29waWVkIHNvdXJjZSAobGluayB0ZXh0IGZyb20gc2VsZWN0aW9uKVwiLFxuICAgICAgZWRpdG9yQ2FsbGJhY2s6IGFzeW5jIChlZGl0b3I6IEVkaXRvciwgdmlldzogTWFya2Rvd25WaWV3KSA9PiB7XG4gICAgICAgIHJldHVybiBhd2FpdCBjb3B5Rm9yd2FyZExpbmVzKFxuICAgICAgICAgIGVkaXRvcixcbiAgICAgICAgICB2aWV3LFxuICAgICAgICAgIHRoaXMuc2V0dGluZ3MsXG4gICAgICAgICAgQ29weVR5cGVzLlNlcGFyYXRlTGluZXMsXG4gICAgICAgICAgTW9kZS5MaW5rVGV4dEZyb21TZWxlY3Rpb25cbiAgICAgICAgKTtcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICB0aGlzLmFkZENvbW1hbmQoe1xuICAgICAgaWQ6IFwiY2FycnktbGluZS1mb3J3YXJkLWNvbWJpbmVkLWxpbmVzLXNlbGVjdGlvblwiLFxuICAgICAgbmFtZTogXCJDb3B5IHNlbGVjdGlvbiB3aXRoIGZpcnN0IGxpbmUgbGlua2VkIHRvIGl0cyBjb3BpZWQgc291cmNlIChsaW5rIHRleHQgZnJvbSBzZWxlY3Rpb24pXCIsXG4gICAgICBlZGl0b3JDYWxsYmFjazogYXN5bmMgKGVkaXRvcjogRWRpdG9yLCB2aWV3OiBNYXJrZG93blZpZXcpID0+IHtcbiAgICAgICAgcmV0dXJuIGF3YWl0IGNvcHlGb3J3YXJkTGluZXMoXG4gICAgICAgICAgZWRpdG9yLFxuICAgICAgICAgIHZpZXcsXG4gICAgICAgICAgdGhpcy5zZXR0aW5ncyxcbiAgICAgICAgICBDb3B5VHlwZXMuQ29tYmluZWRMaW5lcyxcbiAgICAgICAgICBNb2RlLkxpbmtUZXh0RnJvbVNlbGVjdGlvblxuICAgICAgICApO1xuICAgICAgfSxcbiAgICB9KTtcblxuICAgIHRoaXMuYWRkQ29tbWFuZCh7XG4gICAgICBpZDogXCJjYXJyeS1saW5lLWZvcndhcmQtbGluay1vbmx5LXNlbGVjdGlvblwiLFxuICAgICAgbmFtZTogXCJDb3B5IGxpbmsgdG8gbGluZSAobGluayB0ZXh0IGZyb20gc2VsZWN0aW9uKVwiLFxuICAgICAgZWRpdG9yQ2FsbGJhY2s6IGFzeW5jIChlZGl0b3I6IEVkaXRvciwgdmlldzogTWFya2Rvd25WaWV3KSA9PiB7XG4gICAgICAgIHJldHVybiBhd2FpdCBjb3B5Rm9yd2FyZExpbmVzKFxuICAgICAgICAgIGVkaXRvcixcbiAgICAgICAgICB2aWV3LFxuICAgICAgICAgIHRoaXMuc2V0dGluZ3MsXG4gICAgICAgICAgQ29weVR5cGVzLkxpbmtPbmx5LFxuICAgICAgICAgIE1vZGUuTGlua1RleHRGcm9tU2VsZWN0aW9uXG4gICAgICAgICk7XG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgdGhpcy5hZGRDb21tYW5kKHtcbiAgICAgIGlkOiBcImNhcnJ5LWxpbmUtZm9yd2FyZC1lbWJlZC1saW5rLW9ubHktc2VsZWN0aW9uXCIsXG4gICAgICBuYW1lOiBcIkNvcHkgZW1iZWQgbGluayB0byBsaW5lIChsaW5rIHRleHQgZnJvbSBzZWxlY3Rpb24pXCIsXG4gICAgICBlZGl0b3JDYWxsYmFjazogYXN5bmMgKGVkaXRvcjogRWRpdG9yLCB2aWV3OiBNYXJrZG93blZpZXcpID0+IHtcbiAgICAgICAgcmV0dXJuIGF3YWl0IGNvcHlGb3J3YXJkTGluZXMoXG4gICAgICAgICAgZWRpdG9yLFxuICAgICAgICAgIHZpZXcsXG4gICAgICAgICAgdGhpcy5zZXR0aW5ncyxcbiAgICAgICAgICBDb3B5VHlwZXMuTGlua09ubHlFbWJlZCxcbiAgICAgICAgICBNb2RlLkxpbmtUZXh0RnJvbVNlbGVjdGlvblxuICAgICAgICApO1xuICAgICAgfSxcbiAgICB9KTtcblxuICAgIHRoaXMuYWRkQ29tbWFuZCh7XG4gICAgICBpZDogXCJjYXJyeS1saW5lLWZvcndhcmQtc2VwYXJhdGUtbGluZXMtY2xpcGJvYXJkXCIsXG4gICAgICBuYW1lOiBcIkNvcHkgc2VsZWN0aW9uIHdpdGggZWFjaCBsaW5lIGxpbmtlZCB0byBpdHMgY29waWVkIHNvdXJjZSAobGluayB0ZXh0IGZyb20gY2xpcGJvYXJkKVwiLFxuICAgICAgZWRpdG9yQ2FsbGJhY2s6IGFzeW5jIChlZGl0b3I6IEVkaXRvciwgdmlldzogTWFya2Rvd25WaWV3KSA9PiB7XG4gICAgICAgIHJldHVybiBhd2FpdCBjb3B5Rm9yd2FyZExpbmVzKFxuICAgICAgICAgIGVkaXRvcixcbiAgICAgICAgICB2aWV3LFxuICAgICAgICAgIHRoaXMuc2V0dGluZ3MsXG4gICAgICAgICAgQ29weVR5cGVzLlNlcGFyYXRlTGluZXMsXG4gICAgICAgICAgTW9kZS5MaW5rVGV4dEZyb21DbGlwYm9hcmRcbiAgICAgICAgKTtcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICB0aGlzLmFkZENvbW1hbmQoe1xuICAgICAgaWQ6IFwiY2FycnktbGluZS1mb3J3YXJkLWNvbWJpbmVkLWxpbmVzLWNsaXBib2FyZFwiLFxuICAgICAgbmFtZTogXCJDb3B5IHNlbGVjdGlvbiB3aXRoIGZpcnN0IGxpbmUgbGlua2VkIHRvIGl0cyBjb3BpZWQgc291cmNlIChsaW5rIHRleHQgZnJvbSBjbGlwYm9hcmQpXCIsXG4gICAgICBlZGl0b3JDYWxsYmFjazogYXN5bmMgKGVkaXRvcjogRWRpdG9yLCB2aWV3OiBNYXJrZG93blZpZXcpID0+IHtcbiAgICAgICAgcmV0dXJuIGF3YWl0IGNvcHlGb3J3YXJkTGluZXMoXG4gICAgICAgICAgZWRpdG9yLFxuICAgICAgICAgIHZpZXcsXG4gICAgICAgICAgdGhpcy5zZXR0aW5ncyxcbiAgICAgICAgICBDb3B5VHlwZXMuQ29tYmluZWRMaW5lcyxcbiAgICAgICAgICBNb2RlLkxpbmtUZXh0RnJvbUNsaXBib2FyZFxuICAgICAgICApO1xuICAgICAgfSxcbiAgICB9KTtcblxuICAgIHRoaXMuYWRkQ29tbWFuZCh7XG4gICAgICBpZDogXCJjYXJyeS1saW5lLWZvcndhcmQtbGluay1vbmx5LWNsaXBib2FyZFwiLFxuICAgICAgbmFtZTogXCJDb3B5IGxpbmsgdG8gbGluZSAobGluayB0ZXh0IGZyb20gY2xpcGJvYXJkKVwiLFxuICAgICAgZWRpdG9yQ2FsbGJhY2s6IGFzeW5jIChlZGl0b3I6IEVkaXRvciwgdmlldzogTWFya2Rvd25WaWV3KSA9PiB7XG4gICAgICAgIHJldHVybiBhd2FpdCBjb3B5Rm9yd2FyZExpbmVzKFxuICAgICAgICAgIGVkaXRvcixcbiAgICAgICAgICB2aWV3LFxuICAgICAgICAgIHRoaXMuc2V0dGluZ3MsXG4gICAgICAgICAgQ29weVR5cGVzLkxpbmtPbmx5LFxuICAgICAgICAgIE1vZGUuTGlua1RleHRGcm9tQ2xpcGJvYXJkXG4gICAgICAgICk7XG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgdGhpcy5hZGRDb21tYW5kKHtcbiAgICAgIGlkOiBcImNhcnJ5LWxpbmUtZm9yd2FyZC1lbWJlZC1saW5rLW9ubHktY2xpcGJvYXJkXCIsXG4gICAgICBuYW1lOiBcIkNvcHkgZW1iZWQgbGluayB0byBsaW5lIChsaW5rIHRleHQgZnJvbSBjbGlwYm9hcmQpXCIsXG4gICAgICBlZGl0b3JDYWxsYmFjazogYXN5bmMgKGVkaXRvcjogRWRpdG9yLCB2aWV3OiBNYXJrZG93blZpZXcpID0+IHtcbiAgICAgICAgcmV0dXJuIGF3YWl0IGNvcHlGb3J3YXJkTGluZXMoXG4gICAgICAgICAgZWRpdG9yLFxuICAgICAgICAgIHZpZXcsXG4gICAgICAgICAgdGhpcy5zZXR0aW5ncyxcbiAgICAgICAgICBDb3B5VHlwZXMuTGlua09ubHlFbWJlZCxcbiAgICAgICAgICBNb2RlLkxpbmtUZXh0RnJvbUNsaXBib2FyZFxuICAgICAgICApO1xuICAgICAgfSxcbiAgICB9KTtcblxuICAgIHRoaXMuYWRkU2V0dGluZ1RhYihuZXcgQ2FycnlGb3J3YXJkU2V0dGluZ1RhYih0aGlzLmFwcCwgdGhpcykpO1xuICB9XG5cbiAgb251bmxvYWQoKSB7XG4gICAgY29uc29sZS5sb2coXCJ1bmxvYWRpbmcgY2FycnktZm9yd2FyZC1saW5lIHBsdWdpblwiKTtcbiAgfVxuXG4gIGFzeW5jIGxvYWRTZXR0aW5ncygpIHtcbiAgICB0aGlzLnNldHRpbmdzID0gT2JqZWN0LmFzc2lnbih7fSwgREVGQVVMVF9TRVRUSU5HUywgYXdhaXQgdGhpcy5sb2FkRGF0YSgpKTtcbiAgfVxuXG4gIGFzeW5jIHNhdmVTZXR0aW5ncygpIHtcbiAgICBhd2FpdCB0aGlzLnNhdmVEYXRhKHRoaXMuc2V0dGluZ3MpO1xuICB9XG59XG5cbmNvbnN0IHZhbGlkYXRlUmVnZXggPSAoXG4gIHJlZ2V4U3RyaW5nOiBzdHJpbmdcbik6IHsgdmFsaWQ6IGJvb2xlYW4gfCBudWxsOyBzdHJpbmc6IHN0cmluZyB9ID0+IHtcbiAgbGV0IHVwZGF0ZWRSZWdleFN0cmluZyA9IHJlZ2V4U3RyaW5nXG4gICAgLy8gQmVjYXVzZSB0aGUgcGx1Z2luJ3Mgc2V0dGluZ3MgYXJlIHN0b3JlZCBpbiBKU09OLCBjaGFyYWN0ZXJzIGxpa2VcbiAgICAvLyBcXG4gZ2V0IGRvdWJsZS1lc2NhcGVkLCBhbmQgdGhlbiBkbyBub3QgZ2V0IHJlcGxhY2VkIGF1dG9tYXRpY2FsbHlcbiAgICAvLyBvbiB1c2UuIFRoaXMgd2FzIGNhdXNpbmcgVG8gc3RyaW5ncyBub3QgdG8gcGFyc2UgXFxuLCBldGMuXG4gICAgLnJlcGxhY2UoL1xcXFxuL2csIFwiXFxuXCIpXG4gICAgLnJlcGxhY2UoL1xcXFx0L2csIFwiXFx0XCIpXG4gICAgLnJlcGxhY2UoL1xcXFxyL2csIFwiXFxyXCIpO1xuXG4gIHRyeSB7XG4gICAgbmV3IFJlZ0V4cCh1cGRhdGVkUmVnZXhTdHJpbmcsIFwidVwiKTtcbiAgICByZXR1cm4geyB2YWxpZDogdHJ1ZSwgc3RyaW5nOiB1cGRhdGVkUmVnZXhTdHJpbmcgfTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIHJldHVybiB7XG4gICAgICB2YWxpZDogZmFsc2UsXG4gICAgICBzdHJpbmc6IGBcIiR7dXBkYXRlZFJlZ2V4U3RyaW5nfVwiOiBcIiR7ZX1cImAsXG4gICAgfTtcbiAgfVxufTtcblxuY2xhc3MgQ2FycnlGb3J3YXJkU2V0dGluZ1RhYiBleHRlbmRzIFBsdWdpblNldHRpbmdUYWIge1xuICBwbHVnaW46IENhcnJ5Rm9yd2FyZFBsdWdpbjtcblxuICBjb25zdHJ1Y3RvcihhcHA6IEFwcCwgcGx1Z2luOiBDYXJyeUZvcndhcmRQbHVnaW4pIHtcbiAgICBzdXBlcihhcHAsIHBsdWdpbik7XG4gICAgdGhpcy5wbHVnaW4gPSBwbHVnaW47XG4gIH1cblxuICBkaXNwbGF5KCk6IHZvaWQge1xuICAgIGxldCB7IGNvbnRhaW5lckVsIH0gPSB0aGlzO1xuXG4gICAgY29udGFpbmVyRWwuZW1wdHkoKTtcblxuICAgIGNvbnRhaW5lckVsLmNyZWF0ZUVsKFwiaDFcIiwgeyB0ZXh0OiBcIkNhcnJ5LWZvcndhcmRcIiB9KTtcblxuICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgLnNldE5hbWUoXCJEZWZhdWx0IGxpbmsgdGV4dFwiKVxuICAgICAgLnNldERlc2MoXG4gICAgICAgICdUaGUgZGVmYXVsdCB0ZXh0IHRoYXQgXCJ7e0xJTkt9fVwiIGluIHRoZSBzZXR0aW5ncyBiZWxvdyB3aWxsIGJlIHJlcGxhY2VkIHdpdGguIExlYXZpbmcgdGhpcyBibGFuayB3aWxsIGRpc3BsYXkgdGhlIGFjdHVhbCB0ZXh0IG9mIHRoZSBsaW5rLidcbiAgICAgIClcbiAgICAgIC5hZGRUZXh0KCh0ZXh0KSA9PiB7XG4gICAgICAgIGNvbnN0IHNldHRpbmdzID0gdGhpcy5wbHVnaW4uc2V0dGluZ3M7XG4gICAgICAgIHRleHQuc2V0VmFsdWUoc2V0dGluZ3MubGlua1RleHQpLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgICAgIHNldHRpbmdzLmxpbmtUZXh0ID0gdmFsdWU7XG4gICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG5cbiAgICBjb25zdCBjb3BpZWRMaW5rc0VsID0gY29udGFpbmVyRWwuY3JlYXRlRWwoXCJkaXZcIik7XG4gICAgY29waWVkTGlua3NFbC5jcmVhdGVFbChcImgyXCIsIHsgdGV4dDogXCJDb3BpZWQgcmVmZXJlbmNlc1wiIH0pO1xuXG4gICAgY29waWVkTGlua3NFbC5jcmVhdGVFbChcInBcIiwge1xuICAgICAgdGV4dDogJ1NldHRpbmdzIHJlbGF0aW5nIHRvIFwiQ29weSBsaW5rIHRvIGxpbmUuLi5cIiBhbmQgXCJDb3B5IGVtYmVkIGxpbmsgdG8gbGluZS4uLlwiIGNvbW1hbmRzLicsXG4gICAgICBjbHM6IFwic2V0dGluZy1pdGVtLWRlc2NyaXB0aW9uXCIsXG4gICAgfSk7XG5cbiAgICBuZXcgU2V0dGluZyhjb3BpZWRMaW5rc0VsKVxuICAgICAgLnNldE5hbWUoXCJDb3BpZWQgcmVmZXJlbmNlc1wiKVxuICAgICAgLnNldERlc2MoXG4gICAgICAgIFwiVGhlIGZ1bGwgdGV4dCBvZiBjb3BpZWQgcmVmZXJlbmNlcy4gVXNlIHt7TElOS319IHRvIHBsYWNlIHRoZSBsaW5rLlwiXG4gICAgICApXG4gICAgICAuYWRkVGV4dCgodGV4dCkgPT4ge1xuICAgICAgICBjb25zdCBzZXR0aW5ncyA9IHRoaXMucGx1Z2luLnNldHRpbmdzO1xuICAgICAgICB0ZXh0LnNldFZhbHVlKHNldHRpbmdzLmNvcGllZExpbmtUZXh0KS5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICBzZXR0aW5ncy5jb3BpZWRMaW5rVGV4dCA9IHZhbHVlO1xuICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuXG4gICAgY29uc3QgY29waWVkTGluZXNFbCA9IGNvbnRhaW5lckVsLmNyZWF0ZUVsKFwiZGl2XCIpO1xuICAgIGNvcGllZExpbmVzRWwuY3JlYXRlRWwoXCJoMlwiLCB7IHRleHQ6IFwiQ29waWVkIGxpbmVzXCIgfSk7XG4gICAgY29waWVkTGluZXNFbC5jcmVhdGVFbChcInBcIiwge1xuICAgICAgdGV4dDogJ1NldHRpbmdzIHJlbGF0aW5nIHRvIFwiQ29weSBzZWxlY3Rpb24uLi5cIiBjb21tYW5kcy4nLFxuICAgICAgY2xzOiBcInNldHRpbmctaXRlbS1kZXNjcmlwdGlvblwiLFxuICAgIH0pO1xuXG4gICAgY29uc3QgZnJvbVRvRWwgPSBjb3BpZWRMaW5lc0VsLmNyZWF0ZUVsKFwiZGl2XCIpO1xuICAgIGZyb21Ub0VsLmFkZENsYXNzKFwiZnJvbS10by1ydWxlXCIpO1xuXG4gICAgaWYgKHZhbGlkYXRlUmVnZXgodGhpcy5wbHVnaW4uc2V0dGluZ3MubGluZUZvcm1hdEZyb20pLnZhbGlkICE9PSB0cnVlKSB7XG4gICAgICBmcm9tVG9FbC5hZGRDbGFzcyhcImludmFsaWRcIik7XG4gICAgfVxuXG4gICAgbmV3IFNldHRpbmcoZnJvbVRvRWwpXG4gICAgICAuc2V0TmFtZShcIkZyb21cIilcbiAgICAgIC5zZXREZXNjKFxuICAgICAgICBcIkZpbmQgdGhlIGZpcnN0IG1hdGNoIG9mIGEgUmVndWxhciBFeHByZXNzaW9uIGluIGVhY2ggY29waWVkIGxpbmVcIlxuICAgICAgKVxuICAgICAgLmFkZFRleHQoKHRleHQpID0+XG4gICAgICAgIHRleHRcbiAgICAgICAgICAuc2V0UGxhY2Vob2xkZXIoREVGQVVMVF9TRVRUSU5HUy5saW5lRm9ybWF0RnJvbSlcbiAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MubGluZUZvcm1hdEZyb20pXG4gICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgaWYgKHZhbHVlID09PSBcIlwiKSB7XG4gICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmxpbmVGb3JtYXRGcm9tID1cbiAgICAgICAgICAgICAgICBERUZBVUxUX1NFVFRJTkdTLmxpbmVGb3JtYXRGcm9tO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgaWYgKHZhbGlkYXRlUmVnZXgodmFsdWUpLnZhbGlkICE9PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgZnJvbVRvRWwuYWRkQ2xhc3MoXCJpbnZhbGlkXCIpO1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGZyb21Ub0VsLnJlbW92ZUNsYXNzKFwiaW52YWxpZFwiKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5saW5lRm9ybWF0RnJvbSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgfSlcbiAgICAgICk7XG5cbiAgICBuZXcgU2V0dGluZyhmcm9tVG9FbClcbiAgICAgIC5zZXROYW1lKFwiVG9cIilcbiAgICAgIC5zZXREZXNjKFxuICAgICAgICBcIlJlcGxhY2UgdGhlIGZpcnN0IG1hdGNoIGluIGVhY2ggY29waWVkIGxpbmUgd2l0aCB0ZXh0LiBVc2Uge3tMSU5LfX0gdG8gcGxhY2UgdGhlIGxpbmsuXCJcbiAgICAgIClcbiAgICAgIC5hZGRUZXh0KCh0ZXh0KSA9PlxuICAgICAgICB0ZXh0XG4gICAgICAgICAgLnNldFBsYWNlaG9sZGVyKERFRkFVTFRfU0VUVElOR1MubGluZUZvcm1hdFRvKVxuICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5saW5lRm9ybWF0VG8pXG4gICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgaWYgKHZhbHVlID09PSBcIlwiKSB7XG4gICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmxpbmVGb3JtYXRUbyA9IERFRkFVTFRfU0VUVElOR1MubGluZUZvcm1hdFRvO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MubGluZUZvcm1hdFRvID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICB9KVxuICAgICAgKTtcblxuICAgIG5ldyBTZXR0aW5nKGNvcGllZExpbmVzRWwpXG4gICAgICAuc2V0TmFtZShcIlJlbW92ZSBsZWFkaW5nIHdoaXRlc3BhY2UgZnJvbSBmaXJzdCBsaW5lXCIpXG4gICAgICAuc2V0RGVzYyhcbiAgICAgICAgXCJXaGVuIGNvcHlpbmcgYSBsaW5lIHdpdGhvdXQgaGF2aW5nIHNlbGVjdGVkIGEgc3BlY2lmaWMgcGFydCBvZiB0aGF0IGxpbmUsIHJlbW92ZSBhbnkgd2hpdGVzcGFjZSBhdCB0aGUgYmVnaW5uaW5nIG9mIHRoZSBjb3BpZWQgbGluZS5cIlxuICAgICAgKVxuICAgICAgLmFkZFRvZ2dsZSgodG9nZ2xlKSA9PiB7XG4gICAgICAgIGNvbnN0IHNldHRpbmdzID0gdGhpcy5wbHVnaW4uc2V0dGluZ3M7XG4gICAgICAgIHRvZ2dsZVxuICAgICAgICAgIC5zZXRWYWx1ZShzZXR0aW5ncy5yZW1vdmVMZWFkaW5nV2hpdGVzcGFjZSlcbiAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICBzZXR0aW5ncy5yZW1vdmVMZWFkaW5nV2hpdGVzcGFjZSA9IHZhbHVlO1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgfVxufVxuIl0sIm5hbWVzIjpbIk5vdGljZSIsIlBsdWdpbiIsIlBsdWdpblNldHRpbmdUYWIiLCJTZXR0aW5nIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBdURBO0FBQ08sU0FBUyxTQUFTLENBQUMsT0FBTyxFQUFFLFVBQVUsRUFBRSxDQUFDLEVBQUUsU0FBUyxFQUFFO0FBQzdELElBQUksU0FBUyxLQUFLLENBQUMsS0FBSyxFQUFFLEVBQUUsT0FBTyxLQUFLLFlBQVksQ0FBQyxHQUFHLEtBQUssR0FBRyxJQUFJLENBQUMsQ0FBQyxVQUFVLE9BQU8sRUFBRSxFQUFFLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFO0FBQ2hILElBQUksT0FBTyxLQUFLLENBQUMsS0FBSyxDQUFDLEdBQUcsT0FBTyxDQUFDLEVBQUUsVUFBVSxPQUFPLEVBQUUsTUFBTSxFQUFFO0FBQy9ELFFBQVEsU0FBUyxTQUFTLENBQUMsS0FBSyxFQUFFLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLE9BQU8sQ0FBQyxFQUFFLEVBQUUsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRTtBQUNuRyxRQUFRLFNBQVMsUUFBUSxDQUFDLEtBQUssRUFBRSxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLE9BQU8sQ0FBQyxFQUFFLEVBQUUsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRTtBQUN0RyxRQUFRLFNBQVMsSUFBSSxDQUFDLE1BQU0sRUFBRSxFQUFFLE1BQU0sQ0FBQyxJQUFJLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsR0FBRyxL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
