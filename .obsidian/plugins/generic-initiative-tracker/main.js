(()=>{"use strict";var e={d:(t,n)=>{for(var i in n)e.o(n,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:n[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};function n(e,t,n,i){return new(n||(n=Promise))((function(r,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}l((i=i.apply(e,t||[])).next())}))}e.r(t),e.d(t,{default:()=>Zn}),Object.create,Object.create;const i=require("obsidian"),r="initiative-tracker-view",a="â€“",s={players:[],homebrew:[],version:null,canUseDiceRoll:!1,initiative:"1d20 + %mod%",sync:!1,leafletIntegration:!1,playerMarker:"default",monsterMarker:"default",state:{creatures:[],state:!1,current:null,name:null}},o="initiative-tracker",l="crossed-swords",c="initiative-tracker-save",u="initiative-tracker-add",d="trash",p="initiative-tracker-play",h="initiative-tracker-forward",f="initiative-tracker-backward",v="initiative-tracker-stop",m="initiative-tracker-hp",g="initiative-tracker-ac",w="initiative-tracker-hamburger",y="initiative-tracker-disable",b="initiative-tracker-enable",x="initiative-tracker-edit",k="initiative-tracker-tags",C="initiative-tracker-initiative",$="initiative-tracker-redo",E="initiative-tracker-new",S="initiative-tracker-dice",I="initiative-tracker-copy";class O extends i.PluginSettingTab{constructor(e){super(e.app,e),this.plugin=e}display(){return n(this,void 0,void 0,(function*(){try{let{containerEl:e}=this;e.empty(),e.addClass("initiative-tracker-settings"),e.createEl("h2",{text:"Initiative Tracker Settings"});const t=e.createDiv("initiative-tracker-additional-container");if(this._displayPlayers(t),this.plugin.canUseStatBlocks){const t=e.createDiv("initiative-sync");if(new i.Setting(t).setName("Sync Monsters from 5e Statblocks").setDesc("Homebrew creatures saved to the 5e Statblocks plugin will be available in the quick-add.").addToggle((e=>{e.setValue(this.plugin.data.sync),e.onChange((e=>n(this,void 0,void 0,(function*(){this.plugin.data.sync=e,yield this.plugin.saveSettings(),this.display()}))))})),this.plugin.data.sync){const e=new i.Setting(t).setDesc(`${this.plugin.statblock_creatures.length} creatures synced.`);e.settingEl.addClass("initiative-synced"),(0,i.setIcon)(e.nameEl,"check-in-circle"),e.nameEl.appendChild(createSpan({text:"Synced"}))}}const r=new i.Setting(e).setName("Initiative Formula").addText((e=>{this.plugin.canUseDiceRoller||(e.setDisabled(!0),this.plugin.data.initiative="1d20 + %mod%"),e.setValue(this.plugin.data.initiative),e.onChange((e=>{this.plugin.data.initiative=e})),e.inputEl.onblur=()=>n(this,void 0,void 0,(function*(){this.plugin.view&&this.plugin.view.rollInitiatives(),yield this.plugin.saveSettings()}))}));r.descEl.createSpan({text:"Initiative formula to use when calculating initiative. Use "}),r.descEl.createEl("code",{text:"%mod%"}),r.descEl.createSpan({text:" for the modifier placeholder."}),this.plugin.canUseDiceRoller||(r.descEl.createEl("br"),r.descEl.createEl("br"),r.descEl.createSpan({attr:{style:"color: var(--text-error);"},text:"Requires the "}),r.descEl.createEl("a",{text:"Dice Roller",href:"https://github.com/valentine195/obsidian-dice-roller",cls:"external-link"}),r.descEl.createSpan({attr:{style:"color: var(--text-error);"},text:" plugin to modify."}))}catch(e){console.error(e),new i.Notice("There was an error displaying the settings tab for Obsidian Initiative Tracker.")}}))}_displayPlayers(e){var t,r,s;e.empty();const o=e.createDiv("additional");new i.Setting(o).setName("Add New Player").setDesc("These players will always be added to new encounters.").addButton((t=>t.setTooltip("Add Player").setButtonText("+").onClick((()=>n(this,void 0,void 0,(function*(){const t=new T(this.plugin);t.open(),t.onClose=()=>n(this,void 0,void 0,(function*(){t.saved&&(yield this.plugin.savePlayer(Object.assign(Object.assign({},t.player),{player:!0})),this._displayPlayers(e))}))}))))));const l=o.createDiv("initiative-tracker-players");if(this.plugin.data.players.length){const o=l.createDiv("initiative-tracker-player headers");o.createDiv({text:"Name"}),new i.ExtraButtonComponent(o.createDiv()).setIcon(m).setTooltip("Max HP"),new i.ExtraButtonComponent(o.createDiv()).setIcon(g).setTooltip("Armor Class"),new i.ExtraButtonComponent(o.createDiv()).setIcon(C).setTooltip("Initiative Modifier"),o.createDiv();for(let o of this.plugin.data.players){const c=l.createDiv("initiative-tracker-player");c.createDiv({text:o.name}),c.createDiv({text:`${null!==(t=o.hp)&&void 0!==t?t:a}`}),c.createDiv({text:`${null!==(r=o.ac)&&void 0!==r?r:a}`}),c.createDiv({text:`${null!==(s=o.modifier)&&void 0!==s?s:a}`});const u=c.createDiv("initiative-tracker-player-icon");new i.ExtraButtonComponent(u.createDiv()).setIcon(x).setTooltip("Edit").onClick((()=>{const t=new T(this.plugin,o);t.open(),t.onClose=()=>n(this,void 0,void 0,(function*(){t.saved&&(yield this.plugin.updatePlayer(o,t.player),this.plugin.app.workspace.trigger("initiative-tracker:creature-updated-in-settings",o),this._displayPlayers(e))}))})),new i.ExtraButtonComponent(u.createDiv()).setIcon("trash").setTooltip("Delete").onClick((()=>n(this,void 0,void 0,(function*(){this.plugin.data.players=this.plugin.data.players.filter((e=>e!=o)),yield this.plugin.saveSettings(),this._displayPlayers(e)}))))}}else o.createDiv({attr:{style:"display: flex; justify-content: center; padding-bottom: 18px;"}}).createSpan({text:"No saved players! Create one to see it here."})}}class T extends i.Modal{constructor(e,t){super(e.app),this.plugin=e,this.original=t,this.player=Object.assign({},null!=t?t:{})}display(e){return n(this,void 0,void 0,(function*(){let t,r,a,s,{contentEl:o}=this;o.addClass("initiative-tracker-add-player-modal"),o.empty(),o.createEl("h2",{text:this.original?"Edit Player":"New Player"}),new i.Setting(o).setName("Name").setDesc("Player name. Must be unique!").addText((n=>{var i;t={input:n.inputEl,validate:t=>{let n=!1;return(!t.value.length&&!e||this.plugin.data.players.find((e=>e.name===t.value))&&this.player.name!=this.original.name)&&(t.addClass("has-error"),n=!0),n}},n.setValue(null!==(i=this.player.name)&&void 0!==i?i:""),n.onChange((e=>{n.inputEl.removeClass("has-error"),this.player.name=e}))})),new i.Setting(o).setName("Max Hit Points").addText((e=>{var t;r={input:e.inputEl,validate:e=>{let t=!1;return isNaN(Number(e.value))&&(e.addClass("has-error"),t=!0),t}},e.setValue(`${null!==(t=this.player.hp)&&void 0!==t?t:""}`),e.onChange((t=>{e.inputEl.removeClass("has-error"),this.player.hp=Number(t)}))})),new i.Setting(o).setName("Armor Class").addText((e=>{var t;a={input:e.inputEl,validate:t=>{let n=!1;return isNaN(Number(t.value))&&(e.inputEl.addClass("has-error"),n=!0),n}},e.setValue(`${null!==(t=this.player.ac)&&void 0!==t?t:""}`),e.onChange((t=>{e.inputEl.removeClass("has-error"),this.player.ac=Number(t)}))})),new i.Setting(o).setName("Initiative Modifier").setDesc("This will be added to randomly-rolled initiatives.").addText((e=>{var t;s={input:e.inputEl,validate:t=>{let n=!1;return isNaN(Number(t.value))&&(e.inputEl.addClass("has-error"),n=!0),n}},e.setValue(`${null!==(t=this.player.modifier)&&void 0!==t?t:""}`),e.onChange((e=>{this.player.modifier=Number(e)}))}));let l=o.createDiv(),c=new i.Setting(l);c.addButton((e=>(e.setTooltip("Save").setIcon("checkmark").onClick((()=>n(this,void 0,void 0,(function*(){this.validateInputs(t,a,r,s)?new i.Notice("Fix errors before saving."):(this.saved=!0,this.close())})))),e))),c.addExtraButton((e=>(e.setIcon("cross").setTooltip("Cancel").onClick((()=>{this.saved=!1,this.close()})),e))),this.validateInputs(t,a,r,s)}))}validateInputs(...e){let t=!1;for(let n of e)n.validate(n.input)?t=!0:n.input.removeClass("has-error");return t}onOpen(){this.display(!0)}}class j{constructor(e,t=0){var n,i;this.enabled=!0,this.status=new Set,this.name=e.name,this.modifier=Number(null!==(n=e.modifier)&&void 0!==n?n:0),this._initiative=Number(null!=t?t:0)-this.modifier,this.max=e.hp?Number(e.hp):void 0,this.ac=e.ac?Number(e.ac):void 0,this.note=e.note,this.player=e.player,this.marker=e.marker,this.hp=this.max,this.source=e.source,this.id=null!==(i=e.id)&&void 0!==i?i:"ID_xyxyxyxyxyxy".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}get hpDisplay(){return this.max?`${this.hp}/${this.max}`:a}get initiative(){return this._initiative+this.modifier}set initiative(e){this._initiative=Number(e)-this.modifier}*[Symbol.iterator](){yield this.name,yield this.initiative,yield this.modifier,yield this.max,yield this.ac,yield this.note,yield this.id,yield this.marker}static from(e){const t="modifier"in e?e.modifier:Math.floor((("stats"in e&&e.stats.length>1?e.stats[1]:10)-10)/2);return new j(Object.assign(Object.assign({},e),{modifier:t}),0)}update(e){var t;this.name=e.name,this.modifier=Number(null!==(t=e.modifier)&&void 0!==t?t:0),this.max=e.hp?Number(e.hp):void 0,this.hp>this.max&&(this.hp=this.max),this.ac=e.ac?Number(e.ac):void 0,this.note=e.note,this.player=e.player,this.marker=e.marker,this.source=e.source}toProperties(){return Object.assign({},this)}toJSON(){return{name:this.name,initiative:this.initiative-this.modifier,modifier:this.modifier,hp:this.max,ac:this.ac,note:this.note,id:this.id,marker:this.marker,currentHP:this.hp,status:Array.from(this.status),enabled:this.enabled,player:this.player}}static fromJSON(e){const t=new j(e,e.initiative);return t.enabled=e.enabled,t.hp=e.currentHP,t.status=new Set(e.status),t}}function N(){}function M(e){return e()}function D(){return Object.create(null)}function A(e){e.forEach(M)}function z(e){return"function"==typeof e}function P(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function B(e){return 0===Object.keys(e).length}function L(e){return e&&z(e.destroy)?e.destroy:N}new Set;let _,H=!1;function V(e,t){e.appendChild(t)}function R(e,t,n){const i=function(e){if(!e)return document;const t=e.getRootNode?e.getRootNode():e.ownerDocument;return t&&t.host?t:e.ownerDocument}(e);if(!i.getElementById(t)){const e=F("style");e.id=t,e.textContent=n,function(e,t){V(e.head||e,t)}(i,e)}}function W(e,t,n){e.insertBefore(t,n||null)}function q(e){e.parentNode.removeChild(e)}function U(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function F(e){return document.createElement(e)}function Y(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function J(e){return document.createTextNode(e)}function X(){return J(" ")}function G(e,t,n,i){return e.addEventListener(t,n,i),()=>e.removeEventListener(t,n,i)}function K(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function Q(e){return""===e?null:+e}function Z(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}function ee(e,t){e.value=null==t?"":t}function te(e,t,n){e.classList[n?"add":"remove"](t)}function ne(e){_=e}function ie(){if(!_)throw new Error("Function called outside component initialization");return _}function re(){const e=ie();return(t,n)=>{const i=e.$$.callbacks[t];if(i){const r=function(e,t,n=!1){const i=document.createEvent("CustomEvent");return i.initCustomEvent(e,n,!1,t),i}(t,n);i.slice().forEach((t=>{t.call(e,r)}))}}}new Set;const ae=[],se=[],oe=[],le=[],ce=Promise.resolve();let ue=!1;function de(e){oe.push(e)}let pe=!1;const he=new Set;function fe(){if(!pe){pe=!0;do{for(let e=0;e<ae.length;e+=1){const t=ae[e];ne(t),ve(t.$$)}for(ne(null),ae.length=0;se.length;)se.pop()();for(let e=0;e<oe.length;e+=1){const t=oe[e];he.has(t)||(he.add(t),t())}oe.length=0}while(ae.length);for(;le.length;)le.pop()();ue=!1,pe=!1,he.clear()}}function ve(e){if(null!==e.fragment){e.update(),A(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(de)}}const me=new Set;let ge,we;function ye(){ge={r:0,c:[],p:ge}}function be(){ge.r||A(ge.c),ge=ge.p}function xe(e,t){e&&e.i&&(me.delete(e),e.i(t))}function ke(e,t,n,i){if(e&&e.o){if(me.has(e))return;me.add(e),ge.c.push((()=>{me.delete(e),i&&(n&&e.d(1),i())})),e.o(t)}}function Ce(e){e&&e.c()}function $e(e,t,n,i){const{fragment:r,on_mount:a,on_destroy:s,after_update:o}=e.$$;r&&r.m(t,n),i||de((()=>{const t=a.map(M).filter(z);s?s.push(...t):A(t),e.$$.on_mount=[]})),o.forEach(de)}function Ee(e,t){const n=e.$$;null!==n.fragment&&(A(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function Se(e,t,n,i,r,a,s,o=[-1]){const l=_;ne(e);const c=e.$$={fragment:null,ctx:null,props:a,update:N,not_equal:r,bound:D(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(l?l.$$.context:t.context||[]),callbacks:D(),dirty:o,skip_bound:!1,root:t.target||l.$$.root};s&&s(c.root);let u=!1;if(c.ctx=n?n(e,t.props||{},((t,n,...i)=>{const a=i.length?i[0]:n;return c.ctx&&r(c.ctx[t],c.ctx[t]=a)&&(!c.skip_bound&&c.bound[t]&&c.bound[t](a),u&&function(e,t){-1===e.$$.dirty[0]&&(ae.push(e),ue||(ue=!0,ce.then(fe)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}(e,t)),n})):[],c.update(),u=!0,A(c.before_update),c.fragment=!!i&&i(c.ctx),t.target){if(t.hydrate){H=!0;const e=(d=t.target,Array.from(d.childNodes));c.fragment&&c.fragment.l(e),e.forEach(q)}else c.fragment&&c.fragment.c();t.intro&&xe(e.$$.fragment),$e(e,t.target,t.anchor,t.customElement),H=!1,fe()}var d;ne(l)}"undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global,new Set(["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"]),"function"==typeof HTMLElement&&(we=class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){const{on_mount:e}=this.$$;this.$$.on_disconnect=e.map(M).filter(z);for(const e in this.$$.slotted)this.appendChild(this.$$.slotted[e])}attributeChangedCallback(e,t,n){this[e]=n}disconnectedCallback(){A(this.$$.on_disconnect)}$destroy(){Ee(this,1),this.$destroy=N}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){this.$$set&&!B(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}});class Ie{$destroy(){Ee(this,1),this.$destroy=N}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){this.$$set&&!B(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}function Oe(e){R(e,"svelte-u7pobm",".encounter-name.svelte-u7pobm.svelte-u7pobm{display:flex;justify-content:flex-start;align-items:center}.encounter-instance.svelte-u7pobm>.creatures-container>.encounter-creatures:first-of-type h4.svelte-u7pobm,.encounter-creatures.svelte-u7pobm>ul.svelte-u7pobm{margin-top:0}.creature-li.svelte-u7pobm.svelte-u7pobm{width:fit-content}")}function Te(e,t,n){const i=e.slice();return i[8]=t[n][0],i[9]=t[n][1],i}function je(e,t,n){const i=e.slice();return i[12]=t[n],i}function Ne(e){let t;return{c(){t=F("div"),t.innerHTML='<h4 class="svelte-u7pobm">No Players</h4>',K(t,"class","encounter-creatures encounter-players")},m(e,n){W(e,t,n)},p:N,d(e){e&&q(t)}}}function Me(e){let t,n,i,r,a=e[2],s=[];for(let t=0;t<a.length;t+=1)s[t]=De(je(e,a,t));return{c(){t=F("div"),n=F("h4"),n.textContent="Players",i=X(),r=F("ul");for(let e=0;e<s.length;e+=1)s[e].c();K(n,"class","svelte-u7pobm"),K(r,"class","svelte-u7pobm"),K(t,"class","encounter-creatures encounter-players svelte-u7pobm")},m(e,a){W(e,t,a),V(t,n),V(t,i),V(t,r);for(let e=0;e<s.length;e+=1)s[e].m(r,null)},p(e,t){if(4&t){let n;for(a=e[2],n=0;n<a.length;n+=1){const i=je(e,a,n);s[n]?s[n].p(i,t):(s[n]=De(i),s[n].c(),s[n].m(r,null))}for(;n<s.length;n+=1)s[n].d(1);s.length=a.length}},d(e){e&&q(t),U(s,e)}}}function De(e){let t,n,i,r,a,s,o=e[12]+"";return{c(){t=F("li"),n=F("a"),i=J(o),s=X(),K(n,"data-href",r=e[12]),K(n,"href",a=e[12]),K(n,"class","internal-link"),K(n,"target","_blank"),K(n,"rel","noopener")},m(e,r){W(e,t,r),V(t,n),V(n,i),V(t,s)},p(e,t){4&t&&o!==(o=e[12]+"")&&Z(i,o),4&t&&r!==(r=e[12])&&K(n,"data-href",r),4&t&&a!==(a=e[12])&&K(n,"href",a)},d(e){e&&q(t)}}}function Ae(e){let t;return{c(){t=F("strong"),t.textContent="No creatures"},m(e,n){W(e,t,n)},p:N,d(e){e&&q(t)}}}function ze(e){let t,n=e[3],i=[];for(let t=0;t<n.length;t+=1)i[t]=Pe(Te(e,n,t));return{c(){t=F("ul");for(let e=0;e<i.length;e+=1)i[e].c();K(t,"class","svelte-u7pobm")},m(e,n){W(e,t,n);for(let e=0;e<i.length;e+=1)i[e].m(t,null)},p(e,r){if(40&r){let a;for(n=e[3],a=0;a<n.length;a+=1){const s=Te(e,n,a);i[a]?i[a].p(s,r):(i[a]=Pe(s),i[a].c(),i[a].m(t,null))}for(;a<i.length;a+=1)i[a].d(1);i.length=n.length}},d(e){e&&q(t),U(i,e)}}}function Pe(e){let t,n,i,r,a,s,o,l,c,u,d=e[9]+"",p=e[8].name+"";return{c(){t=F("li"),n=F("strong"),i=J(d),r=J("Â "),a=F("a"),s=J(p),c=X(),K(a,"data-href",o=e[8].name),K(a,"href",l=e[8].name),K(a,"class","internal-link"),K(a,"target","_blank"),K(a,"rel","noopener"),K(t,"aria-label",u=e[5](e[8])),K(t,"class","creature-li svelte-u7pobm")},m(e,o){W(e,t,o),V(t,n),V(n,i),V(t,r),V(t,a),V(a,s),V(t,c)},p:N,d(e){e&&q(t)}}}function Be(e){let t,n,i,r,a,s,o,l,c,u,d,p,h,f,v;function m(e,t){return e[2]instanceof Array&&e[2].length?Me:e[2]?void 0:Ne}let g=m(e),w=g&&g(e);function y(e,t){return e[1].length?ze:Ae}let b=y(e),x=b(e);return{c(){t=F("div"),n=F("div"),i=F("div"),a=X(),s=F("h3"),o=J(e[0]),l=X(),c=F("div"),w&&w.c(),u=X(),d=F("div"),p=F("h4"),p.textContent="Creatures",h=X(),x.c(),K(s,"data-heading",e[0]),K(s,"class","initiative-tracker-name"),K(n,"class","encounter-name svelte-u7pobm"),K(p,"class","svelte-u7pobm"),K(d,"class","encounter-creatures svelte-u7pobm"),K(c,"class","creatures-container"),K(t,"class","encounter-instance svelte-u7pobm")},m(m,g){W(m,t,g),V(t,n),V(n,i),V(n,a),V(n,s),V(s,o),V(t,l),V(t,c),w&&w.m(c,null),V(c,u),V(c,d),V(d,p),V(d,h),x.m(d,null),f||(v=L(r=e[4].call(null,i)),f=!0)},p(e,[t]){1&t&&Z(o,e[0]),1&t&&K(s,"data-heading",e[0]),g===(g=m(e))&&w?w.p(e,t):(w&&w.d(1),w=g&&g(e),w&&(w.c(),w.m(c,u))),b===(b=y(e))&&x?x.p(e,t):(x.d(1),x=b(e),x&&(x.c(),x.m(d,null)))},i:N,o:N,d(e){e&&q(t),w&&w.d(),x.d(),f=!1,v()}}}function Le(e,t,n){const r=re();let{name:a="Encounter"}=t,{creatures:s=[]}=t,{players:o=!0}=t;const c=[],u=(e,t)=>e.name==t.name&&e.ac==t.ac&&e.hp==t.hp&&e.modifier==t.modifier;for(let e of s){const t={name:e.name,ac:e.ac,hp:e.hp,modifier:e.modifier},n=c.find((([e])=>u(e,t)));n?c.splice(c.indexOf(n),1,[n[0],n[1]+1]):c.push([t,1])}return e.$$set=e=>{"name"in e&&n(0,a=e.name),"creatures"in e&&n(1,s=e.creatures),"players"in e&&n(2,o=e.players)},[a,s,o,c,e=>{new i.ExtraButtonComponent(e).setIcon(l).setTooltip("Begin Encounter").onClick((()=>{r("begin-encounter")}))},e=>{if(!e)return;let t=[];return e.hp&&t.push(`HP: ${e.hp}`),e.ac&&t.push(`AC: ${e.ac}`),e.modifier&&t.push(`MOD: ${e.modifier}`),`${t.join(", ")}`}]}const _e=class extends Ie{constructor(e){super(),Se(this,e,Le,Be,P,{name:0,creatures:1,players:2},Oe)}},He=[];const Ve={view:function(e,t=N){let n;const i=new Set;function r(t){if(P(e,t)&&(e=t,n)){const t=!He.length;for(const t of i)t[1](),He.push(t,e);if(t){for(let e=0;e<He.length;e+=2)He[e][0](He[e+1]);He.length=0}}}return{set:r,update:function(t){r(t(e))},subscribe:function(a,s=N){const o=[a,s];return i.add(o),1===i.size&&(n=t(r)||N),a(e),()=>{i.delete(o),0===i.size&&(n(),n=null)}}}}()};function Re(e){R(e,"svelte-g63m31",".buttons.svelte-g63m31.svelte-g63m31{display:flex;justify-content:space-between;padding:0 0 0.5rem 0}.state.svelte-g63m31.svelte-g63m31{display:flex;justify-content:flex-start;align-items:center}.clean.svelte-g63m31.svelte-g63m31{display:flex;justify-content:flex-end;align-items:center}.state.svelte-g63m31>.svelte-g63m31:not(:last-child),.clean.svelte-g63m31>.svelte-g63m31:not(:last-child){margin-right:0.25rem}")}function We(e){let t,n,i,r;return{c(){t=F("div"),K(t,"class","svelte-g63m31")},m(a,s){W(a,t,s),i||(r=L(n=e[1].call(null,t)),i=!0)},d(e){e&&q(t),i=!1,r()}}}function qe(e){let t,n,i,r,a,s,o,l,c,u;return{c(){t=F("div"),i=X(),r=F("div"),s=X(),o=F("div"),K(t,"class","svelte-g63m31"),K(r,"class","svelte-g63m31"),K(o,"class","svelte-g63m31")},m(d,p){W(d,t,p),W(d,i,p),W(d,r,p),W(d,s,p),W(d,o,p),c||(u=[L(n=e[2].call(null,t)),L(a=e[4].call(null,r)),L(l=e[3].call(null,o))],c=!0)},d(e){e&&q(t),e&&q(i),e&&q(r),e&&q(s),e&&q(o),c=!1,A(u)}}}function Ue(e){let t,n,i,r,a,s,o,l,c,u,d,p,h,f;function v(e,t){return e[0]?qe:We}let m=v(e),g=m(e);return{c(){t=F("div"),n=F("div"),g.c(),i=X(),r=F("div"),a=F("div"),o=X(),l=F("div"),u=X(),d=F("div"),K(n,"class","state svelte-g63m31"),K(a,"class","svelte-g63m31"),K(l,"class","svelte-g63m31"),K(d,"class","svelte-g63m31"),K(r,"class","clean svelte-g63m31"),K(t,"class","buttons svelte-g63m31")},m(v,m){W(v,t,m),V(t,n),g.m(n,null),V(t,i),V(t,r),V(r,a),V(r,o),V(r,l),V(r,u),V(r,d),h||(f=[L(s=e[7].call(null,a)),L(c=e[5].call(null,l)),L(p=e[6].call(null,d))],h=!0)},p(e,[t]){m!==(m=v(e))&&(g.d(1),g=m(e),g&&(g.c(),g.m(n,null)))},i:N,o:N,d(e){e&&q(t),g.d(),h=!1,A(f)}}}function Fe(e,t,n){let r,{state:a=!1}=t;return Ve.view.subscribe((e=>{r=e})),e.$$set=e=>{"state"in e&&n(0,a=e.state)},[a,e=>{new i.ExtraButtonComponent(e).setIcon(p).setTooltip("Play").onClick((()=>{r.toggleState(),n(0,a=r.state)}))},e=>{new i.ExtraButtonComponent(e).setIcon(v).setTooltip("Stop").onClick((()=>{r.toggleState(),n(0,a=r.state)}))},e=>{new i.ExtraButtonComponent(e).setIcon(h).setTooltip("Next").onClick((()=>{r.goToNext()}))},e=>{new i.ExtraButtonComponent(e).setIcon(f).setTooltip("Previous").onClick((()=>{r.goToPrevious()}))},e=>{new i.ExtraButtonComponent(e).setIcon($).setTooltip("Reset HP & Status").onClick((()=>{r.resetEncounter()}))},e=>{new i.ExtraButtonComponent(e).setIcon(E).setTooltip("New Encounter").onClick((()=>{r.newEncounter()}))},e=>{new i.ExtraButtonComponent(e).setIcon(S).setTooltip("Re-roll Initiatives").onClick((()=>{r.rollInitiatives()}))}]}const Ye=class extends Ie{constructor(e){super(),Se(this,e,Fe,Ue,P,{state:0},Re)}};function Je(e){R(e,"svelte-r8zdh4",".tag.svelte-r8zdh4{display:flex;align-items:center;padding-right:0px;margin-right:0.125rem}")}function Xe(e){let t,n,i,r,a,s,o,l,c,u=e[0].name+"";return{c(){t=F("div"),n=F("span"),i=J(u),r=X(),a=F("div"),K(t,"class","tag svelte-r8zdh4"),K(t,"aria-label",o=e[0].description),K(t,"aria-label-classes","initiative-tracker-condition-tooltip")},m(o,u){W(o,t,u),V(t,n),V(n,i),V(t,r),V(t,a),l||(c=L(s=e[1].call(null,a)),l=!0)},p(e,[n]){1&n&&u!==(u=e[0].name+"")&&Z(i,u),1&n&&o!==(o=e[0].description)&&K(t,"aria-label",o)},i:N,o:N,d(e){e&&q(t),l=!1,c()}}}function Ge(e,t,n){const r=re();let{status:a}=t;return e.$$set=e=>{"status"in e&&n(0,a=e.status)},[a,e=>{new i.ExtraButtonComponent(e).setIcon("cross-in-box").onClick((()=>{r("remove")})).extraSettingsEl.setAttr("style","margin-left: 3px;")}]}const Ke=class extends Ie{constructor(e){super(),Se(this,e,Ge,Xe,P,{status:0},Je)}};function Qe(e){R(e,"svelte-8bdvrx",'.initiative-tracker-creature.svelte-8bdvrx.svelte-8bdvrx{width:100%;padding:0.5rem 0;display:contents}.initiative-tracker-creature.disabled.svelte-8bdvrx .svelte-8bdvrx{color:var(--text-faint)}.active-holder.svelte-8bdvrx.svelte-8bdvrx{margin-left:-0.5rem}.tree-item-flair-outer.svelte-8bdvrx.svelte-8bdvrx::after{content:""}.initiative-tracker-creature.svelte-8bdvrx .initiative.svelte-8bdvrx{display:block;padding:0;width:20px;text-align:center;white-space:nowrap;margin-left:-0.5rem;user-select:all;border:0;color:inherit}.initiative-tracker-creature.svelte-8bdvrx .name.svelte-8bdvrx{display:block;text-align:left;background-color:inherit;border:0;font-size:smaller;padding:0;height:unset;word-break:keep-all}.statuses.svelte-8bdvrx.svelte-8bdvrx{grid-column:span 4;font-size:smaller;margin-bottom:0.5rem;display:flex;flex-flow:row wrap}.center.svelte-8bdvrx.svelte-8bdvrx{text-align:center}.editable.svelte-8bdvrx.svelte-8bdvrx:not(.player){cursor:pointer}.controls.svelte-8bdvrx.svelte-8bdvrx{display:flex;justify-content:flex-end}.add-button.svelte-8bdvrx.svelte-8bdvrx{display:none}.show.svelte-8bdvrx.svelte-8bdvrx{display:block}')}function Ze(e,t,n){const i=e.slice();return i[19]=t[n],i}function et(e){let t,n;return{c(){t=Y("svg"),n=Y("path"),K(n,"fill","currentColor"),K(n,"d","M224.3 273l-136 136c-9.4 9.4-24.6 9.4-33.9 0l-22.6-22.6c-9.4-9.4-9.4-24.6 0-33.9l96.4-96.4-96.4-96.4c-9.4-9.4-9.4-24.6 0-33.9L54.3 103c9.4-9.4 24.6-9.4 33.9 0l136 136c9.5 9.4 9.5 24.6.1 34z"),K(n,"class","svelte-8bdvrx"),K(t,"xmlns","http://www.w3.org/2000/svg"),K(t,"aria-hidden","true"),K(t,"focusable","false"),K(t,"data-prefix","fas"),K(t,"data-icon","angle-right"),K(t,"class","svg-inline--fa fa-angle-right fa-w-8 svelte-8bdvrx"),K(t,"role","img"),K(t,"viewBox","0 0 256 512")},m(e,i){W(e,t,i),V(t,n)},d(e){e&&q(t)}}}function tt(e){let t,n,i,r,a=e[0].name+"";return{c(){t=F("span"),n=J(a),K(t,"contenteditable",""),K(t,"class","editable name svelte-8bdvrx"),K(t,"type","text")},m(a,s){W(a,t,s),V(t,n),i||(r=[G(t,"blur",e[8]),G(t,"keydown",ut)],i=!0)},p(e,t){1&t&&a!==(a=e[0].name+"")&&Z(n,a)},d(e){e&&q(t),i=!1,A(r)}}}function nt(e){let t,n,i=e[0].name+"";return{c(){t=F("small"),n=J(i),K(t,"class","name svelte-8bdvrx")},m(e,i){W(e,t,i),V(t,n)},p(e,t){1&t&&i!==(i=e[0].name+"")&&Z(n,i)},d(e){e&&q(t)}}}function it(e){let t,n,i,r;return{c(){t=F("div"),K(t,"class","add-button enable svelte-8bdvrx"),te(t,"show",!e[1])},m(a,s){W(a,t,s),i||(r=L(n=e[11].call(null,t)),i=!0)},p(e,n){2&n&&te(t,"show",!e[1])},d(e){e&&q(t),i=!1,r()}}}function rt(e){let t,n,i,r;return{c(){t=F("div"),K(t,"class","add-button enable svelte-8bdvrx"),te(t,"show",!e[1])},m(a,s){W(a,t,s),i||(r=L(n=e[12].call(null,t)),i=!0)},p(e,n){2&n&&te(t,"show",!e[1])},d(e){e&&q(t),i=!1,r()}}}function at(e){let t,n,i,r;return{c(){t=F("div"),K(t,"class","add-button marker svelte-8bdvrx"),te(t,"show",!e[1])},m(a,s){W(a,t,s),i||(r=L(n=e[13].call(null,t)),i=!0)},p(e,n){2&n&&te(t,"show",!e[1])},d(e){e&&q(t),i=!1,r()}}}function st(e){let t,n;return t=new Ke({props:{status:e[19]}}),t.$on("remove",(function(){return e[18](e[19])})),{c(){Ce(t.$$.fragment)},m(e,i){$e(t,e,i),n=!0},p(n,i){e=n;const r={};64&i&&(r.status=e[19]),t.$set(r)},i(e){n||(xe(t.$$.fragment,e),n=!0)},o(e){ke(t.$$.fragment,e),n=!1},d(e){Ee(t,e)}}}function ot(e){let t,n,i,r,s,o,l,c,u,d,p,h,f,v,m,g,w,y,b,x,k,C,$,E,S,I,O,T,j,N,M,D,z,P,B,_,H=e[0].hpDisplay+"",R=(e[0].ac??a)+"",Y=e[2]&&e[3]&&et();function Q(e,t){return e[0].player?nt:tt}let ee=Q(e),ne=ee(e);function ie(e,t){return e[0].enabled?rt:it}let re=ie(e),ae=re(e),se=e[4].plugin.data.leafletIntegration&&at(e),oe=e[6],le=[];for(let t=0;t<oe.length;t+=1)le[t]=st(Ze(e,oe,t));const ce=e=>ke(le[e],1,1,(()=>{le[e]=null}));return{c(){t=F("div"),n=F("span"),Y&&Y.c(),i=X(),r=F("div"),s=F("input"),c=X(),ne.c(),u=X(),d=F("div"),p=F("span"),h=J(H),f=X(),v=F("span"),m=J(R),g=X(),w=F("div"),y=F("div"),x=X(),k=F("div"),$=X(),ae.c(),E=X(),se&&se.c(),S=X(),I=F("div"),T=X(),j=F("span"),N=X(),M=F("span"),D=X(),z=F("div");for(let e=0;e<le.length;e+=1)le[e].c();K(n,"class","active-holder svelte-8bdvrx"),K(s,"class","editable initiative tree-item-flair svelte-8bdvrx"),K(s,"aria-label",o=`${e[0].initiative-e[0].modifier} + ${e[0].modifier}`),s.value=l=e[0].initiative,K(r,"class","tree-item-flair-outer svelte-8bdvrx"),K(p,"class","editable svelte-8bdvrx"),K(d,"class","center svelte-8bdvrx"),K(v,"class","center svelte-8bdvrx"),K(y,"class","add-button icon svelte-8bdvrx"),te(y,"show",e[1]),K(k,"class","add-button tags svelte-8bdvrx"),te(k,"show",!e[1]),K(I,"class","add-button delete svelte-8bdvrx"),te(I,"show",!e[1]),K(w,"class","controls svelte-8bdvrx"),K(j,"class","svelte-8bdvrx"),K(M,"class","svelte-8bdvrx"),K(z,"class","statuses svelte-8bdvrx"),K(t,"class","initiative-tracker-creature svelte-8bdvrx"),te(t,"disabled",!e[0].enabled)},m(a,o){W(a,t,o),V(t,n),Y&&Y.m(n,null),V(t,i),V(t,r),V(r,s),e[16](s),V(t,c),ne.m(t,null),V(t,u),V(t,d),V(d,p),V(p,h),V(t,f),V(t,v),V(v,m),V(t,g),V(t,w),V(w,y),V(w,x),V(w,k),V(w,$),ae.m(w,null),V(w,E),se&&se.m(w,null),V(w,S),V(w,I),V(t,T),V(t,j),V(t,N),V(t,M),V(t,D),V(t,z);for(let e=0;e<le.length;e+=1)le[e].m(z,null);P=!0,B||(_=[G(s,"click",lt),G(s,"blur",e[15]),G(s,"keydown",ct),G(p,"click",e[17]),L(b=e[14].call(null,y)),L(C=e[10].call(null,k)),L(O=e[9].call(null,I))],B=!0)},p(e,[i]){if(e[2]&&e[3]?Y||(Y=et(),Y.c(),Y.m(n,null)):Y&&(Y.d(1),Y=null),(!P||1&i&&o!==(o=`${e[0].initiative-e[0].modifier} + ${e[0].modifier}`))&&K(s,"aria-label",o),(!P||1&i&&l!==(l=e[0].initiative)&&s.value!==l)&&(s.value=l),ee===(ee=Q(e))&&ne?ne.p(e,i):(ne.d(1),ne=ee(e),ne&&(ne.c(),ne.m(t,u))),(!P||1&i)&&H!==(H=e[0].hpDisplay+"")&&Z(h,H),(!P||1&i)&&R!==(R=(e[0].ac??a)+"")&&Z(m,R),2&i&&te(y,"show",e[1]),2&i&&te(k,"show",!e[1]),re===(re=ie(e))&&ae?ae.p(e,i):(ae.d(1),ae=re(e),ae&&(ae.c(),ae.m(w,E))),e[4].plugin.data.leafletIntegration?se?se.p(e,i):(se=at(e),se.c(),se.m(w,S)):se&&(se.d(1),se=null),2&i&&te(I,"show",!e[1]),81&i){let t;for(oe=e[6],t=0;t<oe.length;t+=1){const n=Ze(e,oe,t);le[t]?(le[t].p(n,i),xe(le[t],1)):(le[t]=st(n),le[t].c(),xe(le[t],1),le[t].m(z,null))}for(ye(),t=oe.length;t<le.length;t+=1)ce(t);be()}1&i&&te(t,"disabled",!e[0].enabled)},i(e){if(!P){for(let e=0;e<oe.length;e+=1)xe(le[e]);P=!0}},o(e){le=le.filter(Boolean);for(let e=0;e<le.length;e+=1)ke(le[e]);P=!1},d(n){n&&q(t),Y&&Y.d(),e[16](null),ne.d(),ae.d(),se&&se.d(),U(le,n),B=!1,A(_)}}}const lt=function(e){this.select()},ct=function(e){return"Enter"===e.key||"Tab"===e.key?(e.preventDefault(),void this.blur()):/^(\d*\.?\d*|Backspace|Delete|Arrow\w+)$/.test(e.key)?void 0:(e.preventDefault(),!1)},ut=function(e){if("Enter"===e.key||"Tab"===e.key)return e.preventDefault(),void this.blur()};function dt(e,t,n){let r,{creature:a}=t,{show:s}=t,{state:o}=t;const l=re();let c;Ve.view.subscribe((e=>{n(4,c=e)}));let u,{active:p=!1}=t;var h;return h=()=>{n(5,u.value=`${a.initiative}`,u)},ie().$$.after_update.push(h),e.$$set=e=>{"creature"in e&&n(0,a=e.creature),"show"in e&&n(1,s=e.show),"state"in e&&n(2,o=e.state),"active"in e&&n(3,p=e.active)},e.$$.update=()=>{1&e.$$.dirty&&n(6,r=Array.from(a.status))},[a,s,o,p,c,u,r,l,e=>{c.updateCreature(a,{name:e.target.textContent})},e=>{new i.ExtraButtonComponent(e).setTooltip("Remove").setIcon(d).onClick((()=>{c.removeCreature(a)}))},e=>{new i.ExtraButtonComponent(e).setTooltip("Add Status").setIcon(k).onClick((()=>{l("tag",a)}))},e=>{new i.ExtraButtonComponent(e).setTooltip("Enable").setIcon(b).onClick((()=>{c.setCreatureState(a,!0)}))},e=>{new i.ExtraButtonComponent(e).setTooltip("Disable").setIcon(y).onClick((()=>{c.setCreatureState(a,!1)}))},e=>{new i.ExtraButtonComponent(e).setTooltip("Change Marker").extraSettingsEl.onclick=e=>{const t=new i.Menu(c.plugin.app);t.setNoIcon();for(let e of c.plugin.leaflet.markerIcons)t.addItem((t=>{t.setTitle(e.type),t.onClick((()=>{c.updateCreature(a,{marker:e.type})}))}));t.showAtPosition({x:e.clientX,y:e.clientY})}},e=>{new i.ExtraButtonComponent(e).setIcon(w).setTooltip("Actions").extraSettingsEl.onclick=e=>{const t=new i.Menu(c.plugin.app);t.addItem((e=>{e.setIcon(k).setTitle("Add Status").onClick((()=>{l("tag",a)}))})),a.enabled?t.addItem((e=>{e.setIcon(y).setTitle("Disable").onClick((()=>{c.setCreatureState(a,!1)}))})):t.addItem((e=>{e.setIcon(b).setTitle("Enable").onClick((()=>{c.setCreatureState(a,!0)}))})),c.plugin.data.leafletIntegration&&t.addItem((e=>{e.setTitle("Change Marker").onClick((e=>{const t=new i.Menu(c.plugin.app);t.setNoIcon();for(let e of c.plugin.leaflet.markerIcons)t.addItem((t=>{t.setTitle(e.type),t.onClick((()=>{c.updateCreature(a,{marker:e.type})}))}));t.showAtMouseEvent(e)}))})),t.addItem((e=>{e.setIcon(d).setTitle("Remove").onClick((()=>{c.removeCreature(a)}))})),t.showAtPosition(e)}},function(e){const t=this.value;if(isNaN(Number(t))||Number(t)<1)return new i.Notice("Enter a valid initiative."),void(this.value=`${a.initiative}`);a.initiative!=Number(t)&&c.updateCreature(a,{initiative:t})},function(e){se[e?"unshift":"push"]((()=>{u=e,n(5,u)}))},()=>{l("hp",a)},e=>{c.removeStatus(a,e)}]}const pt=class extends Ie{constructor(e){super(),Se(this,e,dt,ot,P,{creature:0,show:1,state:2,active:3},Qe)}};function ht(e){R(e,"svelte-19yavkh",".no-creatures.svelte-19yavkh{margin:1rem;text-align:center}.initiative-tracker-table.svelte-19yavkh{padding:0.5rem;display:grid;grid-template-columns:0rem auto /* 12px */ 1fr auto auto auto;align-items:center;gap:0 0.5rem;width:100%;margin-left:0rem}.left.svelte-19yavkh{text-align:left}.center.svelte-19yavkh{text-align:center}.tracker-table-header.svelte-19yavkh{display:contents;font-weight:bolder}")}function ft(e,t,n){const i=e.slice();return i[11]=t[n],i}function vt(e){let t;return{c(){t=F("div"),t.innerHTML="<p>Add a creature to get started!</p> \n            <small>Players may be created in settings.</small>",K(t,"class","no-creatures svelte-19yavkh")},m(e,n){W(e,t,n)},p:N,i:N,o:N,d(e){e&&q(t)}}}function mt(e){let t,n,i,r,a,s,o,l,c,u,d,p,h,f,v,m,g,w,y,b=e[0],x=[];for(let t=0;t<b.length;t+=1)x[t]=gt(ft(e,b,t));const k=e=>ke(x[e],1,1,(()=>{x[e]=null}));return{c(){t=F("div"),n=F("div"),i=F("span"),r=X(),a=F("span"),s=X(),o=F("span"),o.textContent="Name",l=X(),c=F("span"),d=X(),p=F("span"),f=X(),v=F("span"),m=X();for(let e=0;e<x.length;e+=1)x[e].c();K(o,"class","left svelte-19yavkh"),K(c,"class","center svelte-19yavkh"),K(p,"class","center svelte-19yavkh"),K(n,"class","tracker-table-header svelte-19yavkh"),K(t,"class","initiative-tracker-table svelte-19yavkh")},m(b,k){W(b,t,k),V(t,n),V(n,i),V(n,r),V(n,a),V(n,s),V(n,o),V(n,l),V(n,c),V(n,d),V(n,p),V(n,f),V(n,v),V(t,m);for(let e=0;e<x.length;e+=1)x[e].m(t,null);e[10](t),g=!0,w||(y=[L(u=e[6].call(null,c)),L(h=e[7].call(null,p))],w=!0)},p(e,n){if(47&n){let i;for(b=e[0],i=0;i<b.length;i+=1){const r=ft(e,b,i);x[i]?(x[i].p(r,n),xe(x[i],1)):(x[i]=gt(r),x[i].c(),xe(x[i],1),x[i].m(t,null))}for(ye(),i=b.length;i<x.length;i+=1)k(i);be()}},i(e){if(!g){for(let e=0;e<b.length;e+=1)xe(x[e]);g=!0}},o(e){x=x.filter(Boolean);for(let e=0;e<x.length;e+=1)ke(x[e]);g=!1},d(n){n&&q(t),U(x,n),e[10](null),w=!1,A(y)}}}function gt(e){let t,n;return t=new pt({props:{creature:e[11],show:e[1],state:e[2],active:e[0][e[3]]==e[11]}}),t.$on("hp",e[8]),t.$on("tag",e[9]),{c(){Ce(t.$$.fragment)},m(e,i){$e(t,e,i),n=!0},p(e,n){const i={};1&n&&(i.creature=e[11]),2&n&&(i.show=e[1]),4&n&&(i.state=e[2]),9&n&&(i.active=e[0][e[3]]==e[11]),t.$set(i)},i(e){n||(xe(t.$$.fragment,e),n=!0)},o(e){ke(t.$$.fragment,e),n=!1},d(e){Ee(t,e)}}}function wt(e){let t,n,i,r;const a=[mt,vt],s=[];function o(e,t){return e[0].length?0:1}return n=o(e),i=s[n]=a[n](e),{c(){t=F("div"),i.c()},m(e,i){W(e,t,i),s[n].m(t,null),r=!0},p(e,[r]){let l=n;n=o(e),n===l?s[n].p(e,r):(ye(),ke(s[l],1,1,(()=>{s[l]=null})),be(),i=s[n],i?i.p(e,r):(i=s[n]=a[n](e),i.c()),xe(i,1),i.m(t,null))},i(e){r||(xe(i),r=!0)},o(e){ke(i),r=!1},d(e){e&&q(t),s[n].d()}}}function yt(e,t,n){const r=re();let a,{creatures:s=[]}=t,{show:o=!1}=t,{state:l}=t,{current:c}=t;return e.$$set=e=>{"creatures"in e&&n(0,s=e.creatures),"show"in e&&n(1,o=e.show),"state"in e&&n(2,l=e.state),"current"in e&&n(3,c=e.current)},[s,o,l,c,a,r,e=>{(0,i.setIcon)(e,m)},e=>{(0,i.setIcon)(e,g)},e=>r("update-hp",e.detail),e=>r("update-tags",e.detail),function(e){se[e?"unshift":"push"]((()=>{a=e,n(4,a)}))}]}const bt=class extends Ie{constructor(e){super(),Se(this,e,yt,wt,P,{creatures:0,show:1,state:2,current:3},ht)}};function xt(e){R(e,"svelte-1rjv45j",".create-new.svelte-1rjv45j>.svelte-1rjv45j{display:grid;grid-template-columns:33% 66%;margin-bottom:0.5rem}.context-buttons.svelte-1rjv45j.svelte-1rjv45j{display:flex;justify-content:flex-end;align-items:center;grid-gap:0.125rem}.cancel-button.svelte-1rjv45j.svelte-1rjv45j{color:var(--text-faint)}.initiative.svelte-1rjv45j.svelte-1rjv45j{position:relative}.initiative.svelte-1rjv45j>.dice.svelte-1rjv45j{position:absolute;right:0.25rem;top:50%;transform:translateY(-50%)}")}function kt(e){let t,n,i,r,a,s,o,l,c,u,d,p,h,f,v,m,g,w,y,b,x,k,C,$,E,S,I,O,T,j,M,D,z,P,B,_,H;return{c(){t=F("div"),n=F("div"),i=F("label"),i.textContent="Name",r=X(),a=F("input"),s=X(),o=F("div"),l=F("label"),l.textContent="HP",c=X(),u=F("input"),d=X(),p=F("div"),h=F("label"),h.textContent="AC",f=X(),v=F("input"),m=X(),g=F("div"),w=F("label"),w.textContent="Modifier",y=X(),b=F("input"),x=X(),k=F("div"),C=F("label"),C.textContent="Initiative",$=X(),E=F("input"),S=X(),I=F("div"),T=X(),j=F("div"),M=F("div"),z=X(),P=F("div"),K(i,"for","add-name"),K(a,"id","add-name"),K(a,"type","text"),K(a,"name","name"),K(a,"tabindex","0"),K(n,"class","svelte-1rjv45j"),K(l,"for","add-hp"),K(u,"id","add-hp"),K(u,"type","number"),K(u,"name","hp"),K(u,"tabindex","0"),K(o,"class","svelte-1rjv45j"),K(h,"for","add-ac"),K(v,"id","add-ac"),K(v,"type","number"),K(v,"name","ac"),K(v,"tabindex","0"),K(p,"class","svelte-1rjv45j"),K(w,"for","add-mod"),K(b,"id","add-mod"),K(b,"type","number"),K(b,"name","ac"),K(b,"tabindex","0"),K(g,"class","svelte-1rjv45j"),K(C,"for","add-init"),K(E,"id","add-init"),K(E,"type","number"),K(E,"name","initiative"),K(E,"tabindex","0"),K(I,"class","dice svelte-1rjv45j"),K(k,"class","initiative svelte-1rjv45j"),K(t,"class","create-new svelte-1rjv45j"),K(M,"class","add-button"),K(P,"class","add-button cancel-button svelte-1rjv45j"),K(j,"class","context-buttons svelte-1rjv45j")},m(N,A){W(N,t,A),V(t,n),V(n,i),V(n,r),V(n,a),ee(a,e[0]),V(t,s),V(t,o),V(o,l),V(o,c),V(o,u),ee(u,e[1]),V(t,d),V(t,p),V(p,h),V(p,f),V(p,v),ee(v,e[3]),V(t,m),V(t,g),V(g,w),V(g,y),V(g,b),ee(b,e[4]),V(t,x),V(t,k),V(k,C),V(k,$),V(k,E),ee(E,e[2]),V(k,S),V(k,I),W(N,T,A),W(N,j,A),V(j,M),V(j,z),V(j,P),_||(H=[G(a,"input",e[8]),G(u,"input",e[9]),G(v,"input",e[10]),G(b,"input",e[11]),G(E,"input",e[12]),L(O=e[7].call(null,I)),L(D=e[5].call(null,M)),L(B=e[6].call(null,P))],_=!0)},p(e,[t]){1&t&&a.value!==e[0]&&ee(a,e[0]),2&t&&Q(u.value)!==e[1]&&ee(u,e[1]),8&t&&Q(v.value)!==e[3]&&ee(v,e[3]),16&t&&Q(b.value)!==e[4]&&ee(b,e[4]),4&t&&Q(E.value)!==e[2]&&ee(E,e[2])},i:N,o:N,d(e){e&&q(t),e&&q(T),e&&q(j),_=!1,A(H)}}}function Ct(e,t,r){const a=re();let s,o,l,u,d,p,h;function f(e=0){return n(this,void 0,void 0,(function*(){let t=Math.floor(19*Math.random()+1)+e;return s.plugin.canUseDiceRoller&&(t=(yield s.plugin.app.plugins.plugins["obsidian-dice-roller"].parseDice(s.plugin.data.initiative.replace(/%mod%/g,`(${e})`))).result),t}))}return Ve.view.subscribe((e=>s=e)),[o,l,u,d,p,e=>{new i.ExtraButtonComponent(e).setTooltip("Add Creature").setIcon(c).onClick((()=>{o&&o.length?(p||r(4,p=0),u?a("save",{name:o,hp:l,initiative:u,ac:d,modifier:p,player:h}):f(p).then((e=>{a("save",{name:o,hp:l,initiative:e,ac:d,modifier:p,player:h})}))):new i.Notice("Enter a name!")}))},e=>{new i.ExtraButtonComponent(e).setTooltip("Cancel").setIcon("cross").onClick((()=>{a("cancel")}))},e=>{new i.ExtraButtonComponent(e).setIcon(S).setTooltip("Roll Initiative").onClick((()=>{f(null!=p?p:0).then((e=>{r(2,u=e)}))}))},function(){o=this.value,r(0,o)},function(){l=Q(this.value),r(1,l)},function(){d=Q(this.value),r(3,d)},function(){p=Q(this.value),r(4,p)},function(){u=Q(this.value),r(2,u)}]}const $t=class extends Ie{constructor(e){super(),Se(this,e,Ct,kt,P,{},xt)}};function Et(e){if(null==e)return window;if("[object Window]"!==e.toString()){var t=e.ownerDocument;return t&&t.defaultView||window}return e}function St(e){return e instanceof Et(e).Element||e instanceof Element}function It(e){return e instanceof Et(e).HTMLElement||e instanceof HTMLElement}function Ot(e){return"undefined"!=typeof ShadowRoot&&(e instanceof Et(e).ShadowRoot||e instanceof ShadowRoot)}var Tt=Math.round;function jt(e,t){void 0===t&&(t=!1);var n=e.getBoundingClientRect(),i=1,r=1;if(It(e)&&t){var a=e.offsetHeight,s=e.offsetWidth;s>0&&(i=n.width/s||1),a>0&&(r=n.height/a||1)}return{width:Tt(n.width/i),height:Tt(n.height/r),top:Tt(n.top/r),right:Tt(n.right/i),bottom:Tt(n.bottom/r),left:Tt(n.left/i),x:Tt(n.left/i),y:Tt(n.top/r)}}function Nt(e){var t=Et(e);return{scrollLeft:t.pageXOffset,scrollTop:t.pageYOffset}}function Mt(e){return e?(e.nodeName||"").toLowerCase():null}function Dt(e){return((St(e)?e.ownerDocument:e.document)||window.document).documentElement}function At(e){return jt(Dt(e)).left+Nt(e).scrollLeft}function zt(e){return Et(e).getComputedStyle(e)}function Pt(e){var t=zt(e),n=t.overflow,i=t.overflowX,r=t.overflowY;return/auto|scroll|overlay|hidden/.test(n+r+i)}function Bt(e,t,n){void 0===n&&(n=!1);var i,r,a=It(t),s=It(t)&&function(e){var t=e.getBoundingClientRect(),n=t.width/e.offsetWidth||1,i=t.height/e.offsetHeight||1;return 1!==n||1!==i}(t),o=Dt(t),l=jt(e,s),c={scrollLeft:0,scrollTop:0},u={x:0,y:0};return(a||!a&&!n)&&(("body"!==Mt(t)||Pt(o))&&(c=(i=t)!==Et(i)&&It(i)?{scrollLeft:(r=i).scrollLeft,scrollTop:r.scrollTop}:Nt(i)),It(t)?((u=jt(t,!0)).x+=t.clientLeft,u.y+=t.clientTop):o&&(u.x=At(o))),{x:l.left+c.scrollLeft-u.x,y:l.top+c.scrollTop-u.y,width:l.width,height:l.height}}function Lt(e){var t=jt(e),n=e.offsetWidth,i=e.offsetHeight;return Math.abs(t.width-n)<=1&&(n=t.width),Math.abs(t.height-i)<=1&&(i=t.height),{x:e.offsetLeft,y:e.offsetTop,width:n,height:i}}function _t(e){return"html"===Mt(e)?e:e.assignedSlot||e.parentNode||(Ot(e)?e.host:null)||Dt(e)}function Ht(e){return["html","body","#document"].indexOf(Mt(e))>=0?e.ownerDocument.body:It(e)&&Pt(e)?e:Ht(_t(e))}function Vt(e,t){var n;void 0===t&&(t=[]);var i=Ht(e),r=i===(null==(n=e.ownerDocument)?void 0:n.body),a=Et(i),s=r?[a].concat(a.visualViewport||[],Pt(i)?i:[]):i,o=t.concat(s);return r?o:o.concat(Vt(_t(s)))}function Rt(e){return["table","td","th"].indexOf(Mt(e))>=0}function Wt(e){return It(e)&&"fixed"!==zt(e).position?e.offsetParent:null}function qt(e){for(var t=Et(e),n=Wt(e);n&&Rt(n)&&"static"===zt(n).position;)n=Wt(n);return n&&("html"===Mt(n)||"body"===Mt(n)&&"static"===zt(n).position)?t:n||function(e){var t=-1!==navigator.userAgent.toLowerCase().indexOf("firefox");if(-1!==navigator.userAgent.indexOf("Trident")&&It(e)&&"fixed"===zt(e).position)return null;for(var n=_t(e);It(n)&&["html","body"].indexOf(Mt(n))<0;){var i=zt(n);if("none"!==i.transform||"none"!==i.perspective||"paint"===i.contain||-1!==["transform","perspective"].indexOf(i.willChange)||t&&"filter"===i.willChange||t&&i.filter&&"none"!==i.filter)return n;n=n.parentNode}return null}(e)||t}var Ut="top",Ft="bottom",Yt="right",Jt="left",Xt="auto",Gt=[Ut,Ft,Yt,Jt],Kt="start",Qt="end",Zt="viewport",en="popper",tn=Gt.reduce((function(e,t){return e.concat([t+"-"+Kt,t+"-"+Qt])}),[]),nn=[].concat(Gt,[Xt]).reduce((function(e,t){return e.concat([t,t+"-"+Kt,t+"-"+Qt])}),[]),rn=["beforeRead","read","afterRead","beforeMain","main","afterMain","beforeWrite","write","afterWrite"];function an(e){var t=new Map,n=new Set,i=[];function r(e){n.add(e.name),[].concat(e.requires||[],e.requiresIfExists||[]).forEach((function(e){if(!n.has(e)){var i=t.get(e);i&&r(i)}})),i.push(e)}return e.forEach((function(e){t.set(e.name,e)})),e.forEach((function(e){n.has(e.name)||r(e)})),i}var sn={placement:"bottom",modifiers:[],strategy:"absolute"};function on(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return!t.some((function(e){return!(e&&"function"==typeof e.getBoundingClientRect)}))}function ln(e){void 0===e&&(e={});var t=e,n=t.defaultModifiers,i=void 0===n?[]:n,r=t.defaultOptions,a=void 0===r?sn:r;return function(e,t,n){void 0===n&&(n=a);var r,s,o={placement:"bottom",orderedModifiers:[],options:Object.assign({},sn,a),modifiersData:{},elements:{reference:e,popper:t},attributes:{},styles:{}},l=[],c=!1,u={state:o,setOptions:function(n){var r="function"==typeof n?n(o.options):n;d(),o.options=Object.assign({},a,o.options,r),o.scrollParents={reference:St(e)?Vt(e):e.contextElement?Vt(e.contextElement):[],popper:Vt(t)};var s,c,p=function(e){var t=an(e);return rn.reduce((function(e,n){return e.concat(t.filter((function(e){return e.phase===n})))}),[])}((s=[].concat(i,o.options.modifiers),c=s.reduce((function(e,t){var n=e[t.name];return e[t.name]=n?Object.assign({},n,t,{options:Object.assign({},n.options,t.options),data:Object.assign({},n.data,t.data)}):t,e}),{}),Object.keys(c).map((function(e){return c[e]}))));return o.orderedModifiers=p.filter((function(e){return e.enabled})),o.orderedModifiers.forEach((function(e){var t=e.name,n=e.options,i=void 0===n?{}:n,r=e.effect;if("function"==typeof r){var a=r({state:o,name:t,instance:u,options:i});l.push(a||function(){})}})),u.update()},forceUpdate:function(){if(!c){var e=o.elements,t=e.reference,n=e.popper;if(on(t,n)){o.rects={reference:Bt(t,qt(n),"fixed"===o.options.strategy),popper:Lt(n)},o.reset=!1,o.placement=o.options.placement,o.orderedModifiers.forEach((function(e){return o.modifiersData[e.name]=Object.assign({},e.data)}));for(var i=0;i<o.orderedModifiers.length;i++)if(!0!==o.reset){var r=o.orderedModifiers[i],a=r.fn,s=r.options,l=void 0===s?{}:s,d=r.name;"function"==typeof a&&(o=a({state:o,options:l,name:d,instance:u})||o)}else o.reset=!1,i=-1}}},update:(r=function(){return new Promise((function(e){u.forceUpdate(),e(o)}))},function(){return s||(s=new Promise((function(e){Promise.resolve().then((function(){s=void 0,e(r())}))}))),s}),destroy:function(){d(),c=!0}};if(!on(e,t))return u;function d(){l.forEach((function(e){return e()})),l=[]}return u.setOptions(n).then((function(e){!c&&n.onFirstUpdate&&n.onFirstUpdate(e)})),u}}var cn={passive:!0};const un={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(e){var t=e.state,n=e.instance,i=e.options,r=i.scroll,a=void 0===r||r,s=i.resize,o=void 0===s||s,l=Et(t.elements.popper),c=[].concat(t.scrollParents.reference,t.scrollParents.popper);return a&&c.forEach((function(e){e.addEventListener("scroll",n.update,cn)})),o&&l.addEventListener("resize",n.update,cn),function(){a&&c.forEach((function(e){e.removeEventListener("scroll",n.update,cn)})),o&&l.removeEventListener("resize",n.update,cn)}},data:{}};function dn(e){return e.split("-")[0]}function pn(e){return e.split("-")[1]}function hn(e){return["top","bottom"].indexOf(e)>=0?"x":"y"}function fn(e){var t,n=e.reference,i=e.element,r=e.placement,a=r?dn(r):null,s=r?pn(r):null,o=n.x+n.width/2-i.width/2,l=n.y+n.height/2-i.height/2;switch(a){case Ut:t={x:o,y:n.y-i.height};break;case Ft:t={x:o,y:n.y+n.height};break;case Yt:t={x:n.x+n.width,y:l};break;case Jt:t={x:n.x-i.width,y:l};break;default:t={x:n.x,y:n.y}}var c=a?hn(a):null;if(null!=c){var u="y"===c?"height":"width";switch(s){case Kt:t[c]=t[c]-(n[u]/2-i[u]/2);break;case Qt:t[c]=t[c]+(n[u]/2-i[u]/2)}}return t}const vn={name:"popperOffsets",enabled:!0,phase:"read",fn:function(e){var t=e.state,n=e.name;t.modifiersData[n]=fn({reference:t.rects.reference,element:t.rects.popper,strategy:"absolute",placement:t.placement})},data:{}};var mn=Math.max,gn=Math.min,wn=Math.round,yn={top:"auto",right:"auto",bottom:"auto",left:"auto"};function bn(e){var t,n=e.popper,i=e.popperRect,r=e.placement,a=e.variation,s=e.offsets,o=e.position,l=e.gpuAcceleration,c=e.adaptive,u=e.roundOffsets,d=!0===u?function(e){var t=e.x,n=e.y,i=window.devicePixelRatio||1;return{x:wn(wn(t*i)/i)||0,y:wn(wn(n*i)/i)||0}}(s):"function"==typeof u?u(s):s,p=d.x,h=void 0===p?0:p,f=d.y,v=void 0===f?0:f,m=s.hasOwnProperty("x"),g=s.hasOwnProperty("y"),w=Jt,y=Ut,b=window;if(c){var x=qt(n),k="clientHeight",C="clientWidth";x===Et(n)&&"static"!==zt(x=Dt(n)).position&&"absolute"===o&&(k="scrollHeight",C="scrollWidth"),x=x,r!==Ut&&(r!==Jt&&r!==Yt||a!==Qt)||(y=Ft,v-=x[k]-i.height,v*=l?1:-1),r!==Jt&&(r!==Ut&&r!==Ft||a!==Qt)||(w=Yt,h-=x[C]-i.width,h*=l?1:-1)}var $,E=Object.assign({position:o},c&&yn);return l?Object.assign({},E,(($={})[y]=g?"0":"",$[w]=m?"0":"",$.transform=(b.devicePixelRatio||1)<=1?"translate("+h+"px, "+v+"px)":"translate3d("+h+"px, "+v+"px, 0)",$)):Object.assign({},E,((t={})[y]=g?v+"px":"",t[w]=m?h+"px":"",t.transform="",t))}var xn={left:"right",right:"left",bottom:"top",top:"bottom"};function kn(e){return e.replace(/left|right|bottom|top/g,(function(e){return xn[e]}))}var Cn={start:"end",end:"start"};function $n(e){return e.replace(/start|end/g,(function(e){return Cn[e]}))}function En(e,t){var n=t.getRootNode&&t.getRootNode();if(e.contains(t))return!0;if(n&&Ot(n)){var i=t;do{if(i&&e.isSameNode(i))return!0;i=i.parentNode||i.host}while(i)}return!1}function Sn(e){return Object.assign({},e,{left:e.x,top:e.y,right:e.x+e.width,bottom:e.y+e.height})}function In(e,t){return t===Zt?Sn(function(e){var t=Et(e),n=Dt(e),i=t.visualViewport,r=n.clientWidth,a=n.clientHeight,s=0,o=0;return i&&(r=i.width,a=i.height,/^((?!chrome|android).)*safari/i.test(navigator.userAgent)||(s=i.offsetLeft,o=i.offsetTop)),{width:r,height:a,x:s+At(e),y:o}}(e)):It(t)?function(e){var t=jt(e);return t.top=t.top+e.clientTop,t.left=t.left+e.clientLeft,t.bottom=t.top+e.clientHeight,t.right=t.left+e.clientWidth,t.width=e.clientWidth,t.height=e.clientHeight,t.x=t.left,t.y=t.top,t}(t):Sn(function(e){var t,n=Dt(e),i=Nt(e),r=null==(t=e.ownerDocument)?void 0:t.body,a=mn(n.scrollWidth,n.clientWidth,r?r.scrollWidth:0,r?r.clientWidth:0),s=mn(n.scrollHeight,n.clientHeight,r?r.scrollHeight:0,r?r.clientHeight:0),o=-i.scrollLeft+At(e),l=-i.scrollTop;return"rtl"===zt(r||n).direction&&(o+=mn(n.clientWidth,r?r.clientWidth:0)-a),{width:a,height:s,x:o,y:l}}(Dt(e)))}function On(e){return Object.assign({},{top:0,right:0,bottom:0,left:0},e)}function Tn(e,t){return t.reduce((function(t,n){return t[n]=e,t}),{})}function jn(e,t){void 0===t&&(t={});var n=t,i=n.placement,r=void 0===i?e.placement:i,a=n.boundary,s=void 0===a?"clippingParents":a,o=n.rootBoundary,l=void 0===o?Zt:o,c=n.elementContext,u=void 0===c?en:c,d=n.altBoundary,p=void 0!==d&&d,h=n.padding,f=void 0===h?0:h,v=On("number"!=typeof f?f:Tn(f,Gt)),m=u===en?"reference":en,g=e.rects.popper,w=e.elements[p?m:u],y=function(e,t,n){var i="clippingParents"===t?function(e){var t=Vt(_t(e)),n=["absolute","fixed"].indexOf(zt(e).position)>=0&&It(e)?qt(e):e;return St(n)?t.filter((function(e){return St(e)&&En(e,n)&&"body"!==Mt(e)})):[]}(e):[].concat(t),r=[].concat(i,[n]),a=r[0],s=r.reduce((function(t,n){var i=In(e,n);return t.top=mn(i.top,t.top),t.right=gn(i.right,t.right),t.bottom=gn(i.bottom,t.bottom),t.left=mn(i.left,t.left),t}),In(e,a));return s.width=s.right-s.left,s.height=s.bottom-s.top,s.x=s.left,s.y=s.top,s}(St(w)?w:w.contextElement||Dt(e.elements.popper),s,l),b=jt(e.elements.reference),x=fn({reference:b,element:g,strategy:"absolute",placement:r}),k=Sn(Object.assign({},g,x)),C=u===en?k:b,$={top:y.top-C.top+v.top,bottom:C.bottom-y.bottom+v.bottom,left:y.left-C.left+v.left,right:C.right-y.right+v.right},E=e.modifiersData.offset;if(u===en&&E){var S=E[r];Object.keys($).forEach((function(e){var t=[Yt,Ft].indexOf(e)>=0?1:-1,n=[Ut,Ft].indexOf(e)>=0?"y":"x";$[e]+=S[n]*t}))}return $}const Nn={name:"flip",enabled:!0,phase:"main",fn:function(e){var t=e.state,n=e.options,i=e.name;if(!t.modifiersData[i]._skip){for(var r=n.mainAxis,a=void 0===r||r,s=n.altAxis,o=void 0===s||s,l=n.fallbackPlacements,c=n.padding,u=n.boundary,d=n.rootBoundary,p=n.altBoundary,h=n.flipVariations,f=void 0===h||h,v=n.allowedAutoPlacements,m=t.options.placement,g=dn(m),w=l||(g!==m&&f?function(e){if(dn(e)===Xt)return[];var t=kn(e);return[$n(e),t,$n(t)]}(m):[kn(m)]),y=[m].concat(w).reduce((function(e,n){return e.concat(dn(n)===Xt?function(e,t){void 0===t&&(t={});var n=t,i=n.placement,r=n.boundary,a=n.rootBoundary,s=n.padding,o=n.flipVariations,l=n.allowedAutoPlacements,c=void 0===l?nn:l,u=pn(i),d=u?o?tn:tn.filter((function(e){return pn(e)===u})):Gt,p=d.filter((function(e){return c.indexOf(e)>=0}));0===p.length&&(p=d);var h=p.reduce((function(t,n){return t[n]=jn(e,{placement:n,boundary:r,rootBoundary:a,padding:s})[dn(n)],t}),{});return Object.keys(h).sort((function(e,t){return h[e]-h[t]}))}(t,{placement:n,boundary:u,rootBoundary:d,padding:c,flipVariations:f,allowedAutoPlacements:v}):n)}),[]),b=t.rects.reference,x=t.rects.popper,k=new Map,C=!0,$=y[0],E=0;E<y.length;E++){var S=y[E],I=dn(S),O=pn(S)===Kt,T=[Ut,Ft].indexOf(I)>=0,j=T?"width":"height",N=jn(t,{placement:S,boundary:u,rootBoundary:d,altBoundary:p,padding:c}),M=T?O?Yt:Jt:O?Ft:Ut;b[j]>x[j]&&(M=kn(M));var D=kn(M),A=[];if(a&&A.push(N[I]<=0),o&&A.push(N[M]<=0,N[D]<=0),A.every((function(e){return e}))){$=S,C=!1;break}k.set(S,A)}if(C)for(var z=function(e){var t=y.find((function(t){var n=k.get(t);if(n)return n.slice(0,e).every((function(e){return e}))}));if(t)return $=t,"break"},P=f?3:1;P>0&&"break"!==z(P);P--);t.placement!==$&&(t.modifiersData[i]._skip=!0,t.placement=$,t.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}};function Mn(e,t,n){return mn(e,gn(t,n))}function Dn(e,t,n){return void 0===n&&(n={x:0,y:0}),{top:e.top-t.height-n.y,right:e.right-t.width+n.x,bottom:e.bottom-t.height+n.y,left:e.left-t.width-n.x}}function An(e){return[Ut,Yt,Ft,Jt].some((function(t){return e[t]>=0}))}var zn=ln({defaultModifiers:[un,vn,{name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(e){var t=e.state,n=e.options,i=n.gpuAcceleration,r=void 0===i||i,a=n.adaptive,s=void 0===a||a,o=n.roundOffsets,l=void 0===o||o,c={placement:dn(t.placement),variation:pn(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:r};null!=t.modifiersData.popperOffsets&&(t.styles.popper=Object.assign({},t.styles.popper,bn(Object.assign({},c,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:s,roundOffsets:l})))),null!=t.modifiersData.arrow&&(t.styles.arrow=Object.assign({},t.styles.arrow,bn(Object.assign({},c,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})},data:{}},{name:"applyStyles",enabled:!0,phase:"write",fn:function(e){var t=e.state;Object.keys(t.elements).forEach((function(e){var n=t.styles[e]||{},i=t.attributes[e]||{},r=t.elements[e];It(r)&&Mt(r)&&(Object.assign(r.style,n),Object.keys(i).forEach((function(e){var t=i[e];!1===t?r.removeAttribute(e):r.setAttribute(e,!0===t?"":t)})))}))},effect:function(e){var t=e.state,n={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,n.popper),t.styles=n,t.elements.arrow&&Object.assign(t.elements.arrow.style,n.arrow),function(){Object.keys(t.elements).forEach((function(e){var i=t.elements[e],r=t.attributes[e]||{},a=Object.keys(t.styles.hasOwnProperty(e)?t.styles[e]:n[e]).reduce((function(e,t){return e[t]="",e}),{});It(i)&&Mt(i)&&(Object.assign(i.style,a),Object.keys(r).forEach((function(e){i.removeAttribute(e)})))}))}},requires:["computeStyles"]},{name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(e){var t=e.state,n=e.options,i=e.name,r=n.offset,a=void 0===r?[0,0]:r,s=nn.reduce((function(e,n){return e[n]=function(e,t,n){var i=dn(e),r=[Jt,Ut].indexOf(i)>=0?-1:1,a="function"==typeof n?n(Object.assign({},t,{placement:e})):n,s=a[0],o=a[1];return s=s||0,o=(o||0)*r,[Jt,Yt].indexOf(i)>=0?{x:o,y:s}:{x:s,y:o}}(n,t.rects,a),e}),{}),o=s[t.placement],l=o.x,c=o.y;null!=t.modifiersData.popperOffsets&&(t.modifiersData.popperOffsets.x+=l,t.modifiersData.popperOffsets.y+=c),t.modifiersData[i]=s}},Nn,{name:"preventOverflow",enabled:!0,phase:"main",fn:function(e){var t=e.state,n=e.options,i=e.name,r=n.mainAxis,a=void 0===r||r,s=n.altAxis,o=void 0!==s&&s,l=n.boundary,c=n.rootBoundary,u=n.altBoundary,d=n.padding,p=n.tether,h=void 0===p||p,f=n.tetherOffset,v=void 0===f?0:f,m=jn(t,{boundary:l,rootBoundary:c,padding:d,altBoundary:u}),g=dn(t.placement),w=pn(t.placement),y=!w,b=hn(g),x="x"===b?"y":"x",k=t.modifiersData.popperOffsets,C=t.rects.reference,$=t.rects.popper,E="function"==typeof v?v(Object.assign({},t.rects,{placement:t.placement})):v,S={x:0,y:0};if(k){if(a||o){var I="y"===b?Ut:Jt,O="y"===b?Ft:Yt,T="y"===b?"height":"width",j=k[b],N=k[b]+m[I],M=k[b]-m[O],D=h?-$[T]/2:0,A=w===Kt?C[T]:$[T],z=w===Kt?-$[T]:-C[T],P=t.elements.arrow,B=h&&P?Lt(P):{width:0,height:0},L=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},_=L[I],H=L[O],V=Mn(0,C[T],B[T]),R=y?C[T]/2-D-V-_-E:A-V-_-E,W=y?-C[T]/2+D+V+H+E:z+V+H+E,q=t.elements.arrow&&qt(t.elements.arrow),U=q?"y"===b?q.clientTop||0:q.clientLeft||0:0,F=t.modifiersData.offset?t.modifiersData.offset[t.placement][b]:0,Y=k[b]+R-F-U,J=k[b]+W-F;if(a){var X=Mn(h?gn(N,Y):N,j,h?mn(M,J):M);k[b]=X,S[b]=X-j}if(o){var G="x"===b?Ut:Jt,K="x"===b?Ft:Yt,Q=k[x],Z=Q+m[G],ee=Q-m[K],te=Mn(h?gn(Z,Y):Z,Q,h?mn(ee,J):ee);k[x]=te,S[x]=te-Q}}t.modifiersData[i]=S}},requiresIfExists:["offset"]},{name:"arrow",enabled:!0,phase:"main",fn:function(e){var t,n=e.state,i=e.name,r=e.options,a=n.elements.arrow,s=n.modifiersData.popperOffsets,o=dn(n.placement),l=hn(o),c=[Jt,Yt].indexOf(o)>=0?"height":"width";if(a&&s){var u=function(e,t){return On("number"!=typeof(e="function"==typeof e?e(Object.assign({},t.rects,{placement:t.placement})):e)?e:Tn(e,Gt))}(r.padding,n),d=Lt(a),p="y"===l?Ut:Jt,h="y"===l?Ft:Yt,f=n.rects.reference[c]+n.rects.reference[l]-s[l]-n.rects.popper[c],v=s[l]-n.rects.reference[l],m=qt(a),g=m?"y"===l?m.clientHeight||0:m.clientWidth||0:0,w=f/2-v/2,y=u[p],b=g-d[c]-u[h],x=g/2-d[c]/2+w,k=Mn(y,x,b),C=l;n.modifiersData[i]=((t={})[C]=k,t.centerOffset=k-x,t)}},effect:function(e){var t=e.state,n=e.options.element,i=void 0===n?"[data-popper-arrow]":n;null!=i&&("string"!=typeof i||(i=t.elements.popper.querySelector(i)))&&En(t.elements.popper,i)&&(t.elements.arrow=i)},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]},{name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(e){var t=e.state,n=e.name,i=t.rects.reference,r=t.rects.popper,a=t.modifiersData.preventOverflow,s=jn(t,{elementContext:"reference"}),o=jn(t,{altBoundary:!0}),l=Dn(s,i),c=Dn(o,r,a),u=An(l),d=An(c);t.modifiersData[n]={referenceClippingOffsets:l,popperEscapeOffsets:c,isReferenceHidden:u,hasPopperEscaped:d},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":u,"data-popper-escaped":d})}}]});class Pn{constructor(e,t,n){this.containerEl=t,this.owner=e,t.on("click",".suggestion-item",this.onSuggestionClick.bind(this)),t.on("mousemove",".suggestion-item",this.onSuggestionMouseover.bind(this)),n.register([],"ArrowUp",(()=>(this.setSelectedItem(this.selectedItem-1,!0),!1))),n.register([],"ArrowDown",(()=>(this.setSelectedItem(this.selectedItem+1,!0),!1))),n.register([],"Enter",(e=>(this.useSelectedItem(e),!1))),n.register([],"Tab",(e=>(this.useSelectedItem(e),!1)))}chooseSuggestion(e){if(!this.items||!this.items.length)return;const t=this.items[this.selectedItem];t&&this.owner.selectSuggestion(t,e)}onSuggestionClick(e,t){if(e.preventDefault(),!this.suggestions||!this.suggestions.length)return;const n=this.suggestions.indexOf(t);this.setSelectedItem(n,!1),this.useSelectedItem(e)}onSuggestionMouseover(e,t){if(!this.suggestions||!this.suggestions.length)return;const n=this.suggestions.indexOf(t);this.setSelectedItem(n,!1)}empty(){this.containerEl.empty()}setSuggestions(e){this.containerEl.empty();const t=[];e.forEach((e=>{const n=this.containerEl.createDiv("suggestion-item");this.owner.renderSuggestion(e,n),t.push(n)})),this.items=e,this.suggestions=t,this.setSelectedItem(0,!1)}useSelectedItem(e){if(!this.items||!this.items.length)return;const t=this.items[this.selectedItem];t&&this.owner.selectSuggestion(t,e)}wrap(e,t){return(e%t+t)%t}setSelectedItem(e,t){const n=this.wrap(e,this.suggestions.length),i=this.suggestions[this.selectedItem],r=this.suggestions[n];i&&i.removeClass("is-selected"),r&&r.addClass("is-selected"),this.selectedItem=n,t&&r.scrollIntoView(!1)}}class Bn extends i.FuzzySuggestModal{constructor(e,t){super(e),this.items=[],this.scope=new i.Scope,this.emptyStateText="No match found",this.limit=25,this.inputEl=t,this.suggestEl=createDiv({attr:{style:"min-width: 475px;"},cls:"suggestion-container"}),this.contentEl=this.suggestEl.createDiv("suggestion"),this.suggester=new Pn(this,this.contentEl,this.scope),this.scope.register([],"Escape",this.close.bind(this)),this.inputEl.addEventListener("input",this.onInputChanged.bind(this)),this.inputEl.addEventListener("blur",this.close.bind(this)),this.suggestEl.on("mousedown",".suggestion-container",(e=>{e.preventDefault()}))}empty(){this.suggester.empty()}onInputChanged(){const e=this.modifyInput(this.inputEl.value),t=this.getSuggestions(e);t.length>0?this.suggester.setSuggestions(t.slice(0,this.limit)):this.onNoSuggestion(),this.open()}modifyInput(e){return e}onNoSuggestion(){this.empty(),this.renderSuggestion(null,this.contentEl.createDiv("suggestion-item"))}open(){this.app.keymap.pushScope(this.scope),document.body.appendChild(this.suggestEl),this.popper=zn(this.inputEl,this.suggestEl,{placement:"auto-start",modifiers:[{name:"offset",options:{offset:[0,10]}},{name:"flip",options:{allowedAutoPlacements:["top-start","bottom-start"]}}]})}close(){this.app.keymap.popScope(this.scope),this.suggester.setSuggestions([]),this.popper&&this.popper.destroy(),this.suggestEl.detach()}createPrompt(e){this.promptEl||(this.promptEl=this.suggestEl.createDiv("prompt-instructions"));let t=this.promptEl.createDiv("prompt-instruction");for(let n of e)t.appendChild(n)}}class Ln extends Bn{constructor(e,t){super(e.app,t),this.plugin=e,this.items=[];const n=e.app.metadataCache,i=n.getCachedFiles().filter((e=>(n.getCache(e).tags||[]).some((e=>"#condition"==e.tag))));this.items=i.map((e=>{const t=n.getFirstLinkpathDest(e,e);return{name:t.basename,description:t.unsafeCachedData,path:t.path}})),this.suggestEl.style.removeProperty("min-width"),this.onInputChanged()}getItemText(e){return e.name}getItems(){return this.items}onChooseItem(e){this.inputEl.value=e.name,this.condition=e}onNoSuggestion(){this.empty(),this.renderSuggestion(null,this.contentEl.createDiv("suggestion-item")),this.condition=null}selectSuggestion({item:e}){null!==this.condition?(this.inputEl.value=e.name,this.condition=e):this.condition={name:this.inputEl.value,description:[]},this.onClose(),this.close()}renderSuggestion(e,t){let{item:n,match:r}=e||{},a=new i.Setting(t);if(!n)return a.nameEl.setText(this.emptyStateText),void(this.condition=null);const s=r.matches.map((e=>createSpan("suggestion-highlight")));for(let e=0;e<n.name.length;e++){let t=r.matches.find((t=>t[0]===e));if(t){let i=s[r.matches.indexOf(t)];a.nameEl.appendChild(i),i.appendText(n.name.substring(t[0],t[1])),e+=t[1]-t[0]-1}else a.nameEl.appendText(n.name[e])}}}function _n(e){R(e,"svelte-1g6tend",".obsidian-initiative-tracker.svelte-1g6tend{margin:0.5rem;min-width:180px}.add-creature-container.svelte-1g6tend{display:flex;flex-flow:column nowrap;justify-content:flex-start;margin-right:0.5rem}.context-container.svelte-1g6tend{display:flex;flex-flow:row nowrap;justify-content:space-between}.copy-button.svelte-1g6tend{width:min-content;opacity:0.25}.copy-button.svelte-1g6tend:hover{opacity:1}.add-button.svelte-1g6tend{width:min-content}.initiative-tracker-name-container.svelte-1g6tend{display:flex;justify-content:space-between;align-items:center;padding:0 0.5rem}.initiative-tracker-name.svelte-1g6tend{margin:0}")}function Hn(e){let t,n,i;return{c(){t=F("div"),n=F("h2"),i=J(e[4]),K(n,"class","initiative-tracker-name svelte-1g6tend"),K(t,"class","initiative-tracker-name-container svelte-1g6tend")},m(e,r){W(e,t,r),V(t,n),V(n,i)},p(e,t){16&t&&Z(i,e[4])},d(e){e&&q(t)}}}function Vn(e){let t,n,i,r;const a=[Un,qn],s=[];function o(e,t){return e[9]||e[2]?0:1}return n=o(e),i=s[n]=a[n](e),{c(){t=F("div"),i.c(),K(t,"class","add-creature-container svelte-1g6tend")},m(e,i){W(e,t,i),s[n].m(t,null),r=!0},p(e,r){let l=n;n=o(e),n===l?s[n].p(e,r):(ye(),ke(s[l],1,1,(()=>{s[l]=null})),be(),i=s[n],i?i.p(e,r):(i=s[n]=a[n](e),i.c()),xe(i,1),i.m(t,null))},i(e){r||(xe(i),r=!0)},o(e){ke(i),r=!1},d(e){e&&q(t),s[n].d()}}}function Rn(e){let t,n,i,r,a,s,o;return{c(){t=F("div"),n=F("span"),n.textContent="Apply status:",i=X(),r=F("input"),K(r,"type","text"),K(t,"class","updating-hp")},m(l,c){W(l,t,c),V(t,n),V(t,i),V(t,r),s||(o=[G(r,"focus",e[21]),G(r,"blur",e[22]),G(r,"keydown",Xn),L(a=Yn.call(null,r))],s=!0)},p:N,i:N,o:N,d(e){e&&q(t),s=!1,A(o)}}}function Wn(e){let t,n,i,r,a,s,o;return{c(){t=F("div"),n=F("span"),n.textContent="Apply damage(+) or healing(-):",i=X(),r=F("input"),K(r,"type","number"),K(t,"class","updating-hp")},m(l,c){W(l,t,c),V(t,n),V(t,i),V(t,r),s||(o=[G(r,"blur",e[20]),G(r,"keydown",Jn),L(a=Yn.call(null,r))],s=!0)},p:N,i:N,o:N,d(e){e&&q(t),s=!1,A(o)}}}function qn(e){let t,n,i,r,a,s,o,l;return{c(){t=F("div"),n=F("div"),r=X(),a=F("div"),K(n,"class","copy-button svelte-1g6tend"),K(a,"class","add-button svelte-1g6tend"),K(t,"class","context-container svelte-1g6tend")},m(c,u){W(c,t,u),V(t,n),V(t,r),V(t,a),o||(l=[L(i=e[15].call(null,n)),L(s=e[14].call(null,a))],o=!0)},p:N,i:N,o:N,d(e){e&&q(t),o=!1,A(l)}}}function Un(e){let t,n;return t=new $t({}),t.$on("cancel",e[23]),t.$on("save",e[24]),{c(){Ce(t.$$.fragment)},m(e,i){$e(t,e,i),n=!0},p:N,i(e){n||(xe(t.$$.fragment,e),n=!0)},o(e){ke(t.$$.fragment,e),n=!1},d(e){Ee(t,e)}}}function Fn(e){let t,n,i,r,a,s,o,l,c;n=new Ye({props:{state:e[5]}});let u=e[4]&&e[4].length&&Hn(e);a=new bt({props:{creatures:e[17](e[3]),show:e[7],state:e[5],current:e[6]}}),a.$on("update-hp",e[18]),a.$on("update-tags",e[19]);const d=[Wn,Rn,Vn],p=[];function h(e,t){return e[0]?0:e[1]?1:2}return o=h(e),l=p[o]=d[o](e),{c(){t=F("div"),Ce(n.$$.fragment),i=X(),u&&u.c(),r=X(),Ce(a.$$.fragment),s=X(),l.c(),K(t,"class","obsidian-initiative-tracker svelte-1g6tend")},m(e,l){W(e,t,l),$e(n,t,null),V(t,i),u&&u.m(t,null),V(t,r),$e(a,t,null),V(t,s),p[o].m(t,null),c=!0},p(e,[i]){const s={};32&i&&(s.state=e[5]),n.$set(s),e[4]&&e[4].length?u?u.p(e,i):(u=Hn(e),u.c(),u.m(t,r)):u&&(u.d(1),u=null);const c={};8&i&&(c.creatures=e[17](e[3])),128&i&&(c.show=e[7]),32&i&&(c.state=e[5]),64&i&&(c.current=e[6]),a.$set(c);let f=o;o=h(e),o===f?p[o].p(e,i):(ye(),ke(p[f],1,1,(()=>{p[f]=null})),be(),l=p[o],l?l.p(e,i):(l=p[o]=d[o](e),l.c()),xe(l,1),l.m(t,null))},i(e){c||(xe(n.$$.fragment,e),xe(a.$$.fragment,e),xe(l),c=!0)},o(e){ke(n.$$.fragment,e),ke(a.$$.fragment,e),ke(l),c=!1},d(e){e&&q(t),Ee(n),u&&u.d(),Ee(a),p[o].d()}}}function Yn(e){e.focus()}const Jn=function(e){return"Enter"===e.key||"Tab"===e.key?(e.preventDefault(),void this.blur()):"Escape"===e.key?(this.value="",void this.blur()):/^(-?\d*\.?\d*|Backspace|Delete|Arrow\w+)$/.test(e.key)?void 0:(e.preventDefault(),!1)},Xn=function(e){return"Escape"===e.key?(this.value="",void this.blur()):"Enter"===e.key||"Tab"===e.key?(e.preventDefault(),void this.blur()):"Escape"===e.key?(this.value="",void this.blur()):void 0};function Gn(e,t,r){const a=re();let s,{creatures:o=[]}=t,{name:l=null}=t,{state:c}=t,{current:d}=t;Ve.view.subscribe((e=>r(8,s=e)));let{show:p}=t,{updatingHP:h=null}=t;const f=e=>{s.updateCreature(h,{hp:-1*e}),r(0,h=null)};let{updatingStatus:v=null}=t;const m=e=>{s.addStatus(v,e),r(1,v=null)};let g,w=!1,{addNewAsync:y=!1}=t;const b=e=>{r(10,g=new Ln(s.plugin,e)),r(10,g.onClose=()=>{e.blur()},g),g.open()};return e.$$set=e=>{"creatures"in e&&r(3,o=e.creatures),"name"in e&&r(4,l=e.name),"state"in e&&r(5,c=e.state),"current"in e&&r(6,d=e.current),"show"in e&&r(7,p=e.show),"updatingHP"in e&&r(0,h=e.updatingHP),"updatingStatus"in e&&r(1,v=e.updatingStatus),"addNewAsync"in e&&r(2,y=e.addNewAsync)},[h,v,y,o,l,c,d,p,s,w,g,a,f,m,e=>{new i.ExtraButtonComponent(e).setTooltip("Add Creature").setIcon(u).onClick((()=>{r(9,w=!0)}))},e=>{new i.ExtraButtonComponent(e).setTooltip("Copy Initiative Order").setIcon(I).onClick((()=>n(void 0,void 0,void 0,(function*(){yield s.copyInitiativeOrder()}))))},b,e=>{const t=e.reduce(((e,t)=>{const n=e[t.name]||[];return e[t.name]=[...n,t],e}),{});for(let[e,n]of Object.entries(t))if(n.length>1)for(let t=0;t<=n.length-1;t++)n[t].name=e+"#"+(t+1);return e},e=>{r(0,h=e.detail)},e=>{r(1,v=e.detail)},function(e){f(Number(this.value))},function(e){b(this)},function(e){this.value.length?m(g.condition):r(1,v=null)},()=>{r(9,w=!1),r(2,y=!1),a("cancel-add-new-async")},e=>{const t=e.detail,n=new j({name:t.name,hp:t.hp,ac:t.ac,modifier:t.modifier,marker:s.plugin.data.monsterMarker,player:t.player},t.initiative);y?a("add-new-async",n):s.addCreatures(n),r(9,w=!1),r(2,y=!1)}]}const Kn=class extends Ie{constructor(e){super(),Se(this,e,Gn,Fn,P,{creatures:3,name:4,state:5,current:6,show:7,updatingHP:0,updatingStatus:1,addNewAsync:2},_n)}get creatures(){return this.$$.ctx[3]}set creatures(e){this.$$set({creatures:e}),fe()}get name(){return this.$$.ctx[4]}set name(e){this.$$set({name:e}),fe()}get state(){return this.$$.ctx[5]}set state(e){this.$$set({state:e}),fe()}get current(){return this.$$.ctx[6]}set current(e){this.$$set({current:e}),fe()}get show(){return this.$$.ctx[7]}set show(e){this.$$set({show:e}),fe()}get updatingHP(){return this.$$.ctx[0]}set updatingHP(e){this.$$set({updatingHP:e}),fe()}get updatingStatus(){return this.$$.ctx[1]}set updatingStatus(e){this.$$set({updatingStatus:e}),fe()}get addNewAsync(){return this.$$.ctx[2]}set addNewAsync(e){this.$$set({addNewAsync:e}),fe()}};class Qn extends i.ItemView{constructor(e,t){var i,r;super(e),this.leaf=e,this.plugin=t,this.creatures=[],this.current=0,this.state=!1,this._rendered=!1,(null===(r=null===(i=this.plugin.data.state)||void 0===i?void 0:i.creatures)||void 0===r?void 0:r.length)?this.newEncounterFromState(this.plugin.data.state):this.newEncounter(),this.registerEvent(this.app.workspace.on("initiative-tracker:add-creature-here",(e=>n(this,void 0,void 0,(function*(){this.app.workspace.revealLeaf(this.leaf);let t=this._app.$on("add-new-async",(i=>{const r=i.detail;this._addCreature(r),this.trigger("initiative-tracker:creature-added-at-location",r,e),t(),n()})),n=this._app.$on("cancel-add-new-async",(()=>{t(),n()}));this._app.$set({addNewAsync:!0})}))))),this.registerEvent(this.app.workspace.on("initiative-tracker:creature-updated-in-settings",(e=>{const t=this.creatures.find((t=>t==e));t&&this.updateCreature(t,e)}))),this.registerEvent(this.app.workspace.on("initiative-tracker:remove",(e=>{const t=this.creatures.find((t=>t.id==e.id));t&&this.removeCreature(t)}))),this.registerEvent(this.app.workspace.on("initiative-tracker:enable-disable",((e,t)=>{const n=this.creatures.find((t=>t.id==e.id));n&&this.setCreatureState(n,t)}))),this.registerEvent(this.app.workspace.on("initiative-tracker:apply-damage",(e=>{const t=this.creatures.find((t=>t.id==e.id));t&&this.setAppState({updatingHP:t})}))),this.registerEvent(this.app.workspace.on("initiative-tracker:add-status",(e=>{const t=this.creatures.find((t=>t.id==e.id));t&&this.setAppState({updatingStatus:t})})))}get pcs(){return this.players}get npcs(){return this.creatures.filter((e=>!e.player))}get players(){return Array.from(this.plugin.playerCreatures.values())}updatePlayers(){this.trigger("initiative-tracker:players-updated",this.pcs),this.setAppState({creatures:this.ordered})}updateState(){this.setAppState(this.appState)}newEncounterFromState(e){e&&(null==e?void 0:e.creatures.length)||this.newEncounter();const{creatures:t,state:n,name:i,current:r}=e;this.creatures=[...t.map((e=>j.fromJSON(e)))],i&&(this.name=i,this.setAppState({name:this.name})),this.state=n,this.current=r,this.trigger("initiative-tracker:new-encounter",this.appState),this.setAppState({creatures:this.ordered})}_addCreature(e){this.creatures.push(e),this.setAppState({creatures:this.ordered})}onResize(){this.leaf.getRoot()&&this.leaf.getRoot().containerEl&&(i.Platform.isMobile||this.setAppState({show:this.leaf.getRoot().containerEl.clientWidth<300}))}get ordered(){return this.creatures.sort(((e,t)=>t.initiative-e.initiative)),this.creatures}get enabled(){return this.ordered.map(((e,t)=>e.enabled&&t)).filter((e=>"number"==typeof e))}addCreatures(...e){for(let t of e)this.creatures.push(t);this.trigger("initiative-tracker:creatures-added",e),this.setAppState({creatures:this.ordered})}removeCreature(...e){for(let t of e)this.creatures=this.creatures.filter((e=>e!=t));this.trigger("initiative-tracker:creatures-removed",e),this.setAppState({creatures:this.ordered})}newEncounter({name:e,players:t=!0,creatures:i=[],roll:r=!0}={}){return n(this,void 0,void 0,(function*(){t instanceof Array&&t.length?this.creatures=[...this.players.filter((e=>t.includes(e.name)))]:this.creatures=!0===t?[...this.players]:[],i&&(this.creatures=[...this.creatures,...i]),e&&(this.name=e,this.setAppState({name:this.name}));for(let e of this.creatures)e.enabled=!0;this.trigger("initiative-tracker:new-encounter",this.appState),r?yield this.rollInitiatives():this.setAppState({creatures:this.ordered})}))}resetEncounter(){for(let e of this.creatures)e.hp=e.max,this.setCreatureState(e,!0),Array.from(e.status).forEach((t=>{this.removeStatus(e,t)}));this.current=this.enabled[0],this.setAppState({creatures:this.ordered})}setMapState(e){this.setAppState({map:e})}getInitiativeValue(e=0){return n(this,void 0,void 0,(function*(){let t=Math.floor(19*Math.random()+1)+e;return this.plugin.canUseDiceRoller&&(t=(yield this.plugin.app.plugins.plugins["obsidian-dice-roller"].parseDice(this.plugin.data.initiative.replace(/%mod%/g,`(${e})`))).result),t}))}rollInitiatives(){return n(this,void 0,void 0,(function*(){for(let e of this.creatures)e.initiative=yield this.getInitiativeValue(e.modifier);this.setAppState({creatures:this.ordered})}))}get appState(){return{state:this.state,current:this.current,pcs:this.pcs,npcs:this.npcs,creatures:this.ordered}}goToNext(){const e=((this.enabled.indexOf(this.current)+1)%this.enabled.length+this.enabled.length)%this.enabled.length;this.current=this.enabled[e],this.trigger("initiative-tracker:active-change",this.ordered[this.current]),this.setAppState({state:this.state,current:this.current})}goToPrevious(){const e=((this.enabled.indexOf(this.current)-1)%this.enabled.length+this.enabled.length)%this.enabled.length;this.current=this.enabled[e],this.trigger("initiative-tracker:active-change",this.ordered[this.current]),this.setAppState({state:this.state,current:this.current})}toggleState(){this.state=!this.state,this.state?(this.current=this.enabled[0],this.trigger("initiative-tracker:active-change",this.ordered[this.current])):this.trigger("initiative-tracker:active-change",null),this.setAppState({state:this.state,current:this.current})}addStatus(e,t){e.status.add(t),this.trigger("initiative-tracker:creature-updated",e),this.setAppState({creatures:this.ordered})}removeStatus(e,t){e.status.delete(t),this.trigger("initiative-tracker:creature-updated",e),this.setAppState({creatures:this.ordered})}updateCreature(e,{hp:t,ac:n,initiative:i,name:r,marker:a}){i&&(e.initiative=Number(i)),r&&(e.name=r),t&&(e.hp+=Number(t)),n&&(e.ac=n),a&&(e.marker=a),this.trigger("initiative-tracker:creature-updated",e),this.setAppState({creatures:this.ordered})}copyInitiativeOrder(){return n(this,void 0,void 0,(function*(){const e=this.ordered.map((e=>`${e.initiative} ${e.name}`)).join("\n");yield navigator.clipboard.writeText(e)}))}setCreatureState(e,t){t?this._enableCreature(e):this._disableCreature(e),this.enabled.length||(this.current=null),this.trigger("initiative-tracker:creature-updated",e),this.setAppState({creatures:this.ordered,current:this.current})}_enableCreature(e){e.enabled=!0,1==this.enabled.length&&(this.current=this.enabled[0])}_disableCreature(e){this.ordered[this.current]==e&&this.goToNext(),e.enabled=!1}setAppState(e){this._app&&this._rendered&&(this.plugin.app.workspace.trigger("initiative-tracker:state-change",this.appState),this._app.$set(e)),this.plugin.data.state=this.toState(),this.trigger("initiative-tracker:should-save")}onOpen(){var e,t,r,a;return n(this,void 0,void 0,(function*(){let n=!!i.Platform.isMobile||null===(a=(null===(r=null===(t=(e=this.leaf).getRoot)||void 0===t?void 0:t.call(e).containerEl)||void 0===r?void 0:r.clientWidth)<300)||void 0===a||a;Ve.view.set(this),this._app=new Kn({target:this.contentEl,props:{creatures:this.ordered,show:n,state:this.state,current:this.current}}),this._rendered=!0}))}onClose(){return n(this,void 0,void 0,(function*(){this._app.$destroy(),this._rendered=!1,this.trigger("initiative-tracker:closed")}))}getViewType(){return r}getDisplayText(){return"Initiative Tracker"}getIcon(){return o}trigger(...e){const[t,...n]=e;this.app.workspace.trigger(t,...n)}toState(){return this.state?{creatures:[...this.ordered.map((e=>e.toJSON()))],state:this.state,current:this.current,name:this.name}:null}onunload(){return n(this,void 0,void 0,(function*(){this.plugin.data.state=this.toState(),yield this.plugin.saveSettings()}))}}class Zn extends i.Plugin{constructor(){super(...arguments),this.playerCreatures=new Map,this.homebrewCreatures=new Map}get canUseDiceRoller(){return"obsidian-dice-roller"in this.app.plugins.plugins}get view(){const e=this.app.workspace.getLeavesOfType(r),t=e.length?e[0]:null;if(t&&t.view&&t.view instanceof Qn)return t.view}onload(){return n(this,void 0,void 0,(function*(){(0,i.addIcon)(o,'<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="dice-d20" class="svg-inline--fa fa-dice-d20 fa-w-15" role="img" viewBox="0 0 480 512"><path fill="currentColor" d="M106.75 215.06L1.2 370.95c-3.08 5 .1 11.5 5.93 12.14l208.26 22.07-108.64-190.1zM7.41 315.43L82.7 193.08 6.06 147.1c-2.67-1.6-6.06.32-6.06 3.43v162.81c0 4.03 5.29 5.53 7.41 2.09zM18.25 423.6l194.4 87.66c5.3 2.45 11.35-1.43 11.35-7.26v-65.67l-203.55-22.3c-4.45-.5-6.23 5.59-2.2 7.57zm81.22-257.78L179.4 22.88c4.34-7.06-3.59-15.25-10.78-11.14L17.81 110.35c-2.47 1.62-2.39 5.26.13 6.78l81.53 48.69zM240 176h109.21L253.63 7.62C250.5 2.54 245.25 0 240 0s-10.5 2.54-13.63 7.62L130.79 176H240zm233.94-28.9l-76.64 45.99 75.29 122.35c2.11 3.44 7.41 1.94 7.41-2.1V150.53c0-3.11-3.39-5.03-6.06-3.43zm-93.41 18.72l81.53-48.7c2.53-1.52 2.6-5.16.13-6.78l-150.81-98.6c-7.19-4.11-15.12 4.08-10.78 11.14l79.93 142.94zm79.02 250.21L256 438.32v65.67c0 5.84 6.05 9.71 11.35 7.26l194.4-87.66c4.03-1.97 2.25-8.06-2.2-7.56zm-86.3-200.97l-108.63 190.1 208.26-22.07c5.83-.65 9.01-7.14 5.93-12.14L373.25 215.06zM240 208H139.57L240 383.75 340.43 208H240z"/></svg>'),(0,i.addIcon)(c,'<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="save" class="svg-inline--fa fa-save fa-w-14" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M433.941 129.941l-83.882-83.882A48 48 0 0 0 316.118 32H48C21.49 32 0 53.49 0 80v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V163.882a48 48 0 0 0-14.059-33.941zM224 416c-35.346 0-64-28.654-64-64 0-35.346 28.654-64 64-64s64 28.654 64 64c0 35.346-28.654 64-64 64zm96-304.52V212c0 6.627-5.373 12-12 12H76c-6.627 0-12-5.373-12-12V108c0-6.627 5.373-12 12-12h228.52c3.183 0 6.235 1.264 8.485 3.515l3.48 3.48A11.996 11.996 0 0 1 320 111.48z"/></svg>'),(0,i.addIcon)(u,'<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="user-plus" class="svg-inline--fa fa-user-plus fa-w-20" role="img" viewBox="0 0 640 512"><path fill="currentColor" d="M624 208h-64v-64c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v64h-64c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h64v64c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16v-64h64c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm-400 48c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"/></svg>'),(0,i.addIcon)("initiative-tracker-restart",'<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="redo" class="svg-inline--fa fa-redo fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M500.33 0h-47.41a12 12 0 0 0-12 12.57l4 82.76A247.42 247.42 0 0 0 256 8C119.34 8 7.9 119.53 8 256.19 8.1 393.07 119.1 504 256 504a247.1 247.1 0 0 0 166.18-63.91 12 12 0 0 0 .48-17.43l-34-34a12 12 0 0 0-16.38-.55A176 176 0 1 1 402.1 157.8l-101.53-4.87a12 12 0 0 0-12.57 12v47.41a12 12 0 0 0 12 12h200.33a12 12 0 0 0 12-12V12a12 12 0 0 0-12-12z"/></svg>'),(0,i.addIcon)(p,'<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="play" class="svg-inline--fa fa-play fa-w-14" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M424.4 214.7L72.4 6.6C43.8-10.3 0 6.1 0 47.9V464c0 37.5 40.7 60.1 72.4 41.3l352-208c31.4-18.5 31.5-64.1 0-82.6z"/></svg>'),(0,i.addIcon)(h,'<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="step-forward" class="svg-inline--fa fa-step-forward fa-w-14" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M384 44v424c0 6.6-5.4 12-12 12h-48c-6.6 0-12-5.4-12-12V291.6l-195.5 181C95.9 489.7 64 475.4 64 448V64c0-27.4 31.9-41.7 52.5-24.6L312 219.3V44c0-6.6 5.4-12 12-12h48c6.6 0 12 5.4 12 12z"/></svg>'),(0,i.addIcon)(f,'<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="step-backward" class="svg-inline--fa fa-step-backward fa-w-14" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M64 468V44c0-6.6 5.4-12 12-12h48c6.6 0 12 5.4 12 12v176.4l195.5-181C352.1 22.3 384 36.6 384 64v384c0 27.4-31.9 41.7-52.5 24.6L136 292.7V468c0 6.6-5.4 12-12 12H76c-6.6 0-12-5.4-12-12z"/></svg>'),(0,i.addIcon)(v,'<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="stop" class="svg-inline--fa fa-stop fa-w-14" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48z"/></svg>'),(0,i.addIcon)("initiative-tracker-grip",'<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="grip-vertical" class="svg-inline--fa fa-grip-vertical fa-w-10" role="img" viewBox="0 0 320 512"><path fill="currentColor" d="M96 32H32C14.33 32 0 46.33 0 64v64c0 17.67 14.33 32 32 32h64c17.67 0 32-14.33 32-32V64c0-17.67-14.33-32-32-32zm0 160H32c-17.67 0-32 14.33-32 32v64c0 17.67 14.33 32 32 32h64c17.67 0 32-14.33 32-32v-64c0-17.67-14.33-32-32-32zm0 160H32c-17.67 0-32 14.33-32 32v64c0 17.67 14.33 32 32 32h64c17.67 0 32-14.33 32-32v-64c0-17.67-14.33-32-32-32zM288 32h-64c-17.67 0-32 14.33-32 32v64c0 17.67 14.33 32 32 32h64c17.67 0 32-14.33 32-32V64c0-17.67-14.33-32-32-32zm0 160h-64c-17.67 0-32 14.33-32 32v64c0 17.67 14.33 32 32 32h64c17.67 0 32-14.33 32-32v-64c0-17.67-14.33-32-32-32zm0 160h-64c-17.67 0-32 14.33-32 32v64c0 17.67 14.33 32 32 32h64c17.67 0 32-14.33 32-32v-64c0-17.67-14.33-32-32-32z"/></svg>'),(0,i.addIcon)(m,'<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" data-prefix="far" data-icon="heart" class="svg-inline--fa fa-heart fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M458.4 64.3C400.6 15.7 311.3 23 256 79.3 200.7 23 111.4 15.6 53.6 64.3-21.6 127.6-10.6 230.8 43 285.5l175.4 178.7c10 10.2 23.4 15.9 37.6 15.9 14.3 0 27.6-5.6 37.6-15.8L469 285.6c53.5-54.7 64.7-157.9-10.6-221.3zm-23.6 187.5L259.4 430.5c-2.4 2.4-4.4 2.4-6.8 0L77.2 251.8c-36.5-37.2-43.9-107.6 7.3-150.7 38.9-32.7 98.9-27.8 136.5 10.5l35 35.7 35-35.7c37.8-38.5 97.8-43.2 136.5-10.6 51.1 43.1 43.5 113.9 7.3 150.8z"/></svg>'),(0,i.addIcon)(g,'<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="shield-alt" class="svg-inline--fa fa-shield-alt fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M466.5 83.7l-192-80a48.15 48.15 0 0 0-36.9 0l-192 80C27.7 91.1 16 108.6 16 128c0 198.5 114.5 335.7 221.5 380.3 11.8 4.9 25.1 4.9 36.9 0C360.1 472.6 496 349.3 496 128c0-19.4-11.7-36.9-29.5-44.3zM256.1 446.3l-.1-381 175.9 73.3c-3.3 151.4-82.1 261.1-175.8 307.7z"/></svg>'),(0,i.addIcon)(w,'<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="bars" class="svg-inline--fa fa-bars fa-w-14" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg>'),(0,i.addIcon)(b,'<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="user-check" class="svg-inline--fa fa-user-check fa-w-20" role="img" viewBox="0 0 640 512"><path fill="currentColor" d="M224 256c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4zm323-128.4l-27.8-28.1c-4.6-4.7-12.1-4.7-16.8-.1l-104.8 104-45.5-45.8c-4.6-4.7-12.1-4.7-16.8-.1l-28.1 27.9c-4.7 4.6-4.7 12.1-.1 16.8l81.7 82.3c4.6 4.7 12.1 4.7 16.8.1l141.3-140.2c4.6-4.7 4.7-12.2.1-16.8z"/></svg>'),(0,i.addIcon)(y,'<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="user-slash" class="svg-inline--fa fa-user-slash fa-w-20" role="img" viewBox="0 0 640 512"><path fill="currentColor" d="M633.8 458.1L362.3 248.3C412.1 230.7 448 183.8 448 128 448 57.3 390.7 0 320 0c-67.1 0-121.5 51.8-126.9 117.4L45.5 3.4C38.5-2 28.5-.8 23 6.2L3.4 31.4c-5.4 7-4.2 17 2.8 22.4l588.4 454.7c7 5.4 17 4.2 22.5-2.8l19.6-25.3c5.4-6.8 4.1-16.9-2.9-22.3zM96 422.4V464c0 26.5 21.5 48 48 48h350.2L207.4 290.3C144.2 301.3 96 356 96 422.4z"/></svg>'),(0,i.addIcon)(k,'<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="tag" class="svg-inline--fa fa-tag fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M0 252.118V48C0 21.49 21.49 0 48 0h204.118a48 48 0 0 1 33.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882L293.823 497.941c-18.745 18.745-49.137 18.745-67.882 0L14.059 286.059A48 48 0 0 1 0 252.118zM112 64c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48z"/></svg>'),(0,i.addIcon)(x,'<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" data-prefix="far" data-icon="edit" class="svg-inline--fa fa-edit fa-w-18" role="img" viewBox="0 0 576 512"><path fill="currentColor" d="M402.3 344.9l32-32c5-5 13.7-1.5 13.7 5.7V464c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V112c0-26.5 21.5-48 48-48h273.5c7.1 0 10.7 8.6 5.7 13.7l-32 32c-1.5 1.5-3.5 2.3-5.7 2.3H48v352h352V350.5c0-2.1.8-4.1 2.3-5.6zm156.6-201.8L296.3 405.7l-90.4 10c-26.2 2.9-48.5-19.2-45.6-45.6l10-90.4L432.9 17.1c22.9-22.9 59.9-22.9 82.7 0l43.2 43.2c22.9 22.9 22.9 60 .1 82.8zM460.1 174L402 115.9 216.2 301.8l-7.3 65.3 65.3-7.3L460.1 174zm64.8-79.7l-43.2-43.2c-4.1-4.1-10.8-4.1-14.8 0L436 82l58.1 58.1 30.9-30.9c4-4.2 4-10.8-.1-14.9z"/></svg>'),(0,i.addIcon)(C,'<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="running" class="svg-inline--fa fa-running fa-w-13" role="img" viewBox="0 0 416 512"><path fill="currentColor" d="M272 96c26.51 0 48-21.49 48-48S298.51 0 272 0s-48 21.49-48 48 21.49 48 48 48zM113.69 317.47l-14.8 34.52H32c-17.67 0-32 14.33-32 32s14.33 32 32 32h77.45c19.25 0 36.58-11.44 44.11-29.09l8.79-20.52-10.67-6.3c-17.32-10.23-30.06-25.37-37.99-42.61zM384 223.99h-44.03l-26.06-53.25c-12.5-25.55-35.45-44.23-61.78-50.94l-71.08-21.14c-28.3-6.8-57.77-.55-80.84 17.14l-39.67 30.41c-14.03 10.75-16.69 30.83-5.92 44.86s30.84 16.66 44.86 5.92l39.69-30.41c7.67-5.89 17.44-8 25.27-6.14l14.7 4.37-37.46 87.39c-12.62 29.48-1.31 64.01 26.3 80.31l84.98 50.17-27.47 87.73c-5.28 16.86 4.11 34.81 20.97 40.09 3.19 1 6.41 1.48 9.58 1.48 13.61 0 26.23-8.77 30.52-22.45l31.64-101.06c5.91-20.77-2.89-43.08-21.64-54.39l-61.24-36.14 31.31-78.28 20.27 41.43c8 16.34 24.92 26.89 43.11 26.89H384c17.67 0 32-14.33 32-32s-14.33-31.99-32-31.99z"/></svg>'),(0,i.addIcon)($,'<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="redo" class="svg-inline--fa fa-redo fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M500.33 0h-47.41a12 12 0 0 0-12 12.57l4 82.76A247.42 247.42 0 0 0 256 8C119.34 8 7.9 119.53 8 256.19 8.1 393.07 119.1 504 256 504a247.1 247.1 0 0 0 166.18-63.91 12 12 0 0 0 .48-17.43l-34-34a12 12 0 0 0-16.38-.55A176 176 0 1 1 402.1 157.8l-101.53-4.87a12 12 0 0 0-12.57 12v47.41a12 12 0 0 0 12 12h200.33a12 12 0 0 0 12-12V12a12 12 0 0 0-12-12z"/></svg>'),(0,i.addIcon)(E,'<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" data-prefix="far" data-icon="plus-square" class="svg-inline--fa fa-plus-square fa-w-14" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M352 240v32c0 6.6-5.4 12-12 12h-88v88c0 6.6-5.4 12-12 12h-32c-6.6 0-12-5.4-12-12v-88h-88c-6.6 0-12-5.4-12-12v-32c0-6.6 5.4-12 12-12h88v-88c0-6.6 5.4-12 12-12h32c6.6 0 12 5.4 12 12v88h88c6.6 0 12 5.4 12 12zm96-160v352c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V80c0-26.5 21.5-48 48-48h352c26.5 0 48 21.5 48 48zm-48 346V86c0-3.3-2.7-6-6-6H54c-3.3 0-6 2.7-6 6v340c0 3.3 2.7 6 6 6h340c3.3 0 6-2.7 6-6z"/></svg>'),(0,i.addIcon)(S,'<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="dice" class="svg-inline--fa fa-dice fa-w-20" role="img" viewBox="0 0 640 512"><path fill="currentColor" d="M592 192H473.26c12.69 29.59 7.12 65.2-17 89.32L320 417.58V464c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48V240c0-26.51-21.49-48-48-48zM480 376c-13.25 0-24-10.75-24-24 0-13.26 10.75-24 24-24s24 10.74 24 24c0 13.25-10.75 24-24 24zm-46.37-186.7L258.7 14.37c-19.16-19.16-50.23-19.16-69.39 0L14.37 189.3c-19.16 19.16-19.16 50.23 0 69.39L189.3 433.63c19.16 19.16 50.23 19.16 69.39 0L433.63 258.7c19.16-19.17 19.16-50.24 0-69.4zM96 248c-13.25 0-24-10.75-24-24 0-13.26 10.75-24 24-24s24 10.74 24 24c0 13.25-10.75 24-24 24zm128 128c-13.25 0-24-10.75-24-24 0-13.26 10.75-24 24-24s24 10.74 24 24c0 13.25-10.75 24-24 24zm0-128c-13.25 0-24-10.75-24-24 0-13.26 10.75-24 24-24s24 10.74 24 24c0 13.25-10.75 24-24 24zm0-128c-13.25 0-24-10.75-24-24 0-13.26 10.75-24 24-24s24 10.74 24 24c0 13.25-10.75 24-24 24zm128 128c-13.25 0-24-10.75-24-24 0-13.26 10.75-24 24-24s24 10.74 24 24c0 13.25-10.75 24-24 24z"/></svg>'),(0,i.addIcon)(l,'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024"><path fill="currentColor" d="M27.43 918.8l30.374-30.374 80.793 80.793-30.374 30.374L27.43 918.8zm422.393-253.815c0-48.521-39.36-87.882-87.882-87.882s-87.88 39.36-87.88 87.88c0 48.521 39.338 87.859 87.882 87.882s87.902-39.338 87.88-87.88zm-175.351 8.401l-.807-.807-166.337 166.336 80.794 80.794 166.337-166.337-.92-.92c-41.832-3.986-75.099-37.253-79.067-79.065zm-.411-8.402c0-45.507 34.621-82.952 78.95-87.431-46.731-53.121-88.214-110.883-123.852-172.613L117.593 516.506 274.47 673.383a88.927 88.927 0 0 1-.409-8.399zm175.315 8.962c-4.472 44.334-41.914 78.942-87.433 78.92a89.137 89.137 0 0 1-8.406-.413l157.058 157.058 111.566-111.566c-62.063-35.842-119.841-77.405-172.785-123.999zM815.497 74.632L392.493 497.636c6.535 9.622 10.729 21.41 10.729 33.817 0 19.234-9.188 36.441-23.375 47.483 34.711 7.191 61.918 34.869 68.453 69.814 11.013-14.625 28.5-24.14 48.078-24.14 12.407 0 23.51 3.51 32.978 9.891l423.002-423.002 29.691-166.555-166.553 29.688zM41.964 872.58l112.539 112.539 49.514-49.514L91.478 823.066 41.964 872.58z"/></svg>'),(0,i.addIcon)(I,'<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" data-prefix="far" data-icon="copy" class="svg-inline--fa fa-copy fa-w-14" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"/></svg>'),yield this.loadSettings(),this.addSettingTab(new O(this)),this.registerView(r,(e=>new Qn(e,this))),this.addCommands(),this.registerEvent(this.app.workspace.on("initiative-tracker:should-save",(()=>n(this,void 0,void 0,(function*(){return yield this.saveSettings()}))))),this.registerEvent(this.app.workspace.on("initiative-tracker:start-encounter",(e=>n(this,void 0,void 0,(function*(){try{const t=e.map((e=>j.from(e)));this.view||(yield this.addTrackerView());const n=this.view;n?(n.newEncounter({creatures:t}),this.app.workspace.revealLeaf(n.leaf)):new i.Notice("Could not find the Initiative Tracker. Try reloading the note!")}catch(e){return new i.Notice("There was an issue launching the encounter.\n\n"+e.message),void console.error(e)}}))))),this.registerMarkdownCodeBlockProcessor("encounter",this.encounterProcessor.bind(this)),this.playerCreatures=new Map(this.data.players.map((e=>[e,j.from(e)]))),this.app.workspace.onLayoutReady((()=>this.addTrackerView())),console.log("Initiative Tracker v"+this.manifest.version+" loaded")}))}encounterProcessor(e,t,r){var a,s;const o=null!==(a=e.split("---"))&&void 0!==a?a:[],l=t.createDiv("encounter-container"),c=l.createSpan({text:"No encounters created. Please check your syntax and try again."});for(let e of o)try{const t=(0,i.parseYaml)(e),r=null!==(s=t.creatures)&&void 0!==s?s:[];let a;r&&r instanceof Array&&(a=r.map((e=>{try{let t=e,n=1;if("object"!=typeof e||e instanceof Array){if("string"==typeof e)try{let[r,a]=e.split(/:\s?/).reverse();a&&!isNaN(Number(a))&&(n=Number(a)),t=(0,i.parseYaml)(r)}catch(e){return void console.error(e)}}else n=Number(Object.keys(e).shift()),t=Object.values(e).shift();if(!t.length)return;"string"==typeof t&&(t=[t.split(",")].flat());let r=new j({name:t[0],hp:t[1]&&!isNaN(Number(t[1]))?Number(t[1]):null,ac:t[2]&&!isNaN(Number(t[2]))?Number(t[2]):null,modifier:t[3]&&!isNaN(Number(t[3]))?Number(t[3]):null,marker:this.data.monsterMarker});return[...[...Array(n).keys()].map((e=>j.from(r)))]}catch(t){new i.Notice("Initiative Tracker: could not parse line: \n\n"+e)}})).filter((e=>e)).flat());const o=l.createDiv("encounter");let u=!0;t.players&&(u="none"!==t.players&&t.players),new _e({target:o,props:Object.assign(Object.assign({},t.name?{name:t.name}:{}),{players:u,creatures:a})}).$on("begin-encounter",(()=>n(this,void 0,void 0,(function*(){this.view||(yield this.addTrackerView());const e=this.view;e?(e.newEncounter(Object.assign(Object.assign({},t),{creatures:a})),this.app.workspace.revealLeaf(e.leaf)):new i.Notice("Could not find the Initiative Tracker. Try reloading the note!")})))),c.detach()}catch(t){console.error(t),new i.Notice("Initiative Tracker: here was an issue parsing: \n\n"+e)}}addCommands(){this.addCommand({id:"open-tracker",name:"Open Initiative Tracker",checkCallback:e=>{if(!this.view)return e||this.addTrackerView(),!0}}),this.addCommand({id:"toggle-encounter",name:"Toggle Encounter",checkCallback:e=>{const t=this.view;if(t)return e||t.toggleState(),!0}}),this.addCommand({id:"next-combatant",name:"Next Combatant",checkCallback:e=>{const t=this.view;if(t&&t.state)return e||t.goToNext(),!0}}),this.addCommand({id:"prev-combatant",name:"Previous Combatant",checkCallback:e=>{const t=this.view;if(t&&t.state)return e||this.view.goToPrevious(),!0}})}onunload(){return n(this,void 0,void 0,(function*(){yield this.saveSettings(),this.app.workspace.trigger("initiative-tracker:unload"),this.app.workspace.getLeavesOfType(r).forEach((e=>e.detach())),console.log("Initiative Tracker unloaded")}))}addTrackerView(){return n(this,void 0,void 0,(function*(){this.app.workspace.getLeavesOfType(r).length||(yield this.app.workspace.getRightLeaf(!1).setViewState({type:r}))}))}updatePlayer(e,t){return n(this,void 0,void 0,(function*(){if(!this.playerCreatures.has(e))return void(yield this.savePlayer(t));const n=this.playerCreatures.get(e);n.update(t),this.data.players.splice(this.data.players.indexOf(e),1,t),this.playerCreatures.set(t,n),this.playerCreatures.delete(e);const i=this.view;i&&i.updateState(),yield this.saveSettings()}))}savePlayer(e){return n(this,void 0,void 0,(function*(){this.data.players.push(e),this.playerCreatures.set(e,j.from(e)),yield this.saveSettings()}))}savePlayers(...e){return n(this,void 0,void 0,(function*(){for(let t of e)this.data.players.push(t),this.playerCreatures.set(t,j.from(t));yield this.saveSettings()}))}deletePlayer(e){return n(this,void 0,void 0,(function*(){this.data.players=this.data.players.filter((t=>t!=e)),this.playerCreatures.delete(e),yield this.saveSettings()}))}loadSettings(){return n(this,void 0,void 0,(function*(){const e=Object.assign({},Object.assign({},s),yield this.loadData());this.data=e,this.data.leafletIntegration&&!this.data.players.every((e=>e.marker))&&(this.data.players=this.data.players.map((e=>{var t;return e.marker=null!==(t=e.marker)&&void 0!==t?t:this.data.playerMarker,e})))}))}saveSettings(){return n(this,void 0,void 0,(function*(){this.data.players.every((e=>e.marker))||(this.data.players=this.data.players.map((e=>{var t;return e.marker=null!==(t=e.marker)&&void 0!==t?t:this.data.playerMarker,e}))),yield this.saveData(this.data)}))}}var ei=exports;for(var ti in t)ei[ti]=t[ti];t.__esModule&&Object.defineProperty(ei,"__esModule",{value:!0})})();